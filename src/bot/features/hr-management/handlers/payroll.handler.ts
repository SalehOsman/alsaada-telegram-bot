/**
 * Payroll Handler - ูุธุงู ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑ
 *
 * ุงูุตูุงุญูุฉ ุงูุงูุชุฑุงุถูุฉ: SUPER_ADMIN ููุท
 * ูุงุจู ููุชุนุฏูู ูู: ุฅุฏุงุฑุฉ ูุณู ุดุฆูู ุงูุนุงูููู โ ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช
 *
 * ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:
 * 1. ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ (ุงูุจุฏูุงุชุ ุงูููุงูุขุชุ ุงูุงุณุชุญูุงูุงุช)
 * 2. ุฅูุดุงุก ูุดู ุฑูุงุชุจ
 * 3. ุนุฑุถ ูุดูู ุงูุฑูุงุชุจ
 * 4. ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช
 */

import type { Context } from '../../../context.js'
import { Composer, InlineKeyboard } from 'grammy'

export const payrollHandler = new Composer<Context>()

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ - Payroll Main Menu
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

// Pattern ูู handler name (MenuBuilder ูุณุชุฎุฏูู)
payrollHandler.callbackQuery('payrollHandler', async (ctx) => {
  await handlePayroll(ctx)
})

// Pattern ูู MenuBuilder (ุงูุตูุบุฉ ุงูููุงุณูุฉ)
payrollHandler.callbackQuery(/^menu:sub:hr-management:payroll$/, async (ctx) => {
  await handlePayroll(ctx)
})

async function handlePayroll(ctx: Context) {
  await ctx.answerCallbackQuery()

  const keyboard = new InlineKeyboard()
    .text('โ๏ธ ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ', 'payroll:settings')
    .row()
    .text('โ ูุดู ุฑุงุชุจ ูุฑุฏู', 'payroll:create')
    .row()
    .text('๏ฟฝ ุงููุนุงูุฌุฉ ุงูุดูุฑูุฉ', 'hr:monthly-payroll:main')
    .row()
    .text('๏ฟฝ๐ ุนุฑุถ ูุดูู ุงูุฑูุงุชุจ', 'payroll:list')
    .row()
    .text('๐ ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช', 'payroll:reports')
    .row()
    .text('โฌ๏ธ ุฑุฌูุน', 'menu:feature:hr-management')

  await ctx.editMessageText(
    '๐ต **ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑ**\n\n'
    + '๐ **ุงููุธุงุฆู ุงููุชุงุญุฉ:**\n\n'
    + 'โ๏ธ **ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ**\n'
    + 'โ ุฅุฏุงุฑุฉ ุงูุจุฏูุงุช ูุงูููุงูุขุช ูุงูุงุณุชุญูุงูุงุช\n\n'
    + 'โ **ูุดู ุฑุงุชุจ ูุฑุฏู**\n'
    + 'โ ุญุณุงุจ ุฑุงุชุจ ููุธู ูุงุญุฏ ูุดูุฑ ูุนูู\n\n'
    + '๐ **ุงููุนุงูุฌุฉ ุงูุดูุฑูุฉ**\n'
    + 'โ ุญุณุงุจ ุฑูุงุชุจ ุฌููุน ุงูููุธููู ุดูุฑูุงู + ุชูุฑูุฑ Excel ุดุงูู\n\n'
    + '๐ **ุนุฑุถ ูุดูู ุงูุฑูุงุชุจ**\n'
    + 'โ ุนุฑุถ ูุฅุฏุงุฑุฉ ูุดูู ุงูุฑูุงุชุจ ุงูุณุงุจูุฉ\n\n'
    + '๐ **ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช**\n'
    + 'โ ุชูุงุฑูุฑ ุชูุตูููุฉ ูุฅุญุตุงุฆูุงุช ุดุงููุฉ',
    { parse_mode: 'Markdown', reply_markup: keyboard },
  )
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ - Payroll Settings
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

payrollHandler.callbackQuery('payroll:settings', async (ctx) => {
  await ctx.answerCallbackQuery()

  const keyboard = new InlineKeyboard()
    .text('๐ฐ ุฅุฏุงุฑุฉ ุฃููุงุน ุงูุจุฏูุงุช', 'payroll:settings:allowance-types')
    .row()
    .text('๐ข ุจุฏูุงุช ุงููุธุงุฆู', 'payroll:settings:position-allowances')
    .row()
    .text('๐ค ุจุฏูุงุช ุงูููุธููู', 'payroll:settings:employee-allowances')
    .row()
    .text('๐ฆ ุงุณุชุญูุงูุงุช ุงูููุงุฏ', 'payroll:settings:material-entitlements')
    .row()
    .text('๐ ุฅุฏุงุฑุฉ ุงูููุงูุขุช', 'payroll:settings:bonuses')
    .row()
    .text('๐ธ ุงูุณูู ูุงููุณุญูุจุงุช', 'menu:sub:hr-management:advances')
    .row()
    .text('โฌ๏ธ ุฑุฌูุน', 'menu:sub:hr-management:payroll')

  await ctx.editMessageText(
    'โ๏ธ **ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ**\n\n'
    + '๐ **ุงุฎุชุฑ ุงููุณู ุงููุทููุจ:**\n\n'
    + '๐ฐ **ุฃููุงุน ุงูุจุฏูุงุช**\n'
    + 'โ ุชุนุฑูู ุฃููุงุน ุงูุจุฏูุงุช (ููุงุตูุงุชุ ุฅุฌุงุฒุงุชุ ุฅุถุงููุ ุฃุฎุฑู)\n\n'
    + '๐ข **ุจุฏูุงุช ุงููุธุงุฆู**\n'
    + 'โ ุชุญุฏูุฏ ุงูุจุฏูุงุช ุงูุงูุชุฑุงุถูุฉ ููู ูุธููุฉ\n\n'
    + '๐ค **ุจุฏูุงุช ุงูููุธููู**\n'
    + 'โ ุชุนุฏูู ุงูุจุฏูุงุช ุงูุฎุงุตุฉ ุจููุธู ูุนูู\n\n'
    + '๐ฆ **ุงุณุชุญูุงูุงุช ุงูููุงุฏ**\n'
    + 'โ ุชุญุฏูุฏ ุงุณุชุญูุงูุงุช ุงูููุงุฏ ุงูููููุฉ\n\n'
    + '๐ **ุงูููุงูุขุช**\n'
    + 'โ ุฅุถุงูุฉ ูุฅุฏุงุฑุฉ ุงูููุงูุขุช ุงูุดูุฑูุฉ\n\n'
    + '๐ธ **ุงูุณูู ูุงููุณุญูุจุงุช**\n'
    + 'โ ุชุณุฌูู ูุฅุฏุงุฑุฉ ุงูุณูู ุงูููุฏูุฉ ูุงููุณุญูุจุงุช ุงูุนูููุฉ',
    { parse_mode: 'Markdown', reply_markup: keyboard },
  )
})

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// ูุงุฆูุฉ ูุคูุชุฉ ูููุธุงุฆู ุงูุฃุฎุฑู
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// Note: payroll:create is now handled by payroll-calculate.handler.ts

payrollHandler.callbackQuery('payroll:list', async (ctx) => {
  await ctx.answerCallbackQuery()

  const keyboard = new InlineKeyboard()
    .text('โฌ๏ธ ุฑุฌูุน', 'menu:sub:hr-management:payroll')

  await ctx.editMessageText(
    '๐ **ุนุฑุถ ูุดูู ุงูุฑูุงุชุจ**\n\nโณ ุงููุธููุฉ ููุฏ ุงูุชุทููุฑ...',
    { parse_mode: 'Markdown', reply_markup: keyboard },
  )
})

payrollHandler.callbackQuery('payroll:reports', async (ctx) => {
  await ctx.answerCallbackQuery()

  const keyboard = new InlineKeyboard()
    .text('โฌ๏ธ ุฑุฌูุน', 'menu:sub:hr-management:payroll')

  await ctx.editMessageText(
    '๐ **ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช**\n\nโณ ุงููุธููุฉ ููุฏ ุงูุชุทููุฑ...',
    { parse_mode: 'Markdown', reply_markup: keyboard },
  )
})
