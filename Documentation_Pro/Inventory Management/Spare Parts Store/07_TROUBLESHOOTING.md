# ๐ง ูุฎุฒู ูุทุน ุงูุบูุงุฑ - ุญู ุงููุดุงูู

**ุงููุณุฎุฉ:** 2.0  
**ุขุฎุฑ ุชุญุฏูุซ:** ููููุจุฑ 2025

---

## ๐จ ุงููุดุงูู ุงูุดุงุฆุนุฉ

### 1. ุงูุจูุช ูุง ูุณุชุฌูุจ

**ุงูุฃุนุฑุงุถ:**
- ุงูุฃุฒุฑุงุฑ ูุง ุชุนูู
- ูุง ุชูุฌุฏ ุฑุฏูุฏ ุนูู ุงูุฑุณุงุฆู

**ุงูุญููู:**
```bash
# 1. ุชุญูู ูู ุชุดุบูู ุงูุจูุช
pm2 status

# 2. ุฃุนุฏ ุชุดุบูู ุงูุจูุช
pm2 restart telegram-bot

# 3. ุชุญูู ูู ุงูู logs
pm2 logs telegram-bot --lines 50
```

---

### 2. ูุณุญ ุงูุจุงุฑููุฏ ูุง ูุนูู

**ุงูุฃุนุฑุงุถ:**
- "ูุดู ูุฑุงุกุฉ ุงูุจุงุฑููุฏ"
- ูุง ูุชุนุฑู ุนูู ุงูุตูุฑุฉ

**ุงูุญููู:**
โ ุชุฃูุฏ ูู ูุถูุญ ุงูุตูุฑุฉ
โ ุงุณุชุฎุฏู ุฅุถุงุกุฉ ุฌูุฏุฉ
โ ุงูุชูุท ุงูุตูุฑุฉ ุจุดูู ูุจุงุดุฑ (ุจุฏูู ุฒุงููุฉ)
โ ุฌุฑูุจ ุงูุฅุฏุฎุงู ุงููุฏูู ูุจุฏูู

**ูููุทูุฑ:**
```typescript
// ุชุญูู ูู ุฎุฏูุฉ ุงูุจุงุฑููุฏ
const result = await BarcodeScannerService.scan(buffer)
console.log('Barcode result:', result)
```

---

### 3. "ุงูุจุงุฑููุฏ ููุฌูุฏ ูุณุจูุงู"

**ุงูุณุจุจ:**
- ุชู ุชุณุฌูู ููุณ ุงูุจุงุฑููุฏ ูู ูุจู

**ุงูุญููู:**
1. **ุฅุฐุง ูุงูุช ููุณ ุงููุทุนุฉ:**
   - ุงุถุบุท "ุนุฑุถ ุงููุทุนุฉ ุงูููุฌูุฏุฉ"
   - ุนุฏูู ุงููููุฉ ุจุฏูุงู ูู ุฅุถุงูุฉ ุฌุฏูุฏุฉ

2. **ุฅุฐุง ูุงูุช ูุทุนุฉ ูุฎุชููุฉ:**
   - ุงุณุชุฎุฏู ุจุงุฑููุฏ ูุฎุชูู
   - ุฃู ูููุฏ ุจุงุฑููุฏ ุชููุงุฆู

---

### 4. Session ุถุงุนุช / ุงูุจูุช ูุณู ุงูุจูุงูุงุช

**ุงูุฃุนุฑุงุถ:**
- "ุญุงูุฉ ุบูุฑ ุตุญูุญุฉ"
- ุงูุจูุช ูุง ูุชุฐูุฑ ุงูุฎุทูุฉ ุงูุณุงุจูุฉ

**ุงูุญููู:**
1. ุงุถุบุท **โ ุฅูุบุงุก** ูุงุจุฏุฃ ูู ุฌุฏูุฏ
2. ุฃุนุฏ ุชุดุบูู ุงููุญุงุฏุซุฉ ุจู `/start`

**ูููุทูุฑ:**
```typescript
// ุชุญูู ูู ุงูู session
console.warn('Session:', ctx.session.inventoryForm)

// ุฃุนุฏ ุชุนููู ุงูู session
delete ctx.session.inventoryForm
```

---

### 5. ุงูุฅุดุนุงุฑุงุช ูุง ุชุตู ูููุณุคูููู

**ุงูุฃุนุฑุงุถ:**
- ุฑุณุงูุฉ "ุชู ุฅุฑุณุงู ุชูุฑูุฑ ูููุณุคูููู" ููู ูู ูุตู ุดูุก

**ุงูุญููู:**

**1. ุชุญูู ูู ูุฌูุฏ ุงููุณู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```sql
SELECT * FROM "departmentConfig" 
WHERE code = 'inventory-management';
```

**2. ุชุญูู ูู ูุฌูุฏ ูุณุคูููู:**
```sql
SELECT * FROM "departmentAdmin" 
WHERE "departmentId" = (
  SELECT id FROM "departmentConfig" 
  WHERE code = 'inventory-management'
) AND "isActive" = true;
```

**3. ุชุญูู ูู ุงูุตูุงุญูุงุช:**
- ุงูุญุฏ ุงูุฃุฏูู: `ADMIN`
- Super Admin Only: `false`

**4. ุชุญูู ูู ุงูู logs:**
```bash
# ุงุจุญุซ ุนู ุฑุณุงุฆู ุงูุฎุทุฃ
pm2 logs | grep "Failed to send report"
```

---

### 6. ุฃุฎุทุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุฃุนุฑุงุถ:**
- "Database connection failed"
- "Prisma error"

**ุงูุญููู:**
```bash
# 1. ุชุญูู ูู ุงุชุตุงู PostgreSQL
psql -U postgres -c "SELECT 1"

# 2. ุฃุนุฏ ุชูููุฏ Prisma client
npx prisma generate

# 3. ุชุญูู ูู ุงูู migrations
npx prisma migrate status

# 4. ุทุจูู ุงูู migrations ุงูููููุฏุฉ
npx prisma migrate deploy
```

---

### 7. ุงูุจูุงุก (Build) ููุดู

**ุงูุฃุนุฑุงุถ:**
- TypeScript errors
- ESLint errors

**ุงูุญููู:**
```bash
# 1. ุงูุณุญ ุงูู build ุงููุฏูู
Remove-Item -Recurse -Force build

# 2. ุชุญูู ูู ุงูุฃุฎุทุงุก
npm run lint

# 3. ุฃุนุฏ ุงูุจูุงุก
npm run build

# 4. ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุฃุนุฏ ุชุซุจูุช ุงูููุชุจุงุช
Remove-Item -Recurse -Force node_modules
npm install
```

---

### 8. ุงูุตูุฑ ูุง ุชูุญูุธ

**ุงูุฃุนุฑุงุถ:**
- ุงูุตูุฑ ูุง ุชุธูุฑ ุจุนุฏ ุงูุญูุธ
- ุฎุทุฃ "Failed to upload image"

**ุงูุญููู:**
1. ุชุญูู ูู ูุณุงุญุฉ ุงูุชุฎุฒูู
2. ุชุญูู ูู ุตูุงุญูุงุช ูุฌูุฏ `uploads/`
3. ุชุญูู ูู ุญุฌู ุงูุตูุฑุฉ (ุงูุญุฏ ุงูุฃูุตู: 5MB)

**ูููุทูุฑ:**
```typescript
// ุชุญูู ูู ุญูุธ ุงูุตูุฑ
const images = typeof item.images === 'string' 
  ? JSON.parse(item.images) 
  : item.images
console.log('Images:', images)
```

---

## ๐ ุงูุฃุฎุทุงุก ุงูุจุฑูุฌูุฉ ุงูุดุงุฆุนุฉ

### Error: "can't parse entities"

**ุงูุณุจุจ:** ุฎุทุฃ ูู ุชูุณูู Markdown

**ุงูุญู:**
```typescript
// โ ุงุณุชุฎุฏู HTML ุจุฏูุงู ูู Markdown
await ctx.editMessageText(text, {
  parse_mode: 'HTML',  // ุจุฏูุงู ูู 'Markdown'
})

// ุฃู ุชุฃูุฏ ูู escape ุงูุฃุญุฑู ุงูุฎุงุตุฉ
const text = `**Bold text**`  // ุตุญูุญ
const text = `**Bold ** text`  // ุฎุทุฃ - ูุณุงูุฉ ุจุนุฏ **
```

---

### Error: "Json value not valid"

**ุงูุณุจุจ:** ุญูู Json ูุญุชูู ุนูู ูุต ุจุฏูุงู ูู JSON

**ุงูุญู:**
```typescript
// โ ุชุญูู ูู ุงูููุน ูุจู Parse
if (item.images) {
  const imagesStr = typeof item.images === 'string' 
    ? item.images 
    : JSON.stringify(item.images)
  const imagesParsed = JSON.parse(imagesStr)
}
```

---

### Error: "location.icon is not defined"

**ุงูุณุจุจ:** ุงูุญูู ุบูุฑ ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุญู:**
```typescript
// โ ุงุณุชุฎุฏู optional chaining
const icon = location?.icon || '๐'
```

---

## ๐ ูุญุต ุงูุตุญุฉ (Health Check)

### ุชุญูู ูู ุตุญุฉ ุงููุธุงู

```bash
# 1. ุญุงูุฉ ุงูุจูุช
pm2 status telegram-bot

# 2. ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช
npx prisma db execute --stdin <<< "SELECT 1"

# 3. ุนุฏุฏ ุงููุทุน ุงููุณุฌูุฉ
npx prisma studio
# โ ุงูุชุญ ุฌุฏูู INV_SparePart

# 4. ุขุฎุฑ ุงูุญุฑูุงุช
pm2 logs telegram-bot --lines 100
```

---

## ๐ ุฃุฏูุงุช ุงูุชุดุฎูุต

### Prisma Studio
```bash
npx prisma studio
# ุงูุชุญ http://localhost:5555
```

### Database Logs
```sql
-- ุงููุทุน ุงููุถุงูุฉ ุงูููู
SELECT * FROM "INV_SparePart" 
WHERE "createdAt" >= CURRENT_DATE;

-- ุงููุทุน ุฃูู ูู ุงูุญุฏ ุงูุฃุฏูู
SELECT * FROM "INV_SparePart" 
WHERE quantity < "minQuantity" 
  AND "isDeleted" = false;
```

### Bot Logs
```bash
# ุขุฎุฑ 50 ุณุทุฑ
pm2 logs telegram-bot --lines 50

# ุงูุชุชุจุน ุงููุจุงุดุฑ
pm2 logs telegram-bot --raw

# logs ูุญุฏุฏุฉ ุจูููุฉ ููุชุงุญูุฉ
pm2 logs telegram-bot | grep "ERROR"
```

---

## ๐ ุงูุญุตูู ุนูู ุงููุณุงุนุฏุฉ

### ูุจู ุงูุงุชุตุงู ุจุงูุฏุนู:

โ ุฌุฑูุจ ุงูุญููู ุฃุนูุงู
โ ุงุญูุธ ุฑุณุงูุฉ ุงูุฎุทุฃ ุงููุงููุฉ
โ ุญุฏุฏ ุฎุทูุงุช ุฅุนุงุฏุฉ ุฅูุชุงุฌ ุงููุดููุฉ
โ ุชุญูู ูู ุงูู logs

### ูุนูููุงุช ูุทููุจุฉ:

- ููุน ุงููุดููุฉ
- ุฑุณุงูุฉ ุงูุฎุทุฃ (screenshot)
- ุงูุฎุทูุงุช ุงูุชู ููุช ุจูุง
- ุงูุจูุฆุฉ (production/development)
- ุงููุณุฎุฉ

---

## ๐๏ธ ุฃุฏูุงุช ูููุฏุฉ

```bash
# ุฅุนุงุฏุฉ ุชุดุบูู ุงูุจูุช
pm2 restart telegram-bot

# ูุณุญ ุงูู logs
pm2 flush telegram-bot

# ุนุฑุถ ุงุณุชููุงู ุงูููุงุฑุฏ
pm2 monit

# backup ูุงุนุฏุฉ ุงูุจูุงูุงุช
pg_dump -U postgres bot_db > backup.sql

# ุงุณุชุนุงุฏุฉ backup
psql -U postgres bot_db < backup.sql
```

---

**๐ ููุงุญุธุฉ:** ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ ุจุนุฏ ุชุฌุฑุจุฉ ุฌููุน ุงูุญูููุ ุงูุชุญ issue ูู GitHub ุฃู ุงุชุตู ุจูุฑูู ุงูุฏุนู.
