# 04 - المسحوبات العينية

## 📖 نظرة عامة

المسحوبات العينية هي أصناف مادية يسحبها الموظف من مخزن الشركة، ولها قيمة مالية تُحسب ضمن راتبه.

---

## 🎯 مفهوم المسحوبات العينية

### **التعريف:**
أصناف مادية (ليست نقوداً) يحق للموظف سحبها بكميات محددة يومياً، وتُحسب قيمتها المالية كجزء من راتبه.

### **أمثلة على المسحوبات:**
- سجائر
- مشروبات غازية
- مياه
- وجبات غذائية
- أدوات عمل قابلة للاستهلاك

---

## 📊 آلية العمل

### **المبدأ الأساسي:**

```
1. الموظف له "استحقاق يومي" من كل صنف
2. يسحب كميات فعلية خلال الشهر (أو الفترة)
3. يُحسب له بدل عما سحبه (في حدود استحقاقه)
4. إذا سحب زيادة → تُخصم قيمة الزيادة
```

---

## 🔢 قواعد الحساب

### **القاعدة الرئيسية:**

```
الكمية المستحقة = الكمية اليومية × أيام العمل الفعلية

المقارنة:
─────────────────────────────────────────

إذا: المسحوب ≤ المستحق
  ✅ بدل المسحوبات = المسحوب × السعر
  ✅ خصم = 0

إذا: المسحوب > المستحق
  ✅ بدل المسحوبات = المستحق × السعر
  ❌ خصم الزائد = (المسحوب - المستحق) × السعر
```

---

## 📋 مصدر البيانات

### **1. إعدادات الاستحقاق:**

#### **أ) على مستوى الوظيفة:**
```
جدول: PayrollSettings_Position
─────────────────────────────────
positionId: معرف الوظيفة
materialItems: JSON يحتوي على:
  [
    {
      itemId: 1,
      itemName: "سجائر",
      dailyQuantity: 2,
      price: 10
    },
    {
      itemId: 2,
      itemName: "مشروبات",
      dailyQuantity: 1,
      price: 5
    }
  ]
```

#### **ب) على مستوى الموظف (يلغي إعدادات الوظيفة):**
```
جدول: PayrollSettings_Employee
─────────────────────────────────
employeeId: معرف الموظف
materialItems: JSON بنفس الهيكل أعلاه
```

### **2. المسحوبات الفعلية:**

```
جدول: HR_Transaction
─────────────────────────────────
type: "MATERIAL_WITHDRAWAL"
employeeId: معرف الموظف
date: تاريخ السحب
items: JSON يحتوي على:
  [
    {
      itemId: 1,
      itemName: "سجائر",
      quantity: 5,
      price: 10,
      total: 50
    }
  ]
```

### **3. أيام العمل الفعلية:**

تُحسب من:
```
- تاريخ بداية العمل: Employee.hireDate
- أيام الإجازات: HR_EmployeeLeave (حالة APPROVED)
- الفترة المحددة: من تاريخ إلى تاريخ

أيام العمل = أيام الفترة - أيام الإجازات
```

---

## 📊 أمثلة تفصيلية

### **مثال 1: سحب أقل من الاستحقاق**

```
═══════════════════════════════════════════════
الصنف: سجائر
───────────────────────────────────────────────
الاستحقاق اليومي:         2 علبة/يوم
السعر:                    10 جنيه/علبة
الفترة:                   1-15 أكتوبر (15 يوم)
أيام الإجازات:            2 يوم
أيام العمل الفعلية:       13 يوم

───────────────────────────────────────────────
الحساب:
───────────────────────────────────────────────

الكمية المستحقة:
= 2 علبة/يوم × 13 يوم = 26 علبة

المسحوب فعلياً: 20 علبة

المقارنة: 20 < 26 ✅ (ضمن الحد المسموح)

───────────────────────────────────────────────
النتيجة:
───────────────────────────────────────────────

بدل المسحوبات:
= 20 × 10 = 200 جنيه ✅ (يُضاف للراتب)

خصم: 0 جنيه

═══════════════════════════════════════════════
```

---

### **مثال 2: سحب مساوٍ للاستحقاق**

```
═══════════════════════════════════════════════
الصنف: مشروبات غازية
───────────────────────────────────────────────
الاستحقاق اليومي:         1 زجاجة/يوم
السعر:                    5 جنيه/زجاجة
الفترة:                   1-30 أكتوبر (30 يوم)
أيام الإجازات:            0 يوم
أيام العمل الفعلية:       30 يوم

───────────────────────────────────────────────
الحساب:
───────────────────────────────────────────────

الكمية المستحقة:
= 1 زجاجة/يوم × 30 يوم = 30 زجاجة

المسحوب فعلياً: 30 زجاجة

المقارنة: 30 = 30 ✅ (بالضبط)

───────────────────────────────────────────────
النتيجة:
───────────────────────────────────────────────

بدل المسحوبات:
= 30 × 5 = 150 جنيه ✅ (يُضاف للراتب)

خصم: 0 جنيه

═══════════════════════════════════════════════
```

---

### **مثال 3: سحب أكثر من الاستحقاق**

```
═══════════════════════════════════════════════
الصنف: سجائر
───────────────────────────────────────────────
الاستحقاق اليومي:         2 علبة/يوم
السعر:                    10 جنيه/علبة
الفترة:                   1-15 أكتوبر (15 يوم)
أيام الإجازات:            1 يوم
أيام العمل الفعلية:       14 يوم

───────────────────────────────────────────────
الحساب:
───────────────────────────────────────────────

الكمية المستحقة:
= 2 علبة/يوم × 14 يوم = 28 علبة

المسحوب فعلياً: 35 علبة

المقارنة: 35 > 28 ⚠️ (زيادة 7 علب)

───────────────────────────────────────────────
النتيجة:
───────────────────────────────────────────────

بدل المسحوبات:
= 28 × 10 = 280 جنيه ✅ (يُضاف للراتب)
(فقط ما يستحقه)

خصم الزائد:
= 7 × 10 = 70 جنيه ❌ (يُخصم من الراتب)

الصافي:
= 280 - 70 = 210 جنيه

═══════════════════════════════════════════════
```

---

### **مثال 4: عدة أصناف**

```
═══════════════════════════════════════════════
          حساب المسحوبات - شهر أكتوبر
═══════════════════════════════════════════════

الفترة: 1-30 أكتوبر
أيام العمل الفعلية: 28 يوم (إجازتين)

───────────────────────────────────────────────
📦 الصنف الأول: سجائر
───────────────────────────────────────────────
استحقاق يومي: 2 علبة
أيام عمل: 28 يوم
مستحق = 2 × 28 = 56 علبة
مسحوب = 50 علبة ✅
سعر = 10 جنيه

بدل = 50 × 10 = 500 جنيه ✅
خصم = 0

───────────────────────────────────────────────
📦 الصنف الثاني: مشروبات
───────────────────────────────────────────────
استحقاق يومي: 1 زجاجة
أيام عمل: 28 يوم
مستحق = 1 × 28 = 28 زجاجة
مسحوب = 35 زجاجة ⚠️ (زيادة 7)
سعر = 5 جنيه

بدل = 28 × 5 = 140 جنيه ✅
خصم = 7 × 5 = 35 جنيه ❌

───────────────────────────────────────────────
📦 الصنف الثالث: مياه
───────────────────────────────────────────────
استحقاق يومي: 3 زجاجات
أيام عمل: 28 يوم
مستحق = 3 × 28 = 84 زجاجة
مسحوب = 84 زجاجة ✅ (بالضبط)
سعر = 3 جنيه

بدل = 84 × 3 = 252 جنيه ✅
خصم = 0

───────────────────────────────────────────────
💰 الإجمالي:
───────────────────────────────────────────────

إجمالي بدل المسحوبات:
= 500 + 140 + 252 = 892 جنيه ✅

إجمالي الخصومات:
= 0 + 35 + 0 = 35 جنيه ❌

الصافي:
= 892 - 35 = 857 جنيه

═══════════════════════════════════════════════
```

---

## 🔍 حالات خاصة

### **1. موظف في إجازة طويلة**

```
الفترة: 1-30 أكتوبر (30 يوم)
إجازة: 10 أيام
أيام عمل فعلية: 20 يوم

الصنف: سجائر (2 علبة/يوم)

المستحق = 2 × 20 = 40 علبة فقط
(وليس 2 × 30 = 60)

إذا سحب 50 علبة:
- بدل = 40 × 10 = 400 جنيه
- خصم = 10 × 10 = 100 جنيه
```

### **2. موظف جديد (بدأ منتصف الشهر)**

```
تاريخ التعيين: 15 أكتوبر
الفترة المحسوبة: 15-31 أكتوبر = 17 يوم

الصنف: مشروبات (1 زجاجة/يوم)

المستحق = 1 × 17 = 17 زجاجة
(يُحسب من تاريخ التعيين فقط)
```

### **3. موظف منتهي الخدمة**

```
تاريخ إنهاء الخدمة: 20 أكتوبر
الفترة المحسوبة: 1-20 أكتوبر = 20 يوم

الصنف: سجائر (2 علبة/يوم)

المستحق = 2 × 20 = 40 علبة
(يُحسب حتى تاريخ الإنهاء فقط)
```

### **4. تسوية نصف شهرية**

```
التسوية: 1-15 أكتوبر
أيام عمل في الفترة: 14 يوم (إجازة يوم واحد)

الصنف: سجائر (2 علبة/يوم)
المستحق في التسوية = 2 × 14 = 28 علبة

───────────────────────────

الراتب الشهري: 16-30 أكتوبر
أيام عمل في الفترة: 15 يوم

المستحق في الراتب = 2 × 15 = 30 علبة

───────────────────────────

ملاحظة: الفترتان منفصلتان تماماً
```

---

## 📊 نموذج حساب كامل

```
═══════════════════════════════════════════════
   حساب بدل المسحوبات - تسوية نصف شهرية
═══════════════════════════════════════════════

👤 الموظف: أحمد محمد علي
📅 الفترة: 1-15 أكتوبر 2024
📆 أيام الفترة: 15 يوم
🏖️ أيام الإجازة: 2 يوم
💼 أيام العمل الفعلية: 13 يوم

───────────────────────────────────────────────
📦 الأصناف المستحقة:
───────────────────────────────────────────────

┌─────────────────────────────────────────────┐
│ 1. سجائر                                     │
├─────────────────────────────────────────────┤
│ استحقاق يومي: 2 علبة                        │
│ مستحق = 2 × 13 = 26 علبة                    │
│ مسحوب = 22 علبة ✅                          │
│ سعر = 10 جنيه                               │
│                                             │
│ بدل = 22 × 10 = 220 جنيه ✅                 │
│ خصم = 0                                     │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│ 2. مشروبات غازية                            │
├─────────────────────────────────────────────┤
│ استحقاق يومي: 1 زجاجة                       │
│ مستحق = 1 × 13 = 13 زجاجة                   │
│ مسحوب = 18 زجاجة ⚠️ (زيادة 5)              │
│ سعر = 5 جنيه                                │
│                                             │
│ بدل = 13 × 5 = 65 جنيه ✅                   │
│ خصم = 5 × 5 = 25 جنيه ❌                    │
└─────────────────────────────────────────────┘

───────────────────────────────────────────────
💰 الإجمالي:
───────────────────────────────────────────────

إجمالي بدل المسحوبات:    285 جنيه ✅
إجمالي خصم الزيادة:       25 جنيه ❌
                          ──────────────
الصافي:                   260 جنيه

═══════════════════════════════════════════════
```

---

## ⚙️ الإعدادات المطلوبة

### **على مستوى النظام:**

```
1. تحديد الأصناف المتاحة:
   - اسم الصنف
   - السعر الافتراضي
   - الوحدة (علبة، زجاجة، كيس، الخ)

2. تحديد الاستحقاقات:
   - لكل وظيفة: الكمية اليومية لكل صنف
   - لموظفين محددين: استحقاقات خاصة
```

### **عند حساب الراتب:**

```
1. جمع المسحوبات الفعلية من الفترة المحددة
2. حساب أيام العمل الفعلية (بطرح الإجازات)
3. حساب الاستحقاق لكل صنف
4. المقارنة وحساب البدل والخصم
5. إضافة البدل للمستحقات
6. إضافة الخصم للخصومات
```

---

## 🎯 فوائد النظام

✅ **عدالة:** كل موظف يأخذ بدل ما سحبه فعلاً
✅ **مرونة:** الموظف يسحب حسب حاجته
✅ **تحكم:** لا يمكن السحب بدون حدود
✅ **شفافية:** الموظف يرى تفاصيل المسحوبات
✅ **دقة:** الحسابات آلية ومضبوطة

---

## ➡️ الخطوة التالية

لفهم باقي الخصومات، انتقل إلى:

**[05 - الخصومات والسلف](./05_الخصومات_والسلف.md)**

---

[⬅️ السابق: نظام التسويات](./03_نظام_التسويات.md) | [🏠 الفهرس](./00_الفهرس.md) | [➡️ التالي: الخصومات والسلف](./05_الخصومات_والسلف.md)
