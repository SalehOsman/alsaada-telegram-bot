# 08 - ุชุตููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงููุณู ููุซู ุชุตููู ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุทููุจุฉ ููุธุงู ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑุ **ุจุฏูู ุฃููุงุฏ Prisma**ุ ููุท ุงููุชุทูุจุงุช ูุงูุญููู.

---

## ๐๏ธ ุงูุฌุฏุงูู ุงููุทููุจุฉ

### **ุฌุฏุงูู ุฌุฏูุฏุฉ (ูุฌุจ ุฅูุดุงุคูุง):**
1. PayrollSettings_Position
2. PayrollSettings_Employee  
3. HR_MonthlyBonus
4. HR_PayrollSettlement
5. PayrollReport

### **ุฌุฏุงูู ููุฌูุฏุฉ (ุชูุณุชุฎุฏู ููุง ูู):**
- Employee
- HR_Transaction
- HR_EmployeeLeave
- HR_AdvanceItem

---

## 1๏ธโฃ PayrollSettings_Position

### **ุงูุบุฑุถ:**
ุชุฎุฒูู ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ ุงูุงูุชุฑุงุถูุฉ ููู ูุธููุฉ.

### **ุงูุญููู ุงููุทููุจุฉ:**

| ุงูุญูู | ุงูููุน | ุงููุตู | ูุซุงู |
|-------|------|-------|------|
| `id` | ุฑูู ุตุญูุญ | ุงููุนุฑู ุงููุฑูุฏ (Primary Key) | 1 |
| `positionName` | ูุต | ุงุณู ุงููุธููุฉ | "ูููุฏุณ ูููุน" |
| `positionCode` | ูุต | ููุฏ ุงููุธููุฉ (ูุฑูุฏ) | "ENG-001" |
| `allowances` | ุนุฏุฏ ุนุดุฑู | ุงูุจุฏูุงุช ุงูุดูุฑูุฉ ุงูุซุงุจุชุฉ | 1000.00 |
| `materialItems` | JSON | ุงูุฃุตูุงู ุงููุณุชุญูุฉ ููููุงู | (ุงูุธุฑ ุงูุชูุงุตูู ุฃุฏูุงู) |
| `isActive` | Boolean | ุญุงูุฉ ุงููุดุงุท | true |
| `createdAt` | ุชุงุฑูุฎ ูููุช | ุชุงุฑูุฎ ุงูุฅูุดุงุก | 2024-10-01 |
| `updatedAt` | ุชุงุฑูุฎ ูููุช | ุชุงุฑูุฎ ุขุฎุฑ ุชุนุฏูู | 2024-10-15 |

### **ูููู materialItems (JSON):**

```json
[
  {
    "itemId": 1,
    "itemName": "ุณุฌุงุฆุฑ",
    "dailyQuantity": 2,
    "price": 10.00,
    "unit": "ุนูุจุฉ"
  },
  {
    "itemId": 2,
    "itemName": "ูุดุฑูุจุงุช ุบุงุฒูุฉ",
    "dailyQuantity": 1,
    "price": 5.00,
    "unit": "ุฒุฌุงุฌุฉ"
  }
]
```

---

## 2๏ธโฃ PayrollSettings_Employee

### **ุงูุบุฑุถ:**
ุชุฎุฒูู ุฅุนุฏุงุฏุงุช ุฑูุงุชุจ ุฎุงุตุฉ ูููุธููู ูุญุฏุฏูู (ุชูุบู ุฅุนุฏุงุฏุงุช ุงููุธููุฉ).

### **ุงูุญููู ุงููุทููุจุฉ:**

| ุงูุญูู | ุงูููุน | ุงููุตู | ูุซุงู |
|-------|------|-------|------|
| `id` | ุฑูู ุตุญูุญ | ุงููุนุฑู ุงููุฑูุฏ | 1 |
| `employeeId` | ุฑูู ุตุญูุญ | ูุนุฑู ุงูููุธู (Foreign Key) | 5 |
| `allowances` | ุนุฏุฏ ุนุดุฑู | ุจุฏูุงุช ุฎุงุตุฉ (ุงุฎุชูุงุฑู) | 1500.00 |
| `materialItems` | JSON | ุฃุตูุงู ุฎุงุตุฉ (ุงุฎุชูุงุฑู) | (ููุณ ุงููููู ุฃุนูุงู) |
| `overridePosition` | Boolean | ูู ููุบู ุฅุนุฏุงุฏุงุช ุงููุธููุฉ | true |
| `notes` | ูุต | ููุงุญุธุงุช | "ุจุฏูุงุช ุฅุถุงููุฉ ููุณุคูููุฉ" |
| `isActive` | Boolean | ุญุงูุฉ ุงููุดุงุท | true |
| `createdAt` | ุชุงุฑูุฎ ูููุช | ุชุงุฑูุฎ ุงูุฅูุดุงุก | 2024-10-01 |
| `updatedAt` | ุชุงุฑูุฎ ูููุช | ุชุงุฑูุฎ ุขุฎุฑ ุชุนุฏูู | 2024-10-15 |

### **ุงูุนูุงูุงุช:**
- `employeeId` โ ูุดูุฑ ุฅูู ุฌุฏูู `Employee`

---

## 3๏ธโฃ HR_MonthlyBonus

### **ุงูุบุฑุถ:**
ุชุฎุฒูู ุงูููุงูุขุช ุงูุดูุฑูุฉ ููููุธููู (ุฏุงุฆูุฉ ููุคูุชุฉ).

### **ุงูุญููู ุงููุทููุจุฉ:**

| ุงูุญูู | ุงูููุน | ุงููุตู | ูุซุงู |
|-------|------|-------|------|
| `id` | ุฑูู ุตุญูุญ | ุงููุนุฑู ุงููุฑูุฏ | 1 |
| `employeeId` | ุฑูู ุตุญูุญ | ูุนุฑู ุงูููุธู | 5 |
| `amount` | ุนุฏุฏ ุนุดุฑู | ูููุฉ ุงูููุงูุฃุฉ | 500.00 |
| `type` | ูุต | ููุน ุงูููุงูุฃุฉ | "PERMANENT" ุฃู "TEMPORARY" |
| `description` | ูุต | ูุตู ุงูููุงูุฃุฉ | "ููุงูุฃุฉ ุชููุฒ" |
| `startDate` | ุชุงุฑูุฎ | ุชุงุฑูุฎ ุงูุจุฏุงูุฉ | 2024-10-01 |
| `endDate` | ุชุงุฑูุฎ | ุชุงุฑูุฎ ุงูููุงูุฉ (NULL ููุฏุงุฆูุฉ) | 2024-12-31 ุฃู NULL |
| `isActive` | Boolean | ุญุงูุฉ ุงููุดุงุท | true |
| `createdBy` | ุฑูู ุตุญูุญ | ูู ุฃูุดุฃูุง | 1 |
| `approvedBy` | ุฑูู ุตุญูุญ | ูู ุงุนุชูุฏูุง | 2 |
| `createdAt` | ุชุงุฑูุฎ ูููุช | ุชุงุฑูุฎ ุงูุฅูุดุงุก | 2024-10-01 |
| `updatedAt` | ุชุงุฑูุฎ ูููุช | ุชุงุฑูุฎ ุขุฎุฑ ุชุนุฏูู | 2024-10-01 |

### **ุงูุนูุงูุงุช:**
- `employeeId` โ ูุดูุฑ ุฅูู `Employee`
- `createdBy` โ ูุดูุฑ ุฅูู `User`
- `approvedBy` โ ูุดูุฑ ุฅูู `User`

---

## 4๏ธโฃ HR_PayrollSettlement

### **ุงูุบุฑุถ:**
ุชุฎุฒูู ุงูุชุณููุงุช (ูุตู ุดูุฑูุฉ ูุดูุฑูุฉ) ููููุธููู.

### **ุงูุญููู ุงููุทููุจุฉ:**

| ุงูุญูู | ุงูููุน | ุงููุตู | ูุซุงู |
|-------|------|-------|------|
| `id` | ุฑูู ุตุญูุญ | ุงููุนุฑู ุงููุฑูุฏ | 1 |
| `employeeId` | ุฑูู ุตุญูุญ | ูุนุฑู ุงูููุธู | 5 |
| `type` | ูุต | ููุน ุงูุชุณููุฉ | "MID_MONTH" ุฃู "MONTHLY" |
| `month` | ุฑูู ุตุญูุญ | ุงูุดูุฑ (1-12) | 10 |
| `year` | ุฑูู ุตุญูุญ | ุงูุณูุฉ | 2024 |
| `periodStart` | ุชุงุฑูุฎ | ุจุฏุงูุฉ ุงููุชุฑุฉ | 2024-10-01 |
| `periodEnd` | ุชุงุฑูุฎ | ููุงูุฉ ุงููุชุฑุฉ | 2024-10-15 |
| `workDays` | ุฑูู ุตุญูุญ | ุฃูุงู ุงูุนูู ุงููุนููุฉ | 13 |
| `leaveDays` | ุฑูู ุตุญูุญ | ุฃูุงู ุงูุฅุฌุงุฒุงุช | 2 |
| **ุงููุณุชุญูุงุช** |||
| `basicSalary` | ุนุฏุฏ ุนุดุฑู | ุงูุฑุงุชุจ ุงูุฃุณุงุณู | 2600.00 |
| `allowances` | ุนุฏุฏ ุนุดุฑู | ุงูุจุฏูุงุช | 500.00 |
| `bonuses` | ุนุฏุฏ ุนุดุฑู | ุงูููุงูุขุช | 200.00 |
| `materialAllowance` | ุนุฏุฏ ุนุดุฑู | ุจุฏู ุงููุณุญูุจุงุช | 220.00 |
| `totalEarnings` | ุนุฏุฏ ุนุดุฑู | ุฅุฌูุงูู ุงููุณุชุญูุงุช | 3520.00 |
| **ุงูุฎุตููุงุช** |||
| `advances` | ุนุฏุฏ ุนุดุฑู | ุงูุณูู | 800.00 |
| `materialDeductions` | ุนุฏุฏ ุนุดุฑู | ุฎุตู ูุณุญูุจุงุช ุฒุงุฆุฏุฉ | 25.00 |
| `delayPenalty` | ุนุฏุฏ ุนุดุฑู | ุฎุตู ุงูุชุฃุฎูุฑ | 200.00 |
| `previousSettlement` | ุนุฏุฏ ุนุดุฑู | ุชุณููุฉ ุณุงุจูุฉ (ููุดูุฑู) | 0.00 ุฃู 2550.00 |
| `totalDeductions` | ุนุฏุฏ ุนุดุฑู | ุฅุฌูุงูู ุงูุฎุตููุงุช | 1025.00 |
| **ุงููุชูุฌุฉ** |||
| `netAmount` | ุนุฏุฏ ุนุดุฑู | ุงูุตุงูู ุงููุณุชุญู | 2495.00 |
| **ุงูุจูุงูุงุช ุงูุฅุถุงููุฉ** |||
| `paymentMethod` | ูุต | ุทุฑููุฉ ุงูุฏูุน | "BANK_TRANSFER" |
| `paymentDate` | ุชุงุฑูุฎ | ุชุงุฑูุฎ ุงูุตุฑู ุงููุนูู | 2024-10-15 |
| `isPaid` | Boolean | ูู ุชู ุงูุตุฑู | true |
| `notes` | ูุต | ููุงุญุธุงุช | "ุชุณููุฉ ูุตู ุดูุฑูุฉ" |
| `createdBy` | ุฑูู ุตุญูุญ | ูู ุฃูุดุฃูุง | 1 |
| `approvedBy` | ุฑูู ุตุญูุญ | ูู ุงุนุชูุฏูุง | 2 |
| `createdAt` | ุชุงุฑูุฎ ูููุช | ุชุงุฑูุฎ ุงูุฅูุดุงุก | 2024-10-15 |
| `updatedAt` | ุชุงุฑูุฎ ูููุช | ุชุงุฑูุฎ ุขุฎุฑ ุชุนุฏูู | 2024-10-15 |

### **ุงูุนูุงูุงุช:**
- `employeeId` โ ูุดูุฑ ุฅูู `Employee`
- `createdBy` โ ูุดูุฑ ุฅูู `User`
- `approvedBy` โ ูุดูุฑ ุฅูู `User`

### **ุงููููุฏ:**
- `type` ูุฌุจ ุฃู ูููู: "MID_MONTH" ุฃู "MONTHLY"
- `month` ูุฌุจ ุฃู ูููู ุจูู 1 ู 12
- `netAmount` = `totalEarnings` - `totalDeductions`

---

## 5๏ธโฃ PayrollReport

### **ุงูุบุฑุถ:**
ุชุฎุฒูู ุงูุชูุงุฑูุฑ ุงูููุตุฏุฑุฉ ููุฑุฌูุน ุฅูููุง ูุงุญูุงู.

### **ุงูุญููู ุงููุทููุจุฉ:**

| ุงูุญูู | ุงูููุน | ุงููุตู | ูุซุงู |
|-------|------|-------|------|
| `id` | ุฑูู ุตุญูุญ | ุงููุนุฑู ุงููุฑูุฏ | 1 |
| `employeeId` | ุฑูู ุตุญูุญ | ูุนุฑู ุงูููุธู (NULL ููุชูุงุฑูุฑ ุงูุฌูุงุนูุฉ) | 5 ุฃู NULL |
| `settlementId` | ุฑูู ุตุญูุญ | ูุนุฑู ุงูุชุณููุฉ (ุงุฎุชูุงุฑู) | 10 |
| `reportType` | ูุต | ููุน ุงูุชูุฑูุฑ | "EMPLOYEE" ุฃู "ADMIN" ุฃู "GROUP" |
| `month` | ุฑูู ุตุญูุญ | ุงูุดูุฑ | 10 |
| `year` | ุฑูู ุตุญูุญ | ุงูุณูุฉ | 2024 |
| `reportData` | JSON | ุจูุงูุงุช ุงูุชูุฑูุฑ ุงููุงููุฉ | (ุงูุธุฑ ุฃุฏูุงู) |
| `fileUrl` | ูุต | ุฑุงุจุท ุงูููู (PDF/Excel) | "/reports/salary-oct-2024.pdf" |
| `generatedBy` | ุฑูู ุตุญูุญ | ูู ุฃุตุฏุฑ ุงูุชูุฑูุฑ | 1 |
| `generatedAt` | ุชุงุฑูุฎ ูููุช | ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ | 2024-10-31 |

### **ูููู reportData (JSON):**

```json
{
  "employee": {
    "id": 5,
    "name": "ุฃุญูุฏ ูุญูุฏ ุนูู",
    "position": "ูููุฏุณ ูููุน"
  },
  "period": {
    "from": "2024-10-01",
    "to": "2024-10-31",
    "workDays": 28,
    "leaveDays": 3
  },
  "earnings": {
    "basicSalary": 5600,
    "allowances": 1000,
    "bonuses": 400,
    "materialAllowance": 520
  },
  "deductions": {
    "advances": 1400,
    "materialDeductions": 65,
    "delayPenalty": 600
  },
  "netAmount": 5455
}
```

---

## ๐ ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ ุงููุณุชุฎุฏูุฉ

### **Employee:**
- `id`: ูุนุฑู ุงูููุธู
- `name`: ุงูุงุณู
- `salary`: ุงูุฑุงุชุจ ุงูุฃุณุงุณู
- `position`: ุงููุธููุฉ
- `hireDate`: ุชุงุฑูุฎ ุงูุชุนููู
- `status`: ุญุงูุฉ ุงูููุธู (ACTIVE, SUSPENDED, FORMER)

### **HR_Transaction:**
- `id`: ูุนุฑู ุงููุนุงููุฉ
- `type`: ููุน ุงููุนุงููุฉ ("ADVANCE" ุฃู "MATERIAL_WITHDRAWAL")
- `employeeId`: ูุนุฑู ุงูููุธู
- `date`: ุชุงุฑูุฎ ุงููุนุงููุฉ
- `amount`: ุงููุจูุบ (ููุณูู)
- `items`: ุงูุฃุตูุงู (ูููุณุญูุจุงุช)
- `status`: ุงูุญุงูุฉ

### **HR_EmployeeLeave:**
- `id`: ูุนุฑู ุงูุฅุฌุงุฒุฉ
- `employeeId`: ูุนุฑู ุงูููุธู
- `leaveType`: ููุน ุงูุฅุฌุงุฒุฉ
- `startDate`: ุชุงุฑูุฎ ุงูุจุฏุงูุฉ
- `endDate`: ุชุงุฑูุฎ ุงูููุงูุฉ
- `totalDays`: ุนุฏุฏ ุงูุฃูุงู
- `status`: ุงูุญุงูุฉ ("APPROVED" ููุท ุชูุญุณุจ)

### **HR_AdvanceItem:**
- `id`: ูุนุฑู ุงูุตูู
- `name`: ุงุณู ุงูุตูู
- `price`: ุงูุณุนุฑ
- `unit`: ุงููุญุฏุฉ
- `isActive`: ุญุงูุฉ ุงููุดุงุท

---

## ๐ ุงูุนูุงูุงุช ุจูู ุงูุฌุฏุงูู

```
Employee
  โโโ PayrollSettings_Employee (1:1)
  โโโ HR_MonthlyBonus (1:Many)
  โโโ HR_PayrollSettlement (1:Many)
  โโโ PayrollReport (1:Many)
  โโโ HR_Transaction (1:Many)
  โโโ HR_EmployeeLeave (1:Many)

PayrollSettings_Position
  โโโ (ูุฑุชุจุท ุจุงูููุธููู ุนุจุฑ position)

HR_PayrollSettlement
  โโโ PayrollReport (1:1 optional)

HR_Transaction
  โโโ HR_AdvanceItem (Many:Many ุนุจุฑ items)
```

---

## ๐ ุงูููุงุฑุณ ุงูููุชุฑุญุฉ (Indexes)

### **ููุฃุฏุงุก:**

1. **PayrollSettings_Position:**
   - `positionCode` (ูุฑูุฏ)

2. **PayrollSettings_Employee:**
   - `employeeId` (ูุฑูุฏ)

3. **HR_MonthlyBonus:**
   - `employeeId`
   - `isActive`
   - `startDate`, `endDate`

4. **HR_PayrollSettlement:**
   - `employeeId`
   - `month`, `year`
   - `type`
   - `isPaid`

5. **PayrollReport:**
   - `employeeId`
   - `month`, `year`
   - `reportType`

---

## โ๏ธ ุงููููุฏ (Constraints)

### **PayrollSettings_Position:**
- `positionCode` ูุฑูุฏ
- `allowances` โฅ 0

### **HR_MonthlyBonus:**
- `amount` > 0
- `type` ูู ("PERMANENT", "TEMPORARY")
- ุฅุฐุง `type` = "TEMPORARY" ูู `endDate` ูุทููุจ

### **HR_PayrollSettlement:**
- `type` ูู ("MID_MONTH", "MONTHLY")
- `month` ุจูู 1 ู 12
- `year` โฅ 2024
- `workDays` โฅ 0
- `netAmount` = `totalEarnings` - `totalDeductions`

---

## ๐ฏ ููุงุญุธุงุช ุงูุชุตููู

### **1. ุงููุตู ุจูู ุงูุฅุนุฏุงุฏุงุช ูุงูุจูุงูุงุช:**
- ุฅุนุฏุงุฏุงุช ุงูุฑูุงุชุจ ูููุตูุฉ (Position/Employee)
- ุงูุจูุงูุงุช ุงููุนููุฉ ูู HR_Transaction
- ุงูุชุณููุงุช ูููุตูุฉ ูู HR_PayrollSettlement

### **2. ุงููุฑููุฉ:**
- ุฅุนุฏุงุฏุงุช ุงูููุธู ุชูุบู ุฅุนุฏุงุฏุงุช ุงููุธููุฉ
- ุงูููุงูุขุช ูููู ุฃู ุชููู ุฏุงุฆูุฉ ุฃู ูุคูุชุฉ
- ุงูุชูุงุฑูุฑ ุชูุญูุธ ููุฑุฌูุน ุฅูููุง

### **3. ุงูุชุชุจุน:**
- ูู ุนูููุฉ ููุง `createdBy` ู `approvedBy`
- ูู ุณุฌู ูู `createdAt` ู `updatedAt`
- ุญุงูุฉ ูู ุนูููุฉ ูุญููุธุฉ (`isActive`, `isPaid`)

---

## โก๏ธ ุงูุฎุทูุฉ ุงูุชุงููุฉ

ูููู ูุงุฌูุงุช ุงููุณุชุฎุฏูุ ุงูุชูู ุฅูู:

**[09 - ูุงุฌูุงุช ุงููุณุชุฎุฏู](./09_ูุงุฌูุงุช_ุงููุณุชุฎุฏู.md)**

---

[โฌ๏ธ ุงูุณุงุจู: ุงูุชูุงุฑูุฑ ูุงูุฅุดุนุงุฑุงุช](./07_ุงูุชูุงุฑูุฑ_ูุงูุฅุดุนุงุฑุงุช.md) | [๐ ุงูููุฑุณ](./00_ุงูููุฑุณ.md) | [โก๏ธ ุงูุชุงูู: ูุงุฌูุงุช ุงููุณุชุฎุฏู](./09_ูุงุฌูุงุช_ุงููุณุชุฎุฏู.md)
