# 05 - الخصومات والسلف

## 📖 نظرة عامة

الخصومات هي المبالغ التي تُطرح من راتب الموظف، وتشمل عدة أنواع لكل منها قواعد حساب خاصة.

---

## ➖ أنواع الخصومات

### النظام يتعامل مع ثلاثة أنواع من الخصومات:

1. **السلف النقدية** (Cash Advances)
2. **خصم المسحوبات الزائدة** (Excess Material Deductions)
3. **خصومات التأخير** (Delay Penalties)

---

## 1️⃣ السلف النقدية (Cash Advances)

### **التعريف:**
مبالغ مالية نقدية يتم صرفها للموظف قبل موعد راتبه، وتُخصم لاحقاً من راتبه.

### **مصدر البيانات:**

```
جدول: HR_Transaction
─────────────────────────────────
type: "ADVANCE"
employeeId: معرف الموظف
date: تاريخ السلفة
amount: المبلغ
description: الغرض من السلفة
status: "APPROVED"
```

---

### **قواعد الخصم:**

#### **أ) الخصم في التسوية النصف شهرية:**

```
تُخصم السلف الواقعة في الفترة (1-15) فقط

مثال:
- سلفة يوم 5 أكتوبر: 500 جنيه ✅ تُخصم
- سلفة يوم 12 أكتوبر: 300 جنيه ✅ تُخصم
- سلفة يوم 20 أكتوبر: 400 جنيه ❌ لا تُخصم

إجمالي المخصوم في التسوية = 800 جنيه
```

#### **ب) الخصم في الراتب الشهري (بعد تسوية سابقة):**

```
تُخصم السلف الواقعة في الفترة (16-30) فقط
(السلف من 1-15 تم خصمها في التسوية)

مثال:
- سلفة يوم 20 أكتوبر: 400 جنيه ✅ تُخصم
- سلفة يوم 28 أكتوبر: 200 جنيه ✅ تُخصم

إجمالي المخصوم = 600 جنيه
```

#### **ج) الخصم في الراتب الشهري (بدون تسوية سابقة):**

```
تُخصم جميع سلف الشهر (1-30)

مثال:
- سلفة يوم 5: 500 جنيه ✅
- سلفة يوم 12: 300 جنيه ✅
- سلفة يوم 20: 400 جنيه ✅
- سلفة يوم 28: 200 جنيه ✅

إجمالي المخصوم = 1400 جنيه
```

---

### **حالات خاصة:**

#### **الحالة 1: السلف أكبر من الراتب**

```
الراتب الصافي (قبل خصم السلف): 2000 جنيه
إجمالي السلف: 3000 جنيه

النتيجة:
- يُخصم كامل الراتب: 2000 جنيه
- الباقي (1000 جنيه) يُرحّل للشهر التالي
- الموظف لا يستلم شيئاً هذا الشهر
```

#### **الحالة 2: عدة سلف متراكمة**

```
سلف شهر أكتوبر:
- 5 أكتوبر: 500 جنيه
- 12 أكتوبر: 300 جنيه
- 18 أكتوبر: 400 جنيه
- 25 أكتوبر: 600 جنيه
إجمالي: 1800 جنيه

راتب أكتوبر:
- المستحقات: 7000 جنيه
- خصومات أخرى: 1000 جنيه
- السلف: 1800 جنيه
- الصافي: 7000 - 1000 - 1800 = 4200 جنيه ✓
```

---

### **أمثلة تفصيلية:**

#### **مثال 1: سلف في تسوية نصف شهرية**

```
═══════════════════════════════════════════════
      سلف الفترة (1-15 أكتوبر)
═══════════════════════════════════════════════

📅 تاريخ     💰 المبلغ      📝 الغرض
─────────────────────────────────────────────
3 أكتوبر     500 جنيه      احتياجات شخصية
8 أكتوبر     300 جنيه      مصاريف عائلية
12 أكتوبر    200 جنيه      طوارئ
─────────────────────────────────────────────
الإجمالي     1000 جنيه

───────────────────────────────────────────────
في التسوية النصف شهرية:
───────────────────────────────────────────────

المستحقات: 3500 جنيه
الخصومات الأخرى: 200 جنيه
السلف: 1000 جنيه ❌
─────────────────────────────────────────────
الصافي: 3500 - 200 - 1000 = 2300 جنيه ✓

═══════════════════════════════════════════════
```

#### **مثال 2: سلف موزعة على فترتين**

```
═══════════════════════════════════════════════
         سلف شهر أكتوبر الكامل
═══════════════════════════════════════════════

الفترة الأولى (1-15):
├─ 5 أكتوبر: 500 جنيه
├─ 10 أكتوبر: 300 جنيه
└─ إجمالي: 800 جنيه

الفترة الثانية (16-30):
├─ 18 أكتوبر: 400 جنيه
├─ 25 أكتوبر: 600 جنيه
└─ إجمالي: 1000 جنيه

───────────────────────────────────────────────
التسوية النصف شهرية (15 أكتوبر):
───────────────────────────────────────────────
تُخصم سلف الفترة الأولى فقط = 800 جنيه ❌

───────────────────────────────────────────────
الراتب الشهري (31 أكتوبر):
───────────────────────────────────────────────
تُخصم سلف الفترة الثانية فقط = 1000 جنيه ❌
(الأولى تم خصمها في التسوية)

═══════════════════════════════════════════════
```

---

## 2️⃣ خصم المسحوبات الزائدة

### **التعريف:**
قيمة المسحوبات العينية التي تجاوزت استحقاق الموظف.

### **قاعدة الحساب:**

```
إذا: المسحوب > المستحق
  خصم الزائد = (المسحوب - المستحق) × السعر

إذا: المسحوب ≤ المستحق
  خصم = 0
```

### **أمثلة:**

#### **مثال 1: زيادة بسيطة**

```
الصنف: سجائر
الاستحقاق: 2 علبة/يوم
أيام العمل: 15 يوم
المستحق: 30 علبة

المسحوب: 35 علبة
الزيادة: 5 علب
السعر: 10 جنيه

خصم الزائد = 5 × 10 = 50 جنيه ❌
```

#### **مثال 2: زيادة في عدة أصناف**

```
═══════════════════════════════════════════════

صنف 1: سجائر
- مستحق: 30 علبة
- مسحوب: 35 علبة
- زيادة: 5 علب
- سعر: 10 جنيه
- خصم: 5 × 10 = 50 جنيه ❌

صنف 2: مشروبات
- مستحق: 15 زجاجة
- مسحوب: 20 زجاجة
- زيادة: 5 زجاجات
- سعر: 5 جنيه
- خصم: 5 × 5 = 25 جنيه ❌

إجمالي خصم الزيادة = 50 + 25 = 75 جنيه ❌

═══════════════════════════════════════════════
```

---

## 3️⃣ خصومات التأخير (Delay Penalties)

### **التعريف:**
خصومات تُطبق على الموظف المتأخر عن موعد العمل، بناءً على نظام تراكمي.

### **النظام التراكمي:**

```
┌────────────────────────────────────────────┐
│  اليوم الأول من التأخير:  خصم يوم واحد   │
├────────────────────────────────────────────┤
│  اليوم الثاني:           خصم يومين        │
│  (إجمالي تراكمي: 3 أيام)                  │
├────────────────────────────────────────────┤
│  اليوم الثالث:           خصم 3 أيام       │
│  (إجمالي تراكمي: 6 أيام)                  │
├────────────────────────────────────────────┤
│  اليوم الرابع:           خصم 7 أيام       │
│  (إجمالي تراكمي: 13 يوم)                  │
├────────────────────────────────────────────┤
│  اليوم الخامس:           خصم 15 يوم       │
│  (إجمالي تراكمي: 28 يوم ≈ شهر)           │
├────────────────────────────────────────────┤
│  اليوم السادس وما بعد:   إيقاف الموظف    │
│  (حالته تتغير إلى SUSPENDED)              │
└────────────────────────────────────────────┘
```

### **قاعدة الحساب:**

```
خصم اليوم = الراتب اليومي × عدد أيام الخصم

الراتب اليومي = الراتب الأساسي ÷ 30
```

---

### **أمثلة تفصيلية:**

#### **مثال 1: تأخر يوم واحد**

```
═══════════════════════════════════════════════
الراتب الأساسي: 6000 جنيه
الراتب اليومي = 6000 ÷ 30 = 200 جنيه

التأخر: يوم واحد (اليوم الأول)
الخصم: يوم واحد

قيمة الخصم = 200 × 1 = 200 جنيه ❌
═══════════════════════════════════════════════
```

#### **مثال 2: تأخر يومين منفصلين**

```
═══════════════════════════════════════════════
الراتب الأساسي: 6000 جنيه
الراتب اليومي = 200 جنيه

التأخر الأول (5 أكتوبر):
- اليوم الأول من التأخير
- خصم: 1 يوم = 200 جنيه ❌

التأخر الثاني (12 أكتوبر):
- اليوم الثاني من التأخير (تراكمي)
- خصم: 2 يوم = 400 جنيه ❌

إجمالي الخصم = 200 + 400 = 600 جنيه ❌
إجمالي تراكمي = 3 أيام
═══════════════════════════════════════════════
```

#### **مثال 3: تأخر متكرر (حالة خطيرة)**

```
═══════════════════════════════════════════════
الراتب الأساسي: 6000 جنيه
الراتب اليومي = 200 جنيه

┌───────────────────────────────────────────┐
│ اليوم 1 (3 أكتوبر):                       │
│ خصم: 1 يوم = 200 جنيه                    │
│ تراكمي: 1 يوم                            │
├───────────────────────────────────────────┤
│ اليوم 2 (8 أكتوبر):                       │
│ خصم: 2 يوم = 400 جنيه                    │
│ تراكمي: 3 أيام                           │
├───────────────────────────────────────────┤
│ اليوم 3 (12 أكتوبر):                      │
│ خصم: 3 أيام = 600 جنيه                   │
│ تراكمي: 6 أيام                           │
├───────────────────────────────────────────┤
│ اليوم 4 (18 أكتوبر):                      │
│ خصم: 7 أيام = 1400 جنيه                  │
│ تراكمي: 13 يوم                           │
├───────────────────────────────────────────┤
│ اليوم 5 (25 أكتوبر):                      │
│ خصم: 15 يوم = 3000 جنيه                  │
│ تراكمي: 28 يوم (شهر كامل تقريباً!)       │
└───────────────────────────────────────────┘

إجمالي الخصم = 200 + 400 + 600 + 1400 + 3000
             = 5600 جنيه ❌❌❌

⚠️ تحذير: راتب الموظف بالكامل 6000 جنيه!
═══════════════════════════════════════════════
```

#### **مثال 4: إيقاف الموظف**

```
═══════════════════════════════════════════════
إذا تأخر الموظف 6 مرات أو أكثر:
═══════════════════════════════════════════════

❌ يتم تغيير حالة الموظف إلى: SUSPENDED
❌ لا يتم حساب راتب له
❌ يحتاج قرار إداري لإعادة تفعيله

هذا إجراء حماية من الخصومات المفرطة
═══════════════════════════════════════════════
```

---

## 📊 ملخص الخصومات

### جدول مقارنة:

| نوع الخصم | كيف يُحسب | متى يُطبق | قابل للترحيل |
|-----------|-----------|----------|--------------|
| **السلف** | المبلغ كاملاً | في نفس الشهر | ✅ نعم |
| **المسحوبات الزائدة** | (الزيادة × السعر) | في نفس الفترة | ❌ لا |
| **التأخير** | (الأيام × الراتب اليومي) | تراكمي | ❌ لا |

---

## 🔄 ترحيل الخصومات

### **متى يحدث الترحيل؟**

```
الراتب الصافي (قبل الخصومات): 3000 جنيه
إجمالي الخصومات: 4000 جنيه

النتيجة:
- يُخصم كامل الراتب: 3000 جنيه
- الباقي (1000 جنيه) يُرحّل للشهر التالي
- الموظف لا يستلم راتباً هذا الشهر
```

### **كيف يُعالج الترحيل؟**

```
في الشهر التالي:

الراتب الصافي الجديد: 5000 جنيه
الخصومات المرحّلة: 1000 جنيه
خصومات الشهر الحالي: 500 جنيه

إجمالي الخصومات: 1500 جنيه
الصافي المستحق: 5000 - 1500 = 3500 جنيه ✓
```

---

## 📝 مثال شامل للخصومات

```
═══════════════════════════════════════════════
   إجمالي الخصومات - راتب أكتوبر 2024
═══════════════════════════════════════════════

👤 الموظف: أحمد محمد علي
💰 الراتب الأساسي: 6000 جنيه
📅 الفترة: 1-30 أكتوبر

───────────────────────────────────────────────
1️⃣ السلف النقدية:
───────────────────────────────────────────────
5 أكتوبر:      500 جنيه
12 أكتوبر:     300 جنيه
20 أكتوبر:     400 جنيه
28 أكتوبر:     200 جنيه
                ──────────────
الإجمالي:      1400 جنيه ❌

───────────────────────────────────────────────
2️⃣ خصم المسحوبات الزائدة:
───────────────────────────────────────────────
سجائر (زيادة 5 علب × 10):      50 جنيه
مشروبات (زيادة 3 زجاجات × 5):  15 جنيه
                                ──────────────
الإجمالي:                       65 جنيه ❌

───────────────────────────────────────────────
3️⃣ خصومات التأخير:
───────────────────────────────────────────────
3 أكتوبر (يوم 1):    1 × 200 = 200 جنيه
10 أكتوبر (يوم 2):   2 × 200 = 400 جنيه
                                ──────────────
الإجمالي:                       600 جنيه ❌

───────────────────────────────────────────────
💰 إجمالي جميع الخصومات:
───────────────────────────────────────────────

السلف:                          1400 جنيه
المسحوبات الزائدة:              65 جنيه
التأخير:                        600 جنيه
                                ══════════════
الإجمالي:                       2065 جنيه ❌

═══════════════════════════════════════════════
```

---

## ⚠️ تحذيرات مهمة

### **1. السلف المتراكمة:**
```
⚠️ إذا تراكمت السلف على الموظف:
- قد لا يستلم راتباً لعدة أشهر
- يجب وضع حد أقصى للسلف المسموحة
- يُنصح بمراقبة السلف شهرياً
```

### **2. التأخير المتكرر:**
```
⚠️ التأخير المتكرر يؤدي إلى:
- خصومات كبيرة جداً
- احتمال فقدان الراتب بالكامل
- إيقاف الموظف بعد 6 مرات
```

### **3. المسحوبات الزائدة:**
```
⚠️ المسحوبات الزائدة:
- تُخصم فوراً من الراتب
- لا يمكن ترحيلها
- يجب منع السحب الزائد من البداية
```

---

## ➡️ الخطوة التالية

لفهم كيفية حساب أيام العمل، انتقل إلى:

**[06 - قواعد حساب أيام العمل](./06_قواعد_حساب_أيام_العمل.md)**

---

[⬅️ السابق: المسحوبات العينية](./04_المسحوبات_العينية.md) | [🏠 الفهرس](./00_الفهرس.md) | [➡️ التالي: قواعد حساب أيام العمل](./06_قواعد_حساب_أيام_العمل.md)
