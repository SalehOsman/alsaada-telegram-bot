# ๐ต ูุธุงู ุงููุนุงููุงุช ูุงูุชุณููุงุช - ุงูุชูุซูู ุงููุงูู
## Transactions and Settlements System - Complete Documentation

> **ุขุฎุฑ ุชุญุฏูุซ:** 7 ููููุจุฑ 2025  
> **ุงูุฅุตุฏุงุฑ:** 3.0  
> **ุงูุญุงูุฉ:** ูุธุงู ูุงูู ูุฌุงูุฒ ููุฅูุชุงุฌ

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ูุธุฑุฉ ุนุงูุฉ](#-ูุธุฑุฉ-ุนุงูุฉ)
2. [ุฃููุงุน ุงููุนุงููุงุช ุงููุงููุฉ](#-ุฃููุงุน-ุงููุนุงููุงุช-ุงููุงููุฉ)
3. [ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ](#-ุงููุธุงุฆู-ุงูุฑุฆูุณูุฉ)
   - [ุฅุถุงูุฉ ูุนุงููุฉ ุฌุฏูุฏุฉ](#1-ุฅุถุงูุฉ-ูุนุงููุฉ-ุฌุฏูุฏุฉ)
   - [ุงูููุงููุฉ ุนูู ุงููุนุงููุงุช](#2-ุงูููุงููุฉ-ุนูู-ุงููุนุงููุงุช)
   - [ุนุฑุถ ุงููุนุงููุงุช](#3-ุนุฑุถ-ุงููุนุงููุงุช)
   - [ุฅุฏุงุฑุฉ ุฃุตูุงู ุงููุณุญูุจุงุช](#4-ุฅุฏุงุฑุฉ-ุฃุตูุงู-ุงููุณุญูุจุงุช-ุงูุนูููุฉ)
4. [ูุธุงู ุงูุชุณููุงุช (Settlements)](#-ูุธุงู-ุงูุชุณููุงุช-settlements)
5. [ุณุฌู ุงูุชุบููุฑุงุช (Audit Log)](#-ุณุฌู-ุงูุชุบููุฑุงุช-audit-log)
6. [ุงูุชูุงูู ูุน ูุธุงู ุงูุฑูุงุชุจ](#-ุงูุชูุงูู-ูุน-ูุธุงู-ุงูุฑูุงุชุจ)
7. [ุงููููุงุช ุงูุจุฑูุฌูุฉ ุงููุฑุชุจุทุฉ](#-ุงููููุงุช-ุงูุจุฑูุฌูุฉ-ุงููุฑุชุจุทุฉ)
8. [ุงูุฌุฏุงูู ุงููุฑุชุจุทุฉ ุจูุงุนุฏุฉ ุงูุจูุงูุงุช](#-ุงูุฌุฏุงูู-ุงููุฑุชุจุทุฉ-ุจูุงุนุฏุฉ-ุงูุจูุงูุงุช)

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงููุนุงููุงุช ูุงูุชุณููุงุช ูู ูุธุงู ูุงูู ุฏููู ูุตูู ูุฅุฏุงุฑุฉ ุฌููุน ุงูุญุฑูุงุช ุงููุงููุฉ ููููุธููู ุฎุงุฑุฌ ูุทุงู ุงูุฑุงุชุจ ุงูุฃุณุงุณู. ูุชูุญ ุงููุธุงู ุชุณุฌูู ููุชุงุจุนุฉ ุงูุณูู ุงูููุฏูุฉุ ูุงููุณุญูุจุงุช ุงูุนูููุฉุ ูุงูุฏูููุ ููููุฑ ุขููุฉ ูููุฉ ูุชุณููุชูุง ูุฎุตููุง ูู ุงูุฑูุงุชุจ ุชููุงุฆููุง.

### โจ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:

- โ **ุฃููุงุน ูุชุนุฏุฏุฉ:** ูุฏุนู ุงูุณูู ุงูููุฏูุฉุ ุงููุณุญูุจุงุช ุงูุนูููุฉุ ูุฏููู ุงูููุธููู.
-  approval **ุฏูุฑุฉ ููุงููุงุช:** ุชุชุทูุจ ุงููุนุงููุงุช ููุงููุฉ ูู ุงููุฏูุฑ ูุจู ุชูุนูููุง.
- ๐ฆ **ุฃุตูุงู ูุงุจูุฉ ููุชุฎุตูุต:** ุฅุฏุงุฑุฉ ูุงููุฉ ููุฃุตูุงู ุงูุนูููุฉ ุงูุชู ูููู ููููุธููู ุณุญุจูุง.
- ๐ **ูุธุงู ุชุณููุงุช ูุฑู:** ุชุณููุฉ ุงููุนุงููุงุช ุจุดูู ูุฑุฏู ุฃู ุฌูุงุนู.
- ๐ **ุชุฏููู ูุงูู:** ุณุฌู ุชุบููุฑุงุช ููุตู ูุชุชุจุน ูู ุชุนุฏูู ูุชู ุนูู ุฃู ูุนุงููุฉ.
- ๐ค **ุชูุงูู ุชููุงุฆู:** ุฑุจุท ูุจุงุดุฑ ูุน ูุธุงู ุงูุฑูุงุชุจ ูุฎุตู ุงููุณุชุญูุงุช ุชููุงุฆููุง.

---

## ๐ฐ ุฃููุงุน ุงููุนุงููุงุช ุงููุงููุฉ

ูุชู ุชุนุฑูู ุฃููุงุน ุงููุนุงููุงุช ูู `TransactionType` enum:

| ุงูููุน | ุงูุฑูุฒ | ุงููุตู |
|---|---|---|
| **ุณููุฉ ููุฏูุฉ** | `CASH_ADVANCE` | ูุจูุบ ูุงูู ูุชู ููุญู ููููุธู ูุณููุฉ ูููุฎุตู ูู ุงูุฑุงุชุจ. |
| **ูุณุญูุจ ุนููู** | `ITEM_WITHDRAWAL` | ุณุญุจ ุตูู ูู ูููุฉ ูุงููุฉ (ูุซู ููุณ ุณุฌุงุฆุฑุ ูุฌุจุฉ) ููุชู ุฎุตู ูููุชู ูู ุงูุฑุงุชุจ. |
| **ุฏูู ุนูู ุงูุนุงูู** | `EMPLOYEE_DEBT` | ุชุณุฌูู ุฏูู ูุงุฆู ุนูู ุงูููุธู ููุชู ุฎุตูู ูุงุญููุง. |

---

## โ๏ธ ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ

### 1. ุฅุถุงูุฉ ูุนุงููุฉ ุฌุฏูุฏุฉ

**ุงูููู:** `transactions-new.handler.ts`

-   **ุงูุฎุทูุงุช (ููุณููุฉ ุงูููุฏูุฉ):**
    1.  ูุฎุชุงุฑ ุงููุฏูุฑ "ุฅุถุงูุฉ ุณููุฉ ููุฏูุฉ".
    2.  ูุฎุชุงุฑ ุงูููุธู.
    3.  ููุฏุฎู ูุจูุบ ุงูุณููุฉ.
    4.  ููุฏุฎู ุณุจุจ ุงูุณููุฉ (ุงุฎุชูุงุฑู).
    5.  ุชูุญูุธ ุงููุนุงููุฉ ุจุญุงูุฉ `PENDING` ูุชูุชุธุฑ ุงูููุงููุฉ.

-   **ุงูุฎุทูุงุช (ูููุณุญูุจ ุงูุนููู):**
    1.  ูุฎุชุงุฑ ุงููุฏูุฑ "ุฅุถุงูุฉ ูุณุญูุจ ุนููู".
    2.  ูุฎุชุงุฑ ุงูููุธู.
    3.  ุชุธูุฑ ูุงุฆูุฉ ุจุงูุฃุตูุงู ุงููุชุงุญุฉ ูุฃุณุนุงุฑูุง (ูู ุฌุฏูู `HR_AdvanceItem`).
    4.  ูุฎุชุงุฑ ุงูุตูู ูููุฏุฎู ุงููููุฉ.
    5.  ูุญุณุจ ุงููุธุงู ุงููููุฉ ุงูุฅุฌูุงููุฉ ุชููุงุฆููุง (`quantity * unitPrice`).
    6.  ุชูุญูุธ ุงููุนุงููุฉ ุจุญุงูุฉ `PENDING`.

### 2. ุงูููุงููุฉ ุนูู ุงููุนุงููุงุช

-   ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุฏุฑุงุก ุนูุฏ ุฅูุดุงุก ุฃู ูุนุงููุฉ ุฌุฏูุฏุฉ.
-   ูุฌุจ ุนูู ูุฏูุฑ ุจุตูุงุญูุฉ ุฃุนูู ูุฑุงุฌุนุฉ ุงููุนุงููุฉ ูุงูููุงููุฉ ุนูููุง (`APPROVE`) ุฃู ุฑูุถูุง (`REJECT`).
-   **ููุท ุงููุนุงููุงุช ุงููุนุชูุฏุฉ (`APPROVED`) ูู ุงูุชู ุชุฏุฎู ูู ุญุณุงุจุงุช ุงูุฑูุงุชุจ.**

### 3. ุนุฑุถ ุงููุนุงููุงุช

**ุงูููู:** `transactions-view.handler.ts`

ูููุฑ ุงููุธุงู ุนุฏุฉ ุทุฑู ูุนุฑุถ ุงููุนุงููุงุช:
-   **ุงููุนุงููุงุช ุงููุดุทุฉ:** ุนุฑุถ ุฌููุน ุงููุนุงููุงุช ุงููุนุชูุฏุฉ ุงูุชู ูู ุชุชู ุชุณููุชูุง ุจุนุฏ (`isSettled: false`).
-   **ุงููุนุงููุงุช ุงููุนููุฉ:** ุงููุนุงููุงุช ุงูุชู ุชูุชุธุฑ ุงูููุงููุฉ.
-   **ุณุฌู ุงููุนุงููุงุช:** ุนุฑุถ ุฌููุน ูุนุงููุงุช ููุธู ูุนูู ุฎูุงู ูุชุฑุฉ ุฒูููุฉ.

### 4. ุฅุฏุงุฑุฉ ุฃุตูุงู ุงููุณุญูุจุงุช ุงูุนูููุฉ

**ุงูููู:** `transactions-items.handler.ts`

-   ูุงุฌูุฉ ูุฎุตุตุฉ ูููุฏุฑุงุก ูุชุนุฑูู ุงูุฃุตูุงู ุงูุชู ูููู ููููุธููู ุณุญุจูุง.
-   **ุงูุฅุฌุฑุงุกุงุช:** ุฅุถุงูุฉุ ุชุนุฏููุ ุฃู ุญุฐู ุตูู.
-   **ุงูุญููู ููู ุตูู:** ุงุณู ุงูุตููุ ุงูุณุนุฑุ ุงููุญุฏุฉ (ููุณุ ุนูุจุฉุ ูุทุนุฉ).
-   ูุชู ุชุฎุฒูู ูุฐู ุงูุฃุตูุงู ูู ุฌุฏูู `HR_AdvanceItem`.

---

## ๐ ูุธุงู ุงูุชุณููุงุช (Settlements)

**ุงูููู:** `settlements.handler.ts`

ูุฐู ุงูููุฒุฉ ุงููุชูุฏูุฉ ุชุณูุญ ุจุฅุบูุงู ุฃู "ุชุณููุฉ" ุงููุนุงููุงุช ุงููุงููุฉุ ููู ูููุฏุฉ ุจุดูู ุฎุงุต ูู ููุงูุฉ ุงูุฎุฏูุฉ ุฃู ุนูุฏ ุชุณููุฉ ุงูุฏููู ุจุดูู ูููุตู ุนู ุงูุฑุงุชุจ.

-   **ุขููุฉ ุงูุนูู:**
    1.  ูุฎุชุงุฑ ุงููุฏูุฑ "ุชุณููุฉ ุงููุนุงููุงุช".
    2.  ูุฎุชุงุฑ ุงูููุธูุ ููุนุฑุถ ุงููุธุงู ุฌููุน ูุนุงููุงุชู ุงููุดุทุฉ.
    3.  ูุญุฏุฏ ุงููุฏูุฑ ุงููุนุงููุงุช ุงููุฑุงุฏ ุชุณููุชูุง (ูููู ุงุฎุชูุงุฑ ูุนุงููุฉ ูุงุญุฏุฉ ุฃู ุฃูุซุฑ).
    4.  ูุฎุชุงุฑ ููุน ุงูุชุณููุฉ (ูุงููุฉุ ุฌุฒุฆูุฉ).
    5.  ูุชู ุฅูุดุงุก ุณุฌู ูู `HR_TransactionSettlement`.
    6.  ูุชู ุชุญุฏูุซ ุงููุนุงููุงุช ุงูุฃุตููุฉ ูุชูุนูู ุนูุงูุฉ `isSettled: true`.

-   **ููุงุญุธุฉ:** ุงููุนุงููุงุช ุงูุชู ุชูุช ุชุณููุชูุง ูุง ูุชู ุฎุตููุง ูุฑุฉ ุฃุฎุฑู ูู ูุธุงู ุงูุฑูุงุชุจ.

---

## ๐ ุณุฌู ุงูุชุบููุฑุงุช (Audit Log)

**ุงูุฌุฏูู:** `HR_TransactionChangeLog`

ูุถูุงู ุงูุดูุงููุฉ ุงููุงููุฉ ุงููุงููุฉุ ูููู ุงููุธุงู ุจุชุณุฌูู ุฃู ุชุนุฏูู ูุชู ุนูู ูุนุงููุฉ ูุงููุฉ ุจุนุฏ ุฅูุดุงุฆูุง.

-   **ูุง ูุชู ุชุณุฌููู:**
    -   `transactionId`: ุงููุนุงููุฉ ุงูุชู ุชู ุชุนุฏูููุง.
    -   `changeType`: ููุน ุงูุชุบููุฑ (ุชุนุฏููุ ุญุฐู).
    -   `fieldName`, `oldValue`, `newValue`: ุงูุญูู ุงูุฐู ุชู ุชุบููุฑู ููููุชู ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ.
    -   `reason`: ุณุจุจ ุงูุชุนุฏูู (ููุทูุจ ูู ุงููุฏูุฑ ุฅุฏุฎุงูู).
    -   `changedBy`: ุงููุณุชุฎุฏู ุงูุฐู ูุงู ุจุงูุชุนุฏูู.

---

## ๐ ุงูุชูุงูู ูุน ูุธุงู ุงูุฑูุงุชุจ

ุงูุชูุงูู ุจูู ุงููุนุงููุงุช ูุงูุฑูุงุชุจ ูู ุชูุงูู **ุชููุงุฆู ููุจุงุดุฑ**.

-   **ุขููุฉ ุงูุฎุตู:**
    1.  ุนูุฏ ุชุดุบูู `payroll-calculate.handler.ts` ูุญุณุงุจ ุฑุงุชุจ ููุธู.
    2.  ูููู ุงููุธุงู ุจุงูุจุญุซ ูู ุฌุฏูู `HR_Transaction` ุนู ุฌููุน ุงููุนุงููุงุช ุงูุชู ุชุฎุต ูุฐุง ุงูููุธู ูุชููู ุญุงูุชูุง:
        -   `status: 'APPROVED'` (ูุนุชูุฏุฉ).
        -   `isSettled: false` (ูู ุชุชู ุชุณููุชูุง ุจุนุฏ).
    3.  ูุชู ุฌูุน ููู ูุฐู ุงููุนุงููุงุช ูุฎุตููุง ูู ุตุงูู ุงูุฑุงุชุจ.

---

## ๐ ุงููููุงุช ุงูุจุฑูุฌูุฉ ุงููุฑุชุจุทุฉ

| ุงูููู | ุงููุตู |
|---|---|
| `transactions-new.handler.ts` | ูุงุฌูุฉ ุฅุถุงูุฉ ุงูุณูู ูุงููุณุญูุจุงุช ุงูุฌุฏูุฏุฉ. |
| `transactions-view.handler.ts` | ูุงุฌูุงุช ุนุฑุถ ุงููุนุงููุงุช (ุงููุดุทุฉุ ุงููุนููุฉุ ุณุฌู ุงูููุธู). |
| `transactions-reports.handler.ts` | ุฅูุดุงุก ูุชุตุฏูุฑ ุชูุงุฑูุฑ ุงููุนุงููุงุช. |
| `transactions-items.handler.ts` | ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุฃุตูุงู ุงููุณุญูุจุงุช ุงูุนูููุฉ. |
| `settlements.handler.ts` | ูุธุงู ุงูุชุณููุงุช ุงููุชูุฏู ูููุนุงููุงุช. |

---

## ๐๏ธ ุงูุฌุฏุงูู ุงููุฑุชุจุทุฉ ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

-   **`HR_Transaction`**: ุงูุฌุฏูู ุงูุฑุฆูุณู ูุฌููุน ุงููุนุงููุงุช ุงููุงููุฉ.
    -   **ุญููู ูููุฉ:** `transactionType`, `status`, `amount`, `isSettled`.
-   **`HR_AdvanceItem`**: ุฌุฏูู ุงูุฃุตูุงู ุงูุนูููุฉ ูุฃุณุนุงุฑูุง.
-   **`HR_TransactionSettlement`**: ูุณุฌู ุนูููุงุช ุงูุชุณููุฉ ุงูุชู ุชุชู ุนูู ุงููุนุงููุงุช.
-   **`HR_TransactionChangeLog`**: ุณุฌู ุงูุชุฏููู ุงูุฐู ูุชุชุจุน ุฌููุน ุงูุชุบููุฑุงุช ุนูู ุงููุนุงููุง