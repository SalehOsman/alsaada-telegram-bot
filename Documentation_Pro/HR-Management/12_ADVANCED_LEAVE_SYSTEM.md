# 12. نظام الإجازات المتقدم (Advanced Leave System)

---

## مقدمة

نظام الإجازات المتقدم هو أحد الأنظمة المحورية في إدارة الموارد البشرية، ويهدف إلى أتمتة جميع عمليات إدارة الإجازات بأنواعها (اعتيادية، مرضية، طارئة، بدون أجر)، مع دعم التأجيل، التسوية النقدية، الجدولة الزمنية، والتقارير التفصيلية.

---

## الأهداف الرئيسية للنظام
- إدارة جميع أنواع الإجازات للموظفين بدقة ومرونة.
- دعم تأجيل الإجازات، التسوية النقدية، وتسجيل العودة.
- توفير جدول زمني مرئي للإجازات.
- تصدير تقارير الإجازات للإدارة.
- سجل تاريخي كامل لكل موظف.

---

## الهيكل العام للنظام

- **Handlers رئيسية:**
  - leaves.handler.ts
  - leaves-add.handler.ts
  - leaves-edit.handler.ts
  - leaves-delete.handler.ts
  - leaves-postpone.handler.ts
  - leaves-return.handler.ts
  - leaves-list.handler.ts
  - leaves-employee.handler.ts
  - leaves-reports.handler.ts
  - leaves-schedule.handler.ts
  - leaves-schedule-filters.handler.ts
  - leaves-allowance.handler.ts
  - leaves-cash-settlements.handler.ts
- **الجداول المرتبطة:**
  - HR_Leave
  - HR_LeaveType
  - HR_LeaveSettlement
  - HR_LeaveSchedule
  - HR_LeaveAuditLog
- **Enums:**
  - LeaveType
  - LeaveStatus
  - LeaveSettlementType

---

## 1. إدارة الإجازات (Leave Management)

### الوظيفة:
- إضافة، تعديل، حذف، أو تأجيل إجازة لأي موظف.
- تحديد نوع الإجازة (اعتيادية، مرضية، طارئة، بدون أجر).
- ربط الإجازة بالسياسات الداخلية (عدد الأيام، الحد الأقصى، إلخ).

### السيناريو:
1. اختيار الموظف.
2. تحديد نوع الإجازة والفترة.
3. النظام يتحقق من السياسات (رصيد الإجازات، الحد الأقصى، إلخ).
4. إضافة الإجازة أو رفضها مع توضيح السبب.

### مثال واجهة برمجية:
```
[إضافة إجازة]
- الموظف: أحمد علي
- النوع: اعتيادية
- من: 2025-11-10
- إلى: 2025-11-20
- الرصيد المتبقي: 12 يوم
[حفظ]
```

---

## 2. تأجيل الإجازات (Leave Postponement)

### الوظيفة:
- تأجيل إجازة مع الاحتفاظ بالرصيد أو تحويلها لنوع آخر.
- تسجيل سبب التأجيل وتوثيقه.

### السيناريو:
1. اختيار إجازة مؤجلة.
2. تحديد الفترة الجديدة وسبب التأجيل.
3. تحديث السجلات تلقائياً.

### مثال واجهة برمجية:
```
[تأجيل إجازة]
- الموظف: أحمد علي
- الإجازة الأصلية: 2025-11-10 إلى 2025-11-20
- الفترة الجديدة: 2025-12-01 إلى 2025-12-10
- السبب: ظروف العمل
[تأكيد التأجيل]
```

---

## 3. التسوية النقدية للإجازات (Leave Cash Settlement)

### الوظيفة:
- تحويل رصيد الإجازات إلى بدل نقدي.
- حساب القيمة حسب عدد الأيام والراتب الأساسي.
- ربط التسوية مع الرواتب الشهرية.

### السيناريو:
1. اختيار الموظف ونوع التسوية (كاملة/جزئية).
2. النظام يحسب القيمة النقدية.
3. إضافة التسوية إلى سجل الرواتب.

### مثال واجهة برمجية:
```
[تسوية نقدية للإجازة]
- الموظف: أحمد علي
- الرصيد: 10 أيام
- القيمة: 2000 ريال
[إضافة للتسوية]
```

---

## 4. تسجيل العودة من الإجازة (Leave Return)

### الوظيفة:
- تسجيل عودة الموظف من الإجازة.
- حساب التأخير أو الغياب في حال العودة المتأخرة.
- تطبيق العقوبات تلقائياً إذا لزم الأمر.

### السيناريو:
1. اختيار الموظف وإجازته.
2. تسجيل تاريخ العودة الفعلي.
3. النظام يتحقق من التأخير ويطبق العقوبة إذا لزم.

### مثال واجهة برمجية:
```
[تسجيل العودة]
- الموظف: أحمد علي
- تاريخ العودة المتوقع: 2025-11-20
- تاريخ العودة الفعلي: 2025-11-22
- التأخير: يومان
- العقوبة: خصم يومين
[حفظ]
```

---

## 5. الجدول الزمني للإجازات (Leave Schedule)

### الوظيفة:
- عرض جميع الإجازات بصورة مرئية (جدول/تقويم).
- فلترة حسب الموظف، القسم، أو الفترة.
- تنبيهات للإجازات القادمة.

### السيناريو:
1. اختيار الفترة أو القسم.
2. عرض الجدول الزمني لجميع الإجازات.
3. تصدير الجدول إلى Excel أو PDF.

### مثال واجهة برمجية:
```
[جدول الإجازات]
| الموظف      | من         | إلى         | النوع      |
|-------------|------------|-------------|------------|
| أحمد علي    | 2025-11-10 | 2025-11-20  | اعتيادية   |
| محمد حسن    | 2025-11-15 | 2025-11-18  | مرضية      |
[تصدير Excel] [تصدير PDF]
```

---

## 6. تقارير الإجازات (Leave Reports)

### الوظيفة:
- تصدير تقارير مفصلة عن الإجازات حسب الموظف، القسم، أو الفترة.
- تحليل رصيد الإجازات، الاستخدام، والتأجيلات.

### السيناريو:
1. تحديد الموظف أو القسم أو الفترة.
2. اختيار نوع التقرير (تفصيلي/إجمالي).
3. تصدير التقرير.

### مثال واجهة برمجية:
```
[تقرير الإجازات]
- الموظف: أحمد علي
- الفترة: 2025-01-01 إلى 2025-11-01
- مجموع الإجازات: 18 يوم
- الإجازات المؤجلة: 2
- التسويات النقدية: 1
[تصدير PDF]
```

---

## 7. الجداول المرتبطة (Database Tables)

### HR_Leave
- جميع الإجازات المسجلة.
- الحقول: id, employeeId, type, fromDate, toDate, status, createdBy, createdAt, notes

### HR_LeaveType
- أنواع الإجازات (اعتيادية، مرضية، إلخ).
- الحقول: id, name, isPaid, maxDays, isActive

### HR_LeaveSettlement
- التسويات النقدية للإجازات.
- الحقول: id, employeeId, leaveId, days, value, type, createdAt

### HR_LeaveSchedule
- الجدول الزمني لجميع الإجازات.
- الحقول: id, employeeId, fromDate, toDate, type

### HR_LeaveAuditLog
- سجل التغييرات على الإجازات.
- الحقول: id, leaveId, action, oldValue, newValue, changedBy, changedAt

---

## 8. أفضل الممارسات
- مراجعة سياسات الإجازات بشكل دوري.
- تفعيل سجل التدقيق لكل عملية تعديل أو تسوية.
- تصدير تقارير الإجازات شهرياً للإدارة.
- ربط النظام بتنبيهات تلقائية عند وجود تأجيلات أو تأخيرات متكررة.

---

## 9. ملخص

نظام الإجازات المتقدم يوفر أتمتة كاملة ومرونة عالية في إدارة جميع أنواع الإجازات، مع دعم التأجيل، التسوية النقدية، الجدولة الزمنية، والتقارير التفصيلية. يوصى بربط النظام مع أنظمة الرواتب والعقوبات لتحقيق تكامل كامل في إدارة الموارد البشرية.

---

**آخر تحديث:** 7 نوفمبر 2025
