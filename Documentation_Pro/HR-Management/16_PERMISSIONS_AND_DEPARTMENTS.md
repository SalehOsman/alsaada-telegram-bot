# ๐ ูุธุงู ุงูุตูุงุญูุงุช ูุงูุฃูุณุงู - ุงูุชูุซูู ุงููุงูู
## Permissions and Departments System - Complete Documentation

> **ุขุฎุฑ ุชุญุฏูุซ:** 7 ููููุจุฑ 2025  
> **ุงูุฅุตุฏุงุฑ:** 3.0  
> **ุงูุญุงูุฉ:** ูุธุงู ูุงูู ูุฌุงูุฒ ููุฅูุชุงุฌ

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ูุธุฑุฉ ุนุงูุฉ](#-ูุธุฑุฉ-ุนุงูุฉ)
2. [ุงูููุงููู ุงูุฃุณุงุณูุฉ](#-ุงูููุงููู-ุงูุฃุณุงุณูุฉ)
   - [ุงูุฃูุณุงู (Departments)](#1-ุงูุฃูุณุงู-departments)
   - [ุงูููุฒุงุช ุงููุฑุนูุฉ (Sub-Features)](#2-ุงูููุฒุงุช-ุงููุฑุนูุฉ-sub-features)
   - [ุงููุฏุฑุงุก (Admins)](#3-ุงููุฏุฑุงุก-admins)
3. [ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ](#-ุงููุธุงุฆู-ุงูุฆูุณูุฉ)
   - [ุฅุฏุงุฑุฉ ุงูุฃูุณุงู](#ุฅุฏุงุฑุฉ-ุงูุฃูุณุงู)
   - [ุฅุฏุงุฑุฉ ุตูุงุญูุงุช ุงูููุฒุงุช ุงููุฑุนูุฉ](#ุฅุฏุงุฑุฉ-ุตูุงุญูุงุช-ุงูููุฒุงุช-ุงููุฑุนูุฉ)
4. [ุขููุฉ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช (Middleware)](#-ุขููุฉ-ุงูุชุญูู-ูู-ุงูุตูุงุญูุงุช-middleware)
5. [ุงููููุงุช ุงูุจุฑูุฌูุฉ ุงููุฑุชุจุทุฉ](#-ุงููููุงุช-ุงูุจุฑูุฌูุฉ-ุงููุฑุชุจุทุฉ)
6. [ุงูุฌุฏุงูู ุงููุฑุชุจุทุฉ ุจูุงุนุฏุฉ ุงูุจูุงูุงุช](#-ุงูุฌุฏุงูู-ุงููุฑุชุจุทุฉ-ุจูุงุนุฏุฉ-ุงูุจูุงูุงุช)

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงูุตูุงุญูุงุช ูุงูุฃูุณุงู ูู ูุธุงู ุงูุชุญูู ูุงูุฃูุงู ุงููุฑูุฒู ูู ุงูุจูุช. ููู ูุตูู ูุชูููุฑ ุชุญูู ุฏููู ูููุตู ูููู ููููู ุงููุตูู ุฅูู ูู ูุณู ููู ููุฒุฉ ุฏุงุฎู ูุธุงู ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ. ูุถูู ูุฐุง ุงููุธุงู ุฃู ุงููุณุชุฎุฏููู ูุง ูุฑูู ุฅูุง ุงููุธุงุฆู ุงููุณููุญ ููู ุจูุงุ ููุง ูุญุงูุธ ุนูู ุณุฑูุฉ ุงูุจูุงูุงุช ููููุน ุงูุฅุฌุฑุงุกุงุช ุบูุฑ ุงููุตุฑุญ ุจูุง.

### โจ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:

- โ **ุชุญูู ูุฑูู:** ุตูุงุญูุงุช ุนูู ูุณุชูู ุงููุณู (ุนุงู) ูุตูุงุญูุงุช ุนูู ูุณุชูู ุงูููุฒุฉ ุงููุฑุนูุฉ (ุฎุงุต).
- ๐ง **ุฅุฏุงุฑุฉ ูุฑูุฉ:** ูุงุฌูุงุช ุณููุฉ ูุชูููู ุฃู ุชุนุทูู ุฃูุณุงู ูููุฒุงุช ูุงููุฉ.
- ๐ค **ุชุนููู ูุฏุฑุงุก:** ุงููุฏุฑุฉ ุนูู ุชุนููู ูุณุชุฎุฏููู ูุญุฏุฏูู ููุฏุฑุงุก ุนูู ุฃูุณุงู ุฃู ููุฒุงุช ูุนููุฉ.
- ๐ **ุญูุงูุฉ ูุคุชูุชุฉ:** ุงุณุชุฎุฏุงู Middleware ููุชุญูู ูู ุงูุตูุงุญูุงุช ุชููุงุฆููุง ูุจู ุชูููุฐ ุฃู ูุธููุฉ.

---

## ๐ง ุงูููุงููู ุงูุฃุณุงุณูุฉ

ูุนุชูุฏ ุงููุธุงู ุนูู ุซูุงุซุฉ ููุงููู ุฑุฆูุณูุฉ ุชุนูู ูุนูุง ูุชูููุฑ ุชุญูู ุดุงูู:

### 1. ุงูุฃูุณุงู (Departments)

-   **ุงูุฌุฏูู:** `DepartmentConfig`
-   **ุงููุตู:** ููุซู ุงููุณู ูุญุฏุฉ ุฑุฆูุณูุฉ ููุจูุฑุฉ ุฏุงุฎู ุงูุจูุชุ ูุซู "ุดุคูู ุงูุนุงูููู" (`hr-management`) ุฃู "ุงูุฅุดุนุงุฑุงุช" (`notifications`).
-   **ุงูุฎุตุงุฆุต ุงูุฑุฆูุณูุฉ:**
    -   `isEnabled`: ูููู ูู ุฎูุงูู **ุชูููู ุฃู ุชุนุทูู ุงููุณู ุจุฃูููู** ุจููุฑุฉ ูุงุญุฏุฉ.
    -   `minRole`: ูุญุฏุฏ ุงูุญุฏ ุงูุฃุฏูู ููุฑุชุจุฉ ุงููุทููุจุฉ ูููุตูู ุฅูู ุงููุณู (ูุซู `ADMIN` ุฃู `SUPER_ADMIN`).

### 2. ุงูููุฒุงุช ุงููุฑุนูุฉ (Sub-Features)

-   **ุงูุฌุฏูู:** `SubFeatureConfig`
-   **ุงููุตู:** ููุซู ููุฒุฉ ุฃู ูุธููุฉ ูุญุฏุฏุฉ ุฏุงุฎู ุงููุณู. ุนูู ุณุจูู ุงููุซุงูุ ุฏุงุฎู ูุณู "ุดุคูู ุงูุนุงูููู"ุ ุชุนุชุจุฑ "ุฅุถุงูุฉ ููุธู" ุฃู "ุฅุฏุงุฑุฉ ุงูุณูู" ููุฒุงุช ูุฑุนูุฉ.
-   **ุงูุฎุตุงุฆุต ุงูุฑุฆูุณูุฉ:**
    -   `code`: ุฑูุฒ ูุฑูุฏ ููููุฒุฉ (ูุซู `hr:employees:add` ุฃู `hr:advances`).
    -   `isEnabled`: ูููู ูู ุฎูุงูู **ุชูููู ุฃู ุชุนุทูู ูุฐู ุงูููุฒุฉ ููุท**.
    -   `minRole`: ูููู ุชุญุฏูุฏ ุญุฏ ุฃุฏูู ููุฑุชุจุฉ ููุฐู ุงูููุฒุฉุ ูุงูุฐู **ูุชุฌุงูุฒ (overrides)** ุตูุงุญูุงุช ุงููุณู ุฅุฐุง ูุงู ุฃูุซุฑ ุชูููุฏูุง.

### 3. ุงููุฏุฑุงุก (Admins)

-   **ุงูุฌุฏุงูู:** `DepartmentAdmin`, `SubFeatureAdmin`
-   **ุงููุตู:** ุจุงูุฅุถุงูุฉ ุฅูู ูุธุงู ุงูุฑุชุจ (Roles)ุ ูููู ุชุนููู ูุณุชุฎุฏู ูุนูู ูู "ูุฏูุฑ" ุนูู ูุณู ุฃู ููุฒุฉ ูุฑุนูุฉ.
-   **ุงูุงุณุชุฎุฏุงู:** ูุฐุง ูุณูุญ ุจุฅุนุทุงุก ุตูุงุญูุงุช ูุดุฎุต ูุนูู ุนูู ุฌุฒุก ูุญุฏุฏ ูู ุงููุธุงู ุฏูู ุงูุญุงุฌุฉ ุฅูู ุชุฑููุฉ ุฑุชุจุชู ุจุดูู ุนุงู. ุนูู ุณุจูู ุงููุซุงูุ ูููู ุฌุนู ููุธู ูุนูู ูุฏูุฑูุง ุนูู "ุชูุงุฑูุฑ ุงูุญุถูุฑ" ููุทุ ุฏูู ููุญู ุตูุงุญูุงุช `ADMIN` ูุงููุฉ.

---

## ๐๏ธ ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ

### ุฅุฏุงุฑุฉ ุงูุฃูุณุงู

**ุงูููู:** `section-management.handler.ts`

-   **ุงููุตูู:** `SUPER_ADMIN` ููุท.
-   **ุงููุธููุฉ:** ูุงุฌูุฉ ุฑุณูููุฉ ุชุนุฑุถ ุฌููุน ุงูุฃูุณุงู ูู ุงููุธุงู (`DepartmentConfig`).
-   **ุงูุฅุฌุฑุงุกุงุช:**
    -   **ุชูููู/ุชุนุทูู ูุณู:** ุฒุฑ ุจุฌุงูุจ ูู ูุณู ูุณูุญ ุจุฅุฎูุงุฆู ุฃู ุฅุธูุงุฑู ูุฌููุน ุงููุณุชุฎุฏููู.
    -   **ุชุนููู ูุฏุฑุงุก ุงููุณู:** ูุงุฌูุฉ ูุงุฎุชูุงุฑ ูุณุชุฎุฏู ูุชุนูููู ููุฏูุฑ ุนูู ุงููุณู ุจุฃูููู.

### ุฅุฏุงุฑุฉ ุตูุงุญูุงุช ุงูููุฒุงุช ุงููุฑุนูุฉ

**ุงููููุงุช:** `section-permissions.handler.ts`, `department-management.handler.ts`

-   **ุงููุตูู:** `SUPER_ADMIN` ููุท.
-   **ุงููุธููุฉ:** ูุงุฌูุฉ ุฃูุซุฑ ุชูุตููุงู ุชุณูุญ ุจุงูุชุญูู ูู ูู ููุฒุฉ ูุฑุนูุฉ (`SubFeatureConfig`) ุนูู ุญุฏุฉ.
-   **ุงูุฅุฌุฑุงุกุงุช:**
    -   **ุชูููู/ุชุนุทูู ููุฒุฉ:** ุฅููุงู ูุธููุฉ ูุนููุฉ (ูุซู "ุญุฐู ููุธู") ุฏูู ุงูุชุฃุซูุฑ ุนูู ุจุงูู ููุฒุงุช ูุณู ุงูููุธููู.
    -   **ุชุบููุฑ ุงูุญุฏ ุงูุฃุฏูู ููุฑุชุจุฉ:** ุฑูุน ูุณุชูู ุงูุตูุงุญูุฉ ุงููุทููุจุฉ ูููุฒุฉ ุญุณุงุณุฉ.
    -   **ุชุนููู ูุฏุฑุงุก ุงูููุฒุฉ:** ุชุนููู ูุณุชุฎุฏู ููุฏูุฑ ุนูู ููุฒุฉ ูุฑุนูุฉ ูุงุญุฏุฉ ููุท.

---

## ๐ ุขููุฉ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช (Middleware)

**ุงูููู:** `permissions.middleware.ts`

ูุฐุง ูู ููุจ ูุธุงู ุงูุฃูุงู. ุจุฏูุงู ูู ูุชุงุจุฉ ุดูุฑุฉ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู ูู ููู `handler`ุ ูุชู ุงุณุชุฎุฏุงู Middleware ูููู ุจุฐูู ุชููุงุฆููุง.

-   **ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ:** `checkHRAccess(subFeatureCode)`
-   **ุขููุฉ ุงูุนูู:**
    1.  ูุชู ุชุทุจูู ุงูู Middleware ุนูู ุงูู `handler` ุงููุทููุจ ุญูุงูุชูุ ูุน ุชูุฑูุฑ ุฑูุฒ ุงูููุฒุฉ ุงููุฑุนูุฉ.
        ```typescript
        // ูุซุงู ูู ููู handler
        const featureCode = 'hr:employees:add';
        addHandler(featureCode, addEmployeeHandler, checkHRAccess(featureCode));
        ```
    2.  ูุจู ุชูููุฐ `addEmployeeHandler`ุ ูุชู ุชุดุบูู `checkHRAccess` ุฃููุงู.
    3.  ูููู ุงูู Middleware ุจุงูุชุญูู ูู ุงูุขุชู ุจุงูุชุฑุชูุจ:
        -   ูู ุงููุณู ุงูุฑุฆูุณู ููููุฒุฉ (`hr-management`) ูุนุทูุ ุฅุฐุง ูุงู ูุฐููุ ูุชู ุฑูุถ ุงููุตูู.
        -   ูู ุงูููุฒุฉ ุงููุฑุนูุฉ ููุณูุง (`hr:employees:add`) ูุนุทูุฉุ ุฅุฐุง ูุงูุช ูุฐููุ ูุชู ุฑูุถ ุงููุตูู.
        -   ูู ุฑุชุจุฉ ุงููุณุชุฎุฏู (`user.role`) ุฃูู ูู ุงูุญุฏ ุงูุฃุฏูู ุงููุทููุจ ููููุฒุฉ ุฃู ุงููุณูุ ุฅุฐุง ูุงูุช ูุฐููุ ูุชู ุฑูุถ ุงููุตูู.
        -   ูู ุงููุณุชุฎุฏู ููุนููู ููุฏูุฑ ุนูู ุงูููุฒุฉ ุฃู ุงููุณูุ ุฅุฐุง ูุงู ูุฐููุ ูุชู ุงูุณูุงุญ ุจุงููุตูู.
    4.  ุฅุฐุง ูุฌุญุช ุฌููุน ุนูููุงุช ุงูุชุญููุ ูุชู ุงูุณูุงุญ ูููุณุชุฎุฏู ุจุงููุตูู ูุชูููุฐ ุงูู `handler`.

---

## ๐ ุงููููุงุช ุงูุจุฑูุฌูุฉ ุงููุฑุชุจุทุฉ

| ุงูููู | ุงููุตู |
|---|---|
| `section-management.handler.ts` | ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ ูุฅุฏุงุฑุฉ ุงูุฃูุณุงู (ุชูููู/ุชุนุทูู). |
| `section-permissions.handler.ts` | ุงููุงุฌูุฉ ุงููุชูุฏูุฉ ูุฅุฏุงุฑุฉ ุตูุงุญูุงุช ุงูููุฒุงุช ุงููุฑุนูุฉ. |
| `department-management.handler.ts` | ูุงุฌูุฉ ุฅุฏุงุฑุฉ ูุฏุฑุงุก ุงูุฃูุณุงู ูุงูููุฒุงุช. |
| `permissions.middleware.ts` | ูุญุชูู ุนูู ููุทู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช (`checkHRAccess`). |

---

## ๐๏ธ ุงูุฌุฏุงูู ุงููุฑุชุจุทุฉ ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

-   **`DepartmentConfig`**: ูุฎุฒู ุฅุนุฏุงุฏุงุช ุงูุฃูุณุงู ุงูุฑุฆูุณูุฉ (ูุซู `hr-management`).
-   **`DepartmentAdmin`**: ุฌุฏูู ุงูุฑุจุท ุจูู ุงููุณุชุฎุฏููู ูุงูุฃูุณุงู ุงูุชู ูุฏูุฑูููุง.
-   **`SubFeatureConfig`**: ูุฎุฒู ุฅุนุฏุงุฏุงุช ูู ููุฒุฉ ูุฑุนูุฉ (ูุซู `hr:employees:add`).
-   **`SubFeatureAdmin`**: ุฌุฏูู ุงูุฑุจุท ุจูู ุงููุณุชุฎุฏููู ูุงูููุฒุงุช ุงููุฑุนูุฉ ุงูุชู ูุฏูุฑูููุง.
-   **`User`**: ูุญุชูู ุนูู ุฑุชุจุฉ ุงููุณุชุฎุฏู (`role`) ุงูุชู ูุชู ุงูุชุญูู ูููุง.