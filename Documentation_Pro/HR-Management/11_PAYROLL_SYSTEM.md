# 11. نظام الرواتب الشامل (Payroll System)

---

## مقدمة

نظام الرواتب الشامل هو العمود الفقري لإدارة الموارد البشرية، ويهدف إلى أتمتة جميع عمليات حساب الرواتب، البدلات، المكافآت، الاستحقاقات العينية، والرواتب الشهرية، مع سجل تدقيق كامل ومرونة عالية في تخصيص السياسات.

---

## الأهداف الرئيسية للنظام
- حساب الرواتب بدقة حسب السياسات والبدلات والمكافآت.
- إدارة أنواع البدلات (ثابتة، متغيرة، عينية).
- دعم المكافآت الفردية والجماعية.
- إدارة الاستحقاقات العينية وربطها بالرواتب.
- تصدير كشوف الرواتب الشهرية وتقارير مفصلة.
- سجل تدقيق كامل لكل عملية مالية.

---

## الهيكل العام للنظام

- **Handlers رئيسية:**
  - payroll.handler.ts
  - payroll-calculate.handler.ts
  - payroll-allowance-types.handler.ts
  - payroll-position-allowances.handler.ts
  - payroll-employee-allowances.handler.ts
  - payroll-bonuses.handler.ts
  - payroll-material-entitlements.handler.ts
  - payroll-financial-history.handler.ts
  - monthly-payroll.handler.ts
- **الجداول المرتبطة:**
  - HR_AllowanceType
  - HR_PositionAllowance
  - HR_EmployeeAllowance
  - HR_MaterialEntitlement
  - HR_Bonus
  - HR_PayrollRecord
  - HR_PayrollAuditLog
  - HR_MonthlyPayroll
- **Enums:**
  - AllowanceType
  - BonusType
  - PayrollStatus

---

## 1. حساب الرواتب (Payroll Calculation)

### الوظيفة:
- حساب الراتب الشهري أو الجزئي للموظف بناءً على الحضور، البدلات، الخصومات، المكافآت، والاستحقاقات العينية.
- دعم حساب الراتب عند الاستقالة أو الفصل أو نهاية الخدمة.

### السيناريو:
1. اختيار الموظف أو مجموعة موظفين.
2. تحديد الفترة (شهر كامل، نصف شهر، حتى اليوم، إلخ).
3. النظام يجمع جميع البيانات (الحضور، البدلات، الخصومات، المكافآت).
4. حساب الراتب النهائي مع بيان تفصيلي.

### مثال واجهة برمجية:
```
[حساب الراتب]
- الموظف: أحمد علي
- الفترة: 2025-11-01 إلى 2025-11-30
- الراتب الأساسي: 5000
- بدلات: 1200
- مكافآت: 500
- خصومات: 300
- استحقاقات عينية: 200
- الراتب النهائي: 6600
```

---

## 2. إدارة أنواع البدلات (Allowance Types)

### الوظيفة:
- تعريف وتعديل أنواع البدلات (انتقال، إجازة، إضافي، إلخ).
- تحديد ما إذا كانت البدلات ثابتة أو متغيرة أو عينية.

### السيناريو:
1. عرض جميع أنواع البدلات.
2. إضافة نوع جديد أو تعديل نوع قائم.
3. ربط كل نوع بوظيفة أو موظف محدد.

### مثال واجهة برمجية:
```
[أنواع البدلات]
- بدل انتقال: ثابت - 500
- بدل إجازة: متغير - حسب الأيام
- بدل إضافي: متغير - حسب الساعات
[إضافة نوع] [تعديل] [حذف]
```

---

## 3. بدلات الوظائف وبدلات الموظفين (Position & Employee Allowances)

### الوظيفة:
- تحديد بدلات افتراضية لكل وظيفة.
- إضافة استثناءات خاصة لكل موظف.

### السيناريو:
1. اختيار وظيفة (مثلاً: محاسب).
2. تحديد البدلات الافتراضية (انتقال، سكن، إلخ).
3. إضافة/تعديل بدلات خاصة لموظف معين.

### مثال واجهة برمجية:
```
[بدلات الوظيفة: محاسب]
- بدل انتقال: 500
- بدل سكن: 1000
[بدلات الموظف: أحمد علي]
- بدل انتقال: 600 (استثناء)
```

---

## 4. المكافآت (Bonuses)

### الوظيفة:
- إضافة مكافآت فردية أو جماعية (حسب الموظف أو الوظيفة أو الجميع).
- تحديد مدة المكافأة (شهر واحد، عدة أشهر، دائمة).

### السيناريو:
1. اختيار نوع المكافأة (فردية/جماعية).
2. تحديد الموظف/الوظيفة/الجميع.
3. تحديد القيمة والمدة.

### مثال واجهة برمجية:
```
[إضافة مكافأة]
- النوع: جماعية
- الوظيفة: سائق
- القيمة: 300
- المدة: شهرين
[حفظ]
```

---

## 5. الاستحقاقات العينية (Material Entitlements)

### الوظيفة:
- إدارة الاستحقاقات العينية (مثل: سجائر، وجبات، إلخ).
- ربط الاستحقاقات بالموظف أو الوظيفة.
- احتساب القيمة تلقائياً في الراتب.

### السيناريو:
1. تعريف نوع الاستحقاق العيني.
2. تحديد القيمة اليومية/الشهرية.
3. ربط الاستحقاق بالموظف/الوظيفة.

### مثال واجهة برمجية:
```
[استحقاقات عينية]
- الموظف: أحمد علي
- نوع الاستحقاق: سجائر
- القيمة: 100
- الفترة: شهر
```

---

## 6. الرواتب الشهرية (Monthly Payroll)

### الوظيفة:
- حساب جماعي لجميع الموظفين في نهاية كل شهر.
- تتبع حالة الدفع (مدفوع/غير مدفوع).
- تصدير كشوف الرواتب للإدارة.

### السيناريو:
1. تحديد الشهر المطلوب.
2. النظام يحسب رواتب جميع الموظفين تلقائياً.
3. عرض حالة كل راتب (مدفوع/معلق).
4. تصدير الكشوف إلى Excel أو PDF.

### مثال واجهة برمجية:
```
[الرواتب الشهرية - نوفمبر 2025]
| الموظف      | الراتب النهائي | الحالة   |
|-------------|---------------|----------|
| أحمد علي    | 6600          | مدفوع    |
| محمد حسن    | 7200          | معلق     |
[تصدير Excel] [تصدير PDF]
```

---

## 7. سجل التدقيق المالي (Payroll Audit Log)

### الوظيفة:
- تتبع جميع التعديلات على الرواتب والبدلات والمكافآت.
- تسجيل من قام بالتعديل، متى، وما هو التغيير.

### السيناريو:
1. عرض سجل التغييرات لكل موظف أو عملية مالية.
2. تصدير السجل للمراجعة.

### مثال واجهة برمجية:
```
[سجل التدقيق - أحمد علي]
| التاريخ      | العملية         | القديم | الجديد | من قام بالتعديل |
|--------------|----------------|--------|--------|----------------|
| 2025-11-10   | تعديل بدل انتقال| 500    | 600    | مدير الموارد   |
```

---

## 8. الجداول المرتبطة (Database Tables)

### HR_AllowanceType
- أنواع البدلات (انتقال، إجازة، إلخ).
- الحقول: id, name, type, isActive

### HR_PositionAllowance
- بدلات افتراضية لكل وظيفة.
- الحقول: id, positionId, allowanceTypeId, value

### HR_EmployeeAllowance
- استثناءات البدلات لكل موظف.
- الحقول: id, employeeId, allowanceTypeId, value

### HR_MaterialEntitlement
- الاستحقاقات العينية.
- الحقول: id, employeeId, type, value, period

### HR_Bonus
- المكافآت.
- الحقول: id, employeeId, positionId, value, fromDate, toDate, type

### HR_PayrollRecord
- سجل الرواتب لكل عملية دفع.
- الحقول: id, employeeId, period, baseSalary, allowances, bonuses, deductions, materialEntitlements, netSalary, status

### HR_PayrollAuditLog
- سجل التغييرات المالية.
- الحقول: id, payrollRecordId, action, oldValue, newValue, changedBy, changedAt

### HR_MonthlyPayroll
- الرواتب الشهرية الجماعية.
- الحقول: id, month, year, totalAmount, status, createdAt

---

## 9. أفضل الممارسات
- مراجعة أنواع البدلات والمكافآت بشكل دوري.
- تفعيل سجل التدقيق المالي لكل عملية.
- تصدير كشوف الرواتب شهرياً وحفظها في الأرشيف.
- ربط النظام بتنبيهات تلقائية عند وجود أخطاء أو فروقات كبيرة.

---

## 10. ملخص

نظام الرواتب الشامل يوفر أتمتة كاملة ودقيقة لجميع العمليات المالية للموظفين، مع مرونة عالية في تخصيص السياسات، وسجل تدقيق مفصل، وواجهات سهلة للاستخدام والتقارير. يوصى بربط النظام مع أنظمة العقوبات والإجازات لتحقيق تكامل كامل في إدارة الموارد البشرية.

---

**آخر تحديث:** 7 نوفمبر 2025
