# ๐ ุณุฌู ุงูุชุบููุฑุงุช - ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ
## Changelog - HR Management System

> **ุขุฎุฑ ุชุญุฏูุซ:** 7 ููููุจุฑ 2025  
> **ุงูุฅุตุฏุงุฑ ุงูุญุงูู:** 3.0

---

## ๐ ุงูุฅุตุฏุงุฑ 3.0 - 7 ููููุจุฑ 2025

### ๐ ุชุญุฏูุซุงุช ุฑุฆูุณูุฉ ุถุฎูุฉ

#### โจ ูุธุงู ุงูุฅููุงู ุนู ุงูุนูู (Suspensions System) - ุฌุฏูุฏ ูููุงู

**ุงูููุฒุงุช:**
- โ ุฅููุงู ุชููุงุฆู ุนูุฏ ุงูููุงููุฉ ุนูู ุนููุจุฉ ููุน `SUSPENSION`
- โ ุชุญุฏูุซ ุญุงูุฉ ุงูููุธู ุชููุงุฆูุงู โ `employmentStatus = 'SUSPENDED'`
- โ ุฅููุงู ุงูุฑุงุชุจ ูู ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุฅุฌุงุฒุฉ
- โ ุฅุฎูุงุก ุงูููุธู ุงูููููู ูู ููุงุฆู ุงูุชุณุฌูู ุงูุฌุฏูุฏุฉ
- โ ููุน ุชุณุฌูู ุงูุนูุฏุฉ ุญุชู ุฑูุน ุงูุฅููุงู

**ุฑูุน ุงูุฅููุงูุงุช:**
- โ ุฑูุน ุจุฏูู ุนููุจุฉ (ุนุฐุฑ ููุจูู)
- โ ุฑูุน ูุน ุนููุจุฉ ุฎุตู ุฃูุงู

**ุงููููุงุช:**
- `src/features/hr/penalties/lift-suspensions.handler.ts` (389 ุณุทุฑ) - ุฌุฏูุฏ
- `src/features/hr/penalties/delay-penalty.service.ts` - ูุญุฏุซ

**ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
- โ ุฅุถุงูุฉ `SUSPENDED` ุฅูู enum `EmploymentStatus`

---

#### โก ูุธุงู ุงูุนููุจุงุช ุงูุชููุงุฆูุฉ (Auto-Penalties Scheduler) - ุฌุฏูุฏ ูููุงู

**ุงูููุฒุงุช:**
- โ Cron Job ูููู ุงูุณุงุนุฉ 9 ุตุจุงุญุงู (Cairo Time)
- โ ูุดู ุชููุงุฆู ููุฅุฌุงุฒุงุช ุงููุชุฃุฎุฑุฉ 5+ ุฃูุงู
- โ ุฅูุดุงุก ุนููุจุงุช ุชููุงุฆูุงู ุจุฏูู ุชุฏุฎู ุจุดุฑู
- โ ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ููุฑูุฉ ูููุฏุฑุงุก
- โ ููุฎุต ูููู ุจุฌููุน ุงูุนููุจุงุช ุงูุฌุฏูุฏุฉ

**ุงููููุงุช:**
- `src/features/hr/auto-penalties-scheduler.ts` (267 ุณุทุฑ) - ุฌุฏูุฏ
- `src/main.ts` - ูุญุฏุซ (ุชุดุบูู Scheduler)
- `src/features/hr/schedulers/index.ts` - ูุญุฏุซ

**ุขููุฉ ุงูุนูู:**
```typescript
Cron: '0 9 * * *' // ููููุงู 9 ุตุจุงุญุงู
1. ุงูุจุญุซ ุนู leaves where actualReturnDate = null AND delayDays >= 5
2. ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุนููุจุฉ ุณุงุจูุฉ
3. ุฅูุดุงุก penalty ูุน isAutoCreated = true
4. ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ููุฑูุฉ
5. ุฅุฑุณุงู ููุฎุต ูููู
```

---

#### ๐ ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงููุญุณูู

**ุงูุชุญุฏูุซุงุช:**
- โ ุฏุนู ููุนูู ูู ุงูู Bot: `Bot` ู `Api`
- โ ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนูุฏ ุฅูุดุงุก ุนููุจุฉ ุฌุฏูุฏุฉ
- โ ุฅุดุนุงุฑุงุช ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ููุนููุจุงุช ุงููุนููุฉ
- โ ููุฎุตุงุช ููููุฉ ููุนููุจุงุช ุงูุชููุงุฆูุฉ

**ุงููููุงุช:**
- `src/features/hr/penalties/penalties-notifications.service.ts` - ูุญุฏุซ
- `src/features/hr/leaves/leaves-return.handler.ts` - ูุญุฏุซ

**ุงูุชุบููุฑุงุช:**
```typescript
// ูุจู
await notifyNewPenalty(penalty, employee);

// ุจุนุฏ
await notifyNewPenalty(penalty, employee, ctx.api); // ูุฏุนู Api ู Bot
```

---

#### ๐ฐ ุชุญุฏูุซุงุช ูุธุงู ุงูุฑูุงุชุจ

**ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:**

1. **ุฎุตู ุงูุฅุฌุงุฒุงุช ุจุฏูู ูุฑุชุจ ูู ุงููุธุงู ุงูุดูุฑู:**
   ```typescript
   // ูู payroll-calculate.handler.ts
   const unpaidLeaves = await getUnpaidLeaves(employeeId, month, year);
   const unpaidLeaveDays = calculateTotalDays(unpaidLeaves);
   const deduction = (basicSalary / 30) * unpaidLeaveDays;
   ```

2. **ุญุฏ ุงูุฑุงุชุจ ููููุธู ุงูููููู:**
   ```typescript
   if (employee.employmentStatus === 'SUSPENDED') {
     // ุงูุฑุงุชุจ ุญุชู ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุฅุฌุงุฒุฉ ููุท
     endOfPeriod = suspensionLeave.startDate;
   }
   ```

3. **ุชูุณูู ุชูุฑูุฑ ุงูุฑุงุชุจ ุงููุญุณูู:**
   - ููุฎุต ูุงุถุญ ุจูู ุณุทุฑ
   - ุงูุฑุงุชุจ ุงูุฃุณุงุณู ุฃููุงู
   - ุซู ุฌููุน ุงูุฅุถุงูุงุช
   - ุซู ุฌููุน ุงูุฎุตููุงุช
   - ุงูุตุงูู ูู ุงูููุงูุฉ ูุน ุฎุท ูุงุตู

4. **ุนุฑุถ ูุตู ุงูููุงูุฃุฉ ุจุฏูุงู ูู ุงูููุน:**
   ```typescript
   // ูุจู: "ููุงูุฃุฉ ูุฑุฏูุฉ"
   // ุจุนุฏ: "ููุงูุฃุฉ ุชููู" (ูู ุญูู description)
   ```

**ุงููููุงุช:**
- `src/features/hr/payroll/payroll-calculate.handler.ts` (1,867 ุณุทุฑ) - ูุญุฏุซ

---

#### ๐๏ธ ุชุญุฏูุซุงุช ูุธุงู ุงูุฅุฌุงุฒุงุช

**ุงูุฅุตูุงุญุงุช:**

1. **ุฅุตูุงุญ ุชุนุงุฑุถ ุงูุชูุงุฑูุฎ:**
   ```typescript
   // ูุจู: ุฌููุน ุงูุฅุฌุงุฒุงุช ุชุนุชุจุฑ ูุชุนุงุฑุถุฉ
   // ุจุนุฏ: ููุท ุงูุฅุฌุงุฒุงุช ุงูููุชูุญุฉ (actualReturnDate: null)
   
   where: {
     actualReturnDate: null, // โ ุฌุฏูุฏ
     // ... ุจุงูู ุงูุดุฑูุท
   }
   ```

2. **ุฅุฎูุงุก ุงูููุธููู ุงูููููููู:**
   ```typescript
   // ูู leaves-add.handler.ts
   where: {
     employmentStatus: 'ACTIVE', // ููุท ุงููุดุทูู
     isActive: true
   }
   ```

3. **ููุน ุชุณุฌูู ุนูุฏุฉ ููููููููู:**
   ```typescript
   // ูู leaves-return.handler.ts
   if (employee.employmentStatus === 'SUSPENDED') {
     return ctx.reply('๐ซ ูุฐุง ุงูููุธู ููููู...');
   }
   ```

**ุงููููุงุช:**
- `src/features/hr/leaves/leaves-add.handler.ts` - ูุญุฏุซ
- `src/features/hr/leaves/leaves-return.handler.ts` - ูุญุฏุซ

---

#### ๐ ุงูุชูุซูู ุงูุดุงูู - ุฅุนุงุฏุฉ ูุชุงุจุฉ ูุงููุฉ

**ุงููููุงุช ุงูุฌุฏูุฏุฉ:**
- โ `00_INDEX.md` - ููุฑุณ ุดุงูู ูุญุฏุซ (26 ููู)
- โ `01_SYSTEM_OVERVIEW.md` - ูุธุฑุฉ ุนุงูุฉ ูุงููุฉ (~600 ุณุทุฑ)
- โ `02_DATABASE_SCHEMA.md` - ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช (25 ุฌุฏููุ ~800 ุณุทุฑ)
- โ `USER_GUIDE.md` - ุฏููู ุงููุณุชุฎุฏู ุงูุดุงูู (~900 ุณุทุฑ)

**ุงููููุงุช ุงููุญุฐููุฉ:**
- โ `01_OVERVIEW.md` (ุงุณุชุจุฏู ุจู `01_SYSTEM_OVERVIEW.md`)
- โ `QUICK_GUIDE.md` (ุฏููุฌ ูู `USER_GUIDE.md`)
- โ `HOW_TO_USE.md` (ุฏููุฌ ูู `USER_GUIDE.md`)
- โ `10_CHANGELOG.md` (ุงุณุชุจุฏู ุจู `CHANGELOG.md`)

**ุงููููุฒุงุช:**
- โ ุดุงูู: ูุบุทู ูู ุชูุตููุฉ ุตุบูุฑุฉ
- โ ูุญุฏุซ: ูุนูุณ ุงููุถุน ุงูุญุงูู 100%
- โ ููุธู: ุชุฑุชูุจ ููุทูู ุณูู
- โ ุนููู: ุฃูุซูุฉ ูุงูุนูุฉ
- โ ููุฌููุน: ูุณุชุฎุฏููู ููุทูุฑูู

---

#### ๐๏ธ ุชุญุฏูุซุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุญููู ุงูุฌุฏูุฏุฉ:**

1. **Employee:**
   - `employmentStatus` - ุงูุขู ูุฏุนู `SUSPENDED`

2. **HR_EmployeeLeave:**
   - `actualReturnDate` - ููู ููุดู ุงูุชุฃุฎูุฑ

3. **HR_AppliedPenalty:**
   - `isAutoCreated` - ุนูุงูุฉ ุงูุนููุจุงุช ุงูุชููุงุฆูุฉ
   - `status` - PENDING | APPROVED | REJECTED

4. **HR_Bonus:**
   - `description` - ููุนุฑุถ ูู ุงูุชูุงุฑูุฑ

**Enums ุงูุฌุฏูุฏุฉ:**
- `SUSPENDED` ูู `EmploymentStatus`
- `SUSPENSION` ูู `DelayPenaltyType`
- `UNPAID` ูู `LeaveType`

---

#### ๐๏ธ ุณูุฑูุจุชุงุช ุชุดุฎูุตูุฉ

**ุงููููุงุช ุงูุฌุฏูุฏุฉ:**
- `scripts/fix-suspension-status.ts` - ุชุตุญูุญ ุญุงูุงุช ุงูุฅููุงู
- `scripts/test-auto-penalties.ts` - ุงุฎุชุจุงุฑ ุงูุนููุจุงุช ุงูุชููุงุฆูุฉ
- `scripts/test-unpaid-leave-deduction.ts` - ุงุฎุชุจุงุฑ ุฎุตู ุงูุฅุฌุงุฒุงุช
- `scripts/check-conflicting-leave.ts` - ูุญุต ุชุนุงุฑุถ ุงูุชูุงุฑูุฎ

---

### ๐ ุงูุฅุญุตุงุฆูุงุช

**ุงููููุงุช:**
- ูููุงุช ุฌุฏูุฏุฉ: 6
- ูููุงุช ูุญุฏุซุฉ: 9
- ูููุงุช ูุญุฐููุฉ: 4
- ุฃุณุทุฑ ููุฏ ุฌุฏูุฏุฉ: ~2,000
- ุฃุณุทุฑ ุชูุซูู ุฌุฏูุฏุฉ: ~2,300

**ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
- ุฌุฏุงูู: 25 ุฌุฏูู
- ุญููู ุฌุฏูุฏุฉ: 8
- Enums ุฌุฏูุฏุฉ: 3

---

## ๐ ุงูุฅุตุฏุงุฑ 2.0 - 4 ููููุจุฑ 2025

### โจ ูุธุงู ุฏูุฑุฉ ุงูุนูู ูุงูุฅุฌุงุฒุงุช

**ุงูููุฒุงุช:**
- โ ุฅุฏุงุฑุฉ ุฏูุฑุงุช ุงููุธุงุฆู (ููู ุงูุชุฑุงุถูุฉ)
- โ ุฅุฏุงุฑุฉ ุฏูุฑุงุช ุงูููุธููู (ููู ูุฎุตุตุฉ)
- โ ููุงุชุฑ ูุชูุฏูุฉ
- โ ุงูุจุญุซ ุจุงูุงุณู
- โ ุชุตุฏูุฑ Excel
- โ ุณุฌู ุงูุชุฏููู (Audit Log)

**ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
- โ `hasCustomCycle` ูู Employee
- โ `defaultWorkDaysPerCycle` ู `defaultLeaveDaysPerCycle` ูู Position
- โ ุฌุฏูู `HR_CycleChangeLog`
- โ Migration: `add_work_leave_cycle_features`

**ุงููููุงุช:**
- `work-leave-cycle/index.ts`
- `work-leave-cycle/positions.handler.ts`
- `work-leave-cycle/employees.handler.ts`
- `work-leave-cycle/employee-edit.handler.ts`
- `work-leave-cycle/search.handler.ts`
- `work-leave-cycle/export.handler.ts`

**ุงูุชูุซูู:**
- โ `11_WORK_LEAVE_CYCLE_SYSTEM.md`

---

## ๐ ุงูุฅุตุฏุงุฑ 1.0 - 4 ููููุจุฑ 2025

### โจ ุงูุฅุทูุงู ุงูุฃููู

**ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
- โ ููุน `EMPLOYEE_DEBT` ูู HR_Transaction
- โ Migration: `add_employee_debt_transaction_type`

**ุงูุชูุซูู ุงูุฃููู:**
- โ `00_INDEX.md`
- โ `01_OVERVIEW.md`
- โ `02_DATABASE_SCHEMA.md`
- โ `03_EMPLOYEES_MANAGEMENT.md`

**ุงูุงุณุชูุดุงู:**
- โ 52 ููู handler
- โ 6 ูุธุงุฆู ุฑุฆูุณูุฉ
- โ 25+ ูุธููุฉ ูุฑุนูุฉ
- โ 15+ ุฌุฏูู

---

## ๐ฏ ููุฎุต ุงูุชุทูุฑ

### ุงูุฅุตุฏุงุฑุงุช:

| ุงูุฅุตุฏุงุฑ | ุงูุชุงุฑูุฎ | ุงููููุงุช ุงูุฌุฏูุฏุฉ | ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ |
|---------|---------|-----------------|-------------------|
| **3.0** | 7 ููููุจุฑ 2025 | 10 | ูุธุงู ุงูุฅููุงู + ุงูุนููุจุงุช ุงูุชููุงุฆูุฉ |
| 2.0 | 4 ููููุจุฑ 2025 | 6 | ุฏูุฑุงุช ุงูุนูู/ุงูุฅุฌุงุฒุฉ |
| 1.0 | 4 ููููุจุฑ 2025 | 52 | ุงูุฅุทูุงู ุงูุฃููู |

### ุงูููู:

```
ุงูุฅุตุฏุงุฑ 1.0:  52 handler
ุงูุฅุตุฏุงุฑ 2.0: +6 handlers (58)
ุงูุฅุตุฏุงุฑ 3.0: +1 handler + 5 scripts (64 ููู)

ุงูุชูุซูู 1.0:   4 ูููุงุช
ุงูุชูุซูู 2.0:  +1 ููู (5)
ุงูุชูุซูู 3.0:  +4 ูููุงุช -4 ูุฏููุฉ (5 ูููุงุช ูุดุทุฉ)
```

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุงุฏูุฉ

### ุงููุฎุทุท ููุฅุตุฏุงุฑ 3.1:

- [ ] ูุงุฌูุฉ ููุจ ูุฅุฏุงุฑุฉ ุงููุธุงู
- [ ] ุชุทุจูู ููุจุงูู ููููุธููู
- [ ] ููุญุฉ ุชุญูู ุชุญููููุฉ
- [ ] ุฐูุงุก ุงุตุทูุงุนู ููุชูุจุคุงุช
- [ ] ุชูุงูู ูุน ุฃูุธูุฉ ุฎุงุฑุฌูุฉ

### ุงูุชุญุณููุงุช ุงููุฎุทุทุฉ:

- [ ] ุชุญุณูู ุงูุฃุฏุงุก (Caching)
- [ ] ุงุฎุชุจุงุฑุงุช ุขููุฉ ุดุงููุฉ
- [ ] CI/CD Pipeline
- [ ] Docker Deployment
- [ ] Kubernetes Support

---

<div align="center">

**๐ ูุธุงู ูุชุทูุฑ ุจุงุณุชูุฑุงุฑ ๐**

*ุฌููุน ุงูุชุญุฏูุซุงุช ููุซูุฉ ููุงุจูุฉ ููุชุชุจุน*

๐ **ุขุฎุฑ ุชุญุฏูุซ:** 7 ููููุจุฑ 2025

</div>
