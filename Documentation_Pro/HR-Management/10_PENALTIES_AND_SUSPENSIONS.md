# โ๏ธ ูุธุงู ุงูุนููุจุงุช ูุงูุฅููุงูุงุช - ุงูุชูุซูู ุงููุงูู
## Penalties and Suspensions System - Complete Documentation

> **ุขุฎุฑ ุชุญุฏูุซ:** 7 ููููุจุฑ 2025  
> **ุงูุฅุตุฏุงุฑ:** 3.0  
> **ุงูุญุงูุฉ:** ูุธุงู ูุงูู ูุฌุงูุฒ ููุฅูุชุงุฌ

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ูุธุฑุฉ ุนุงูุฉ](#-ูุธุฑุฉ-ุนุงูุฉ)
2. [ุฃููุงุน ุงูุนููุจุงุช](#-ุฃููุงุน-ุงูุนููุจุงุช)
3. [ุฏูุฑุฉ ุญูุงุฉ ุงูุนููุจุฉ (Workflow)](#-ุฏูุฑุฉ-ุญูุงุฉ-ุงูุนููุจุฉ)
4. [ุงูุนููุจุงุช ุงูุชููุงุฆูุฉ (Auto-Penalties)](#-ุงูุนููุจุงุช-ุงูุชููุงุฆูุฉ-auto-penalties)
5. [ูุธุงู ุงูุฅููุงู ุนู ุงูุนูู (Suspension)](#-ูุธุงู-ุงูุฅููุงู-ุนู-ุงูุนูู-suspension)
   - [ุชูุนูู ุงูุฅููุงู](#ุชูุนูู-ุงูุฅููุงู)
   - [ุฑูุน ุงูุฅููุงู](#ุฑูุน-ุงูุฅููุงู)
6. [ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ ูููุฏูุฑ](#-ุงููุธุงุฆู-ุงูุฑุฆูุณูุฉ-ูููุฏูุฑ)
   - [ูุฑุงุฌุนุฉ ุงูุนููุจุงุช ุงููุนููุฉ](#1-ูุฑุงุฌุนุฉ-ุงูุนููุจุงุช-ุงููุนููุฉ)
   - [ุนุฑุถ ุณุฌู ุงูุนููุจุงุช](#2-ุนุฑุถ-ุณุฌู-ุงูุนููุจุงุช)
   - [ุฅุฏุงุฑุฉ ุณูุงุณุงุช ุงูุนููุจุงุช](#3-ุฅุฏุงุฑุฉ-ุณูุงุณุงุช-ุงูุนููุจุงุช)
7. [ุงููููุงุช ุงูุจุฑูุฌูุฉ ุงููุฑุชุจุทุฉ](#-ุงููููุงุช-ุงูุจุฑูุฌูุฉ-ุงููุฑุชุจุทุฉ)
8. [ุงูุฌุฏุงูู ุงููุฑุชุจุทุฉ ุจูุงุนุฏุฉ ุงูุจูุงูุงุช](#-ุงูุฌุฏุงูู-ุงููุฑุชุจุทุฉ-ุจูุงุนุฏุฉ-ุงูุจูุงูุงุช)

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงูุนููุจุงุช ูุงูุฅููุงูุงุช ูู ูุธุงู ุญุงุณู ูุถูุงู ุงูุงูุถุจุงุท ูุชุทุจูู ุณูุงุณุงุช ุงูุดุฑูุฉ. ููู ูุตูู ูุฃุชูุชุฉ ููุฑุงูุจุฉ ุงูุฅุฌุฑุงุกุงุช ุงูุชุฃุฏูุจูุฉุ ุจุฏุกูุง ูู ุงูุฅูุฐุงุฑุงุช ุงูุจุณูุทุฉ ูุตูููุง ุฅูู ุงูุฅููุงู ุงููุงูู ุนู ุงูุนููุ ูุน ุชูููุฑ ุงูุดูุงููุฉ ูุงูุฏูุฉ ูู ุฌููุน ุงูุฎุทูุงุช.

### โจ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:

- ๐ค **ุฃุชูุชุฉ ูุงููุฉ:** ุฅูุดุงุก ุนููุจุงุช ุชููุงุฆูุฉ ูููุชุฃุฎุฑูู ุนู ุงูุนูุฏุฉ ูู ุงูุฅุฌุงุฒุงุช.
- ๐ซ **ูุธุงู ุฅููุงู ูุชูุงูู:** ุฅููุงู ุงูููุธู ูุฑุงุชุจู ุชููุงุฆููุง ุนูุฏ ุงูููุงููุฉ ุนูู ุนููุจุฉ ุฅููุงู.
- ๐ **ุขููุฉ ูุฑูุฉ ูุฑูุน ุงูุฅููุงู:** ุฅููุงููุฉ ุฑูุน ุงูุฅููุงู ูุน ุฃู ุจุฏูู ุนููุจุฉ ุจุฏููุฉ.
- ๐ **ุณูุงุณุงุช ูุงุจูุฉ ููุชุฎุตูุต:** ุงููุฏุฑุฉ ุนูู ุชุนุฑูู ุณูุงุณุงุช ุนููุจุงุช ุฏููุงููููุฉ.
- ๐ **ุณุฌู ุชุฏููู ูุงูู:** ุชุชุจุน ุฌููุน ุงููุฑุงุฑุงุช ูุงูููุงููุงุช.
- ๐ **ุฅุดุนุงุฑุงุช ููุฑูุฉ:** ุฅุจูุงุบ ุงููุฏุฑุงุก ูุงูููุธููู ุจุงูุฅุฌุฑุงุกุงุช ุงููุชุฎุฐุฉ.

---

## ๐ ุฃููุงุน ุงูุนููุจุงุช

ูุชู ุชุนุฑูู ุฃููุงุน ุงูุนููุจุงุช ูู `DelayPenaltyType` enum:

| ุงูููุน | ุงูุฑูุฒ | ุงููุตู |
|---|---|---|
| **ุฅูุฐุงุฑ** | `WARNING` | ุชุญุฐูุฑ ุฑุณูู ูุชู ุชุณุฌููู ูู ููู ุงูููุธู. |
| **ุฎุตู ูุงูู** | `DEDUCTION` | ุฎุตู ูุจูุบ ูุงูู ูุญุฏุฏ ูู ุงูุฑุงุชุจ. |
| **ุฎุตู ุฃูุงู** | `DAY_CUT` | ุฎุตู ููู ุฃู ุฃูุซุฑ ูู ุฃูุงู ุงูุนููุ ููุชู ุงุญุชุณุงุจ ูููุชูุง ูู ุงูุฑุงุชุจ. |
| **ุฅููุงู ุนู ุงูุนูู** | `SUSPENSION` | **ุฃููู ุนููุจุฉ**ุ ุชุคุฏู ุฅูู ุฅููุงู ุงูููุธู ูุฑุงุชุจู ุจุงููุงูู. |

---

## ๐ ุฏูุฑุฉ ุญูุงุฉ ุงูุนููุจุฉ (Workflow)

```mermaid
graph TD
    A[ุฅูุดุงุก ุนููุจุฉ] --> B{ุงูุญุงูุฉ: ูุนููุฉ (Pending)};
    A -- ุชููุงุฆู ๐ค --> B;
    A -- ูุฏูู ๐ค --> B;

    B --> C[ููุงููุฉ ุงููุฏูุฑ];
    B --> D[ุฑูุถ ุงููุฏูุฑ];

    C --> E{ุงูุญุงูุฉ: ูุนุชูุฏุฉ (Approved)};
    D --> F{ุงูุญุงูุฉ: ูุฑููุถุฉ (Rejected)};

    E --> G{ูู ุงูููุน ุฅููุงูุ};
    G -- ูุนู --> H[ุชุญุฏูุซ ุญุงูุฉ ุงูููุธู ุฅูู 'ููููู' ๐ซ];
    G -- ูุง --> I[ุชุทุจูู ุงูุฎุตู ูู ูุธุงู ุงูุฑูุงุชุจ ๐ฐ];

    H --> J[ุงูุชุธุงุฑ ูุฑุงุฑ ุฑูุน ุงูุฅููุงู...];
    J --> K[ุฑูุน ุงูุฅููุงู];
    K --> L[ุนูุฏุฉ ุงูููุธู ุฅูู 'ูุดุท' โ];
```

---

## ๐ค ุงูุนููุจุงุช ุงูุชููุงุฆูุฉ (Auto-Penalties)

**ุงูููู:** `auto-penalties-scheduler.ts`

ูุฐู ูู ุงูููุฒุฉ ุงูุฃูุซุฑ ุฐูุงุกู ูู ุงููุธุงูุ ุญูุซ ุชูุบู ุงูุญุงุฌุฉ ูููุชุงุจุนุฉ ุงููุฏููุฉ.

### ุขููุฉ ุงูุนูู:

1.  **ุฌุฏููุฉ ููููุฉ (Cron Job):** ูู ููู ูู ุชูุงู ุงูุณุงุนุฉ 9:00 ุตุจุงุญูุงุ ูููู ุงููุธุงู ุจุชุดุบูู ูููุฉ ูุฌุฏููุฉ.
2.  **ูุญุต ุงูุฅุฌุงุฒุงุช ุงููุชุฃุฎุฑุฉ:** ุชุจุญุซ ุงููููุฉ ูู ุฌุฏูู `HR_EmployeeLeave` ุนู ุงูุฅุฌุงุฒุงุช ุงูุชู ููุทุจู ุนูููุง:
    -   `actualReturnDate` ูู ููุณุฌู ุจุนุฏ (`is null`).
    -   ุชุงุฑูุฎ ุงูููู ูุฏ ุชุฌุงูุฒ `endDate` ุจุฎูุณุฉ ุฃูุงู ุฃู ุฃูุซุฑ.
3.  **ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุนููุจุฉ ุณุงุจูุฉ:** ูุชุฃูุฏ ุงููุธุงู ูู ุนุฏู ูุฌูุฏ ุนููุจุฉ ุชุฃุฎูุฑ ูุฑุชุจุทุฉ ุจููุณ ุงูุฅุฌุงุฒุฉ ูููุน ุชูุฑุงุฑ ุงูุนููุจุงุช.
4.  **ุฅูุดุงุก ุงูุนููุจุฉ:**
    -   ุฅุฐุง ุชุญููุช ุงูุดุฑูุทุ ูููู ุงููุธุงู ุจุฅูุดุงุก ุณุฌู ุฌุฏูุฏ ูู `HR_AppliedPenalty`.
    -   ูุชู ุชุญุฏูุฏ ููุน ุงูุนููุจุฉ (ูุซู `DAY_CUT`) ุจูุงุกู ุนูู ุงูุณูุงุณุงุช ุงููุญุฏุฏุฉ ูู `HR_DelayPenaltyPolicy`.
    -   ูุชู ุชูุนูู ุนูุงูุฉ `isAutoCreated: true` ูุชูููุฒูุง ูุนููุจุฉ ุชููุงุฆูุฉ.
    -   ุชููู ุญุงูุชูุง ุงูุฃูููุฉ `PENDING`.
5.  **ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช:**
    -   **ุฅุดุนุงุฑ ููุฑู:** ูุชู ุฅุฑุณุงู ุฑุณุงูุฉ ููุฑูุฉ ุฅูู ุฌููุน ุงููุฏุฑุงุก ูุฅุนูุงููู ุจูุฌูุฏ ุนููุจุฉ ุฌุฏูุฏุฉ ุชุญุชุงุฌ ุฅูู ูุฑุงุฌุนุฉ.
    -   **ููุฎุต ูููู:** ูู ููุงูุฉ ุงููููุฉุ ูุชู ุฅุฑุณุงู ููุฎุต ุจุฌููุน ุงูุนููุจุงุช ุงูุชููุงุฆูุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ูู ุฐูู ุงูููู.

---

## ๐ซ ูุธุงู ุงูุฅููุงู ุนู ุงูุนูู (Suspension)

ูุฐุง ุงููุธุงู ูู ูุชูุฌุฉ ุงูุชูุงูู ุงููุจุงุดุฑ ุจูู ุงูุนููุจุงุช ูุญุงูุฉ ุงูููุธู.

### ุชูุนูู ุงูุฅููุงู

**ุงูููู:** `penalties.handler.ts` (ุถูู ููุทู ุงูููุงููุฉ)

ูุง ูุชู ุชูุนูู ุงูุฅููุงู ูุจุงุดุฑุฉุ ุจู ูู **ูุชูุฌุฉ ููููุงููุฉ ุนูู ุนููุจุฉ ูู ููุน `SUSPENSION`**.

**ุงูุณููุงุฑูู:**
1.  ูุฏูุฑ ูููู ุจุฅูุดุงุก ุนููุจุฉ ูุฏููุฉ (ุฃู ููุงูู ุนูู ุนููุจุฉ ุชููุงุฆูุฉ) ููุฎุชุงุฑ ููุนูุง `SUSPENSION`.
2.  ุนูุฏูุง ูุถุบุท ูุฏูุฑ ุขุฎุฑ ุนูู "ููุงููุฉ" ุนูู ูุฐู ุงูุนููุจุฉุ ูููู ุงููุธุงู ุจุชูููุฐ ุงูุฅุฌุฑุงุกุงุช ุงูุชุงููุฉ **ุชููุงุฆููุง**:
    -   ุชุญุฏูุซ ุญุงูุฉ ุงูุนููุจุฉ ุฅูู `APPROVED`.
    -   **ุงูุฃูู:** ุชุญุฏูุซ ุณุฌู ุงูููุธู ูู ุฌุฏูู `Employee` ูุชุบููุฑ `employmentStatus` ุฅูู `SUSPENDED`.

**ุงูุขุซุงุฑ ุงููุชุฑุชุจุฉ ุนูู ุงูููุธู ุงูููููู:**
-   **ูุชููู ุฑุงุชุจู:** ูุธุงู ุงูุฑูุงุชุจ ูุชุฌุงูู ุฃู ุฃูุงู ุนูู ุจุนุฏ ุชุงุฑูุฎ ุจุฏุก ุงูุฅุฌุงุฒุฉ ุงูุชู ุฃุฏุช ููุฅููุงู.
-   **ูุฎุชูู ูู ุงูููุงุฆู:** ูุง ูุธูุฑ ุงุณูู ูู ููุงุฆู ุงุฎุชูุงุฑ ุงูููุธููู ุนูุฏ ุชุณุฌูู ุฅุฌุงุฒุงุช ุฃู ุณูู ุฌุฏูุฏุฉ.
-   **ููููุน ูู ุชุณุฌูู ุงูุนูุฏุฉ:** ูุธุงู ุงูุฅุฌุงุฒุงุช ูุฑูุถ ุชุณุฌูู ุนูุฏุชู ุญุชู ูุชู ุฑูุน ุงูุฅููุงู.

### ุฑูุน ุงูุฅููุงู

**ุงูููู:** `lift-suspensions.handler.ts`

ูุฐู ูู ุงููุงุฌูุฉ ุงููุฎุตุตุฉ ููุนุงูุฌุฉ ุญุงูุงุช ุงูููุธููู ุงูููููููู.

**ุงูุฎุทูุงุช:**
1.  ููุชุญ ุงููุฏูุฑ ูุงุฌูุฉ "ุฑูุน ุงูุฅููุงูุงุช" ุงูุชู ุชุนุฑุถ ูุงุฆูุฉ ุจุงูููุธููู ุงูููููููู ุญุงูููุง.
2.  ูุฎุชุงุฑ ุงููุฏูุฑ ุงูููุธู ุงููุฑุงุฏ ุฑูุน ุงูุฅููุงู ุนูู.
3.  ูุธูุฑ ุฎูุงุฑุงู:

    #### ุฃ) ุฑูุน ุงูุฅููุงู ุจุฏูู ุนููุจุฉ (ูุนุฐุฑ ููุจูู)
    -   **ูุชู:** ุฅุฐุง ูุฏู ุงูููุธู ุนุฐุฑูุง ููุจููุงู ูุชุฃุฎูุฑู (ูุซู ุชูุฑูุฑ ุทุจู).
    -   **ุงูุฅุฌุฑุงุก:**
        1.  ูุฎุชุงุฑ ุงููุฏูุฑ "ุฑูุน ุจุฏูู ุนููุจุฉ".
        2.  ููุชุจ ุณุจุจ ุฑูุน ุงูุฅููุงู (ููุชูุซูู).
        3.  ูููู ุงููุธุงู ุจู:
            -   ุชุบููุฑ ุญุงูุฉ ุงูููุธู `employmentStatus` ูุฑุฉ ุฃุฎุฑู ุฅูู `ACTIVE`.
            -   **ุฅูุบุงุก** ุนููุจุฉ ุงูุฅููุงู ุงูุฃุตููุฉ (ุชุบููุฑ ุญุงูุชูุง ุฅูู `CANCELLED`).

    #### ุจ) ุฑูุน ุงูุฅููุงู ูุน ุนููุจุฉ ุจุฏููุฉ (ุฎุตู ุฃูุงู)
    -   **ูุชู:** ุฅุฐุง ูู ููู ููุงู ุนุฐุฑ ููุจููุ ูููู ุชูุฑุฑ ุงุณุชุจุฏุงู ุนููุจุฉ ุงูุฅููุงู ุจุฎุตู.
    -   **ุงูุฅุฌุฑุงุก:**
        1.  ูุฎุชุงุฑ ุงููุฏูุฑ "ุฑูุน ูุน ุนููุจุฉ ุฎุตู ุฃูุงู".
        2.  ููุฏุฎู ุนุฏุฏ ุฃูุงู ุงูุฎุตู.
        3.  ูููู ุงููุธุงู ุจู:
            -   ุชุบููุฑ ุญุงูุฉ ุงูููุธู `employmentStatus` ุฅูู `ACTIVE`.
            -   **ุฅูุบุงุก** ุนููุจุฉ ุงูุฅููุงู ุงูุฃุตููุฉ.
            -   **ุฅูุดุงุก ุนููุจุฉ ุฌุฏูุฏุฉ** ูู ููุน `DAY_CUT` ุจุนุฏุฏ ุงูุฃูุงู ุงููุญุฏุฏุ ูุชููู ุญุงูุชูุง `APPROVED` ูุจุงุดุฑุฉ.

---

## ๐๏ธ ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ ูููุฏูุฑ

### 1. ูุฑุงุฌุนุฉ ุงูุนููุจุงุช ุงููุนููุฉ
-   **ุงููุตูู:** `ุฅุฏุงุฑุฉ ุงูุนููุจุงุช` -> `ุงูุนููุจุงุช ุงููุนููุฉ`.
-   **ุงููุธููุฉ:** ุนุฑุถ ูุงุฆูุฉ ุจุฌููุน ุงูุนููุจุงุช (ุงููุฏููุฉ ูุงูุชููุงุฆูุฉ) ุงูุชู ุชูุชุธุฑ ุงูููุงููุฉ.
-   **ุงูุฅุฌุฑุงุกุงุช:** ููุงููุฉ / ุฑูุถ / ุนุฑุถ ุงูุชูุงุตูู.

### 2. ุนุฑุถ ุณุฌู ุงูุนููุจุงุช
-   **ุงููุตูู:** ูููู ุงููุตูู ุฅููู ูู ุจุทุงูุฉ ุงูููุธู ุฃู ูู ูุณู ุงูุชูุงุฑูุฑ.
-   **ุงููุธููุฉ:** ุนุฑุถ ุชุงุฑูุฎ ุฌููุน ุงูุนููุจุงุช ูููุธู ูุนูู ุฃู ูุฌููุน ุงูููุธููู.
-   **ุงูุฅุฌุฑุงุกุงุช:** ููุชุฑุฉ ุญุณุจ ุงูููุน ุฃู ุงูุชุงุฑูุฎุ ูุชุตุฏูุฑ ุฅูู Excel.

### 3. ุฅุฏุงุฑุฉ ุณูุงุณุงุช ุงูุนููุจุงุช
-   **ุงููุตูู:** `ุงูุฅุนุฏุงุฏุงุช` -> `ุณูุงุณุงุช ุงูุนููุจุงุช`.
-   **ุงููุธููุฉ:** ูุงุฌูุฉ ูุชุนุฑูู ูุชุนุฏูู ููุงุนุฏ ุงูุนููุจุงุช.
-   **ูุซุงู:**
    -   ุชุฃุฎูุฑ ูู 5-10 ุฃูุงู -> ุฎุตู 3 ุฃูุงู.
    -   ุชุฃุฎูุฑ ูู 11-20 ููู -> ุฎุตู 7 ุฃูุงู.
    -   ุชุฃุฎูุฑ ุฃูุซุฑ ูู 20 ููู -> ุฅููุงู ุนู ุงูุนูู.

---

## ๐ ุงููููุงุช ุงูุจุฑูุฌูุฉ ุงููุฑุชุจุทุฉ

| ุงูููู | ุงููุตู |
|---|---|
| `penalties.handler.ts` | ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ ูุฅุฏุงุฑุฉ ุงูุนููุจุงุช (ุฅูุดุงุก ูุฏููุ ุนุฑุถุ ููุงููุงุช). |
| `lift-suspensions.handler.ts` | ุงููุงุฌูุฉ ุงููุฎุตุตุฉ ูุนุฑุถ ุงูููุธููู ุงูููููููู ูุฑูุน ุงูุฅููุงู ุนููู. |
| `auto-penalties-scheduler.ts` | ุงููููุฉ ุงููุฌุฏููุฉ ุงูุชู ุชูุดุฆ ุงูุนููุจุงุช ุงูุชููุงุฆูุฉ ูููููุง. |
| `penalties-notifications.service.ts` | ุฎุฏูุฉ ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช ุงููุชุนููุฉ ุจุงูุนููุจุงุช. |
| `penalties-export.service.ts` | ุฎุฏูุฉ ุชุตุฏูุฑ ุชูุงุฑูุฑ ุงูุนููุจุงุช. |

---

## ๐๏ธ ุงูุฌุฏุงูู ุงููุฑุชุจุทุฉ ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

-   **`HR_AppliedPenalty`**: ุงูุฌุฏูู ุงููุฑูุฒู ุงูุฐู ูุณุฌู ูู ุนููุจุฉ ูุชู ุชุทุจูููุงุ ุณูุงุก ูุงูุช ูุฏููุฉ ุฃู ุชููุงุฆูุฉ.
    -   **ุญููู ูููุฉ:** `penaltyType`, `status`, `isAutoCreated`, `employeeId`, `leaveId`.
-   **`HR_DelayPenaltyPolicy`**: ุฌุฏูู ุงูุฅุนุฏุงุฏุงุช ุงูุฐู ูุญุชูู ุนูู ุณูุงุณุงุช ุงูุนููุจุงุช ุงูุชู ูุณุชุฎุฏููุง ุงููุธุงู ูุฅูุดุงุก ุงูุนููุจุงุช ุงูุชููุงุฆูุฉ.
-   **`Employee`**: ูุชุฃุซุฑ ูุจุงุดุฑุฉ ุจุชุบููุฑ ุงูุญูู `employmentStatus` ุฅูู `SUSPENDED` ุฃู `ACTIVE`.
-   **`HR_EmployeeLeave`**: ูุฑุชุจุท ุจุงูุนููุจุฉ ุนุจุฑ `leaveId` ูุชุญุฏูุฏ ุณุจุจ ุงูุนููุจุฉ.