# ุชุญููู ูุธุงู ุงูุตูุงุญูุงุช ุงูุญุงูู
## Department & SubFeature Admin System

ุชุงุฑูุฎ ุงูุชุญููู: 29 ุฃูุชูุจุฑ 2025

---

## ๐ ุงููุถุน ุงูุญุงูู

### 1๏ธโฃ **ุนูุฏ ุชุนููู ุฃุฏูู ุนูู ุงููุณู (Department Admin)**

โ **ูุนูุ ูุญุตู ุนูู ุตูุงุญูุงุช ุฌููุน ุงููุธุงุฆู ุงููุฑุนูุฉ ุชููุงุฆูุงู**

#### ููู ูุนูู ุงููุธุงูุ

ุนูุฏ ูุญุต ุตูุงุญูุฉ ุงููุตูู ููุธููุฉ ูุฑุนูุฉ ูู `PermissionService.canAccessSubFeature()`:

```typescript
// 1. SUPER_ADMIN ููููู ุงููุตูู ููู ุดูุก
if (userContext.role === 'SUPER_ADMIN') {
  return true
}

// 2. ุฅุฐุง ูุงู ุงููุธููุฉ ููุท ููุณูุจุฑ ุฃุฏูู
if (subFeature.superAdminOnly) {
  return userContext.role === 'SUPER_ADMIN'
}

// 3. ูุญุต ุฅุฐุง ูุงู ูุนูู ุนูู ุงููุธููุฉ ุงููุฑุนูุฉ ููุณูุง
const isAssigned = await this.isSubFeatureAdmin(...)
if (isAssigned) {
  return true
}

// 4. โญ ูุญุต ุฅุฐุง ูุงู ูุนูู ูุฃุฏูู ุนูู ุงููุณู ุงูุฃุจ
const departmentCode = subFeature.departmentCode
return await this.isDepartmentAdmin(userContext.telegramId, departmentCode)
```

**ุงูุฎุทูุฉ 4 ูู ุงูููุชุงุญ**: ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ุฃุฏูู ุนูู ุงููุณูุ ูุญุตู ุชููุงุฆูุงู ุนูู ุงููุตูู ููู ุงููุธุงุฆู ุงููุฑุนูุฉ ุฏุงุฎู ูุฐุง ุงููุณู.

---

## ๐ฏ ูุณุชููุงุช ุงูุตูุงุญูุงุช

### ุงููุณุชูู 1: SUPER_ADMIN
- **ุงููุตูู**: ุฌููุน ุงูุฃูุณุงู + ุฌููุน ุงููุธุงุฆู
- **ุงููููุฏ**: ูุง ููุฌุฏ
- **ุงูุชุนููู**: ูู ุฎูุงู ุชุบููุฑ ุฏูุฑ ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงููุณุชูู 2: Department Admin (ุฃุฏูู ุงููุณู)
- **ุงููุตูู**: ุฌููุน ุงููุธุงุฆู ุงููุฑุนูุฉ ูู ุงููุณู ุงููุนูู ุนููู
- **ุงููููุฏ**: 
  - โ ูุง ููููู ุงููุตูู ูููุธุงุฆู ุงููุญุฏุฏุฉ ุจู `superAdminOnly: true`
  - โ ููููู ุงููุตูู ูุจุงูู ุงููุธุงุฆู
- **ุงูุชุนููู**: ูู ุฎูุงู ูุงุฆูุฉ "ุฅุฏุงุฑุฉ ูุณู ุดุฆูู ุงูุนุงูููู" โ "ุฅุฏุงุฑุฉ ุฃุฏูู ุงููุณู"
- **ุงูุฌุฏูู ูู DB**: `DepartmentAdmin`

### ุงููุณุชูู 3: SubFeature Admin (ุฃุฏูู ูุธููุฉ ูุฑุนูุฉ)
- **ุงููุตูู**: ูุธููุฉ ูุงุญุฏุฉ ููุท ูุญุฏุฏุฉ
- **ุงููููุฏ**: 
  - โ ูุง ููููู ุงููุตูู ูุจุงูู ูุธุงุฆู ุงููุณู
  - โ ููููู ุงููุตูู ูููุธููุฉ ุงููุนููุฉ ููุท
- **ุงูุชุนููู**: ูู ุฎูุงู "ุฅุฏุงุฑุฉ ูุณู ุดุฆูู ุงูุนุงูููู" โ "ุฅุฏุงุฑุฉ ุงููุธุงุฆู ุงููุฑุนูุฉ"
- **ุงูุฌุฏูู ูู DB**: `SubFeatureAdmin`

---

## ๐ ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุชุนููู ุนูู ุงููุณู
```
ุงููุณุชุฎุฏู: ุฃุญูุฏ (ุฏูุฑ ADMIN)
ุงูุชุนููู: DepartmentAdmin ุนูู 'hr-management'

ุงููุชูุฌุฉ:
โ ููููู ุงููุตูู ูู "ููุงุฆู ุงูุนุงูููู"
โ ููููู ุงููุตูู ูู "ุงูุณูู ูุงููุณุญูุจุงุช"  
โ ููููู ุงููุตูู ูู "ุงูุฅุฌุงุฒุงุช ูุงููุงููุฑูุงุช"
โ ูุง ููููู ุงููุตูู ูู "ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑ" (superAdminOnly)
โ ูุง ููููู ุงููุตูู ูู "ุงูุชูุงุฑูุฑ ุงููุฎุตุตุฉ" (superAdminOnly)
```

### ูุซุงู 2: ุชุนููู ุนูู ูุธููุฉ ูุฑุนูุฉ ููุท
```
ุงููุณุชุฎุฏู: ูุญูุฏ (ุฏูุฑ ADMIN)
ุงูุชุนููู: SubFeatureAdmin ุนูู 'hr:employees-list'

ุงููุชูุฌุฉ:
โ ููููู ุงููุตูู ูู "ููุงุฆู ุงูุนุงูููู"
โ ูุง ููููู ุงููุตูู ูู "ุงูุณูู ูุงููุณุญูุจุงุช"
โ ูุง ููููู ุงููุตูู ูู "ุงูุฅุฌุงุฒุงุช ูุงููุงููุฑูุงุช"
โ ูุง ููููู ุงููุตูู ูุจุงูู ุงููุธุงุฆู
```

### ูุซุงู 3: ุชุนููู ูุฒุฏูุฌ
```
ุงููุณุชุฎุฏู: ุณุงุฑุฉ (ุฏูุฑ ADMIN)
ุงูุชุนููู 1: DepartmentAdmin ุนูู 'hr-management'
ุงูุชุนููู 2: SubFeatureAdmin ุนูู 'hr:payroll' (ุชู ุฅูุบุงุก superAdminOnly)

ุงููุชูุฌุฉ:
โ ูููููุง ุงููุตูู ูุฌููุน ุงููุธุงุฆู ุนุจุฑ Department Admin
โ ุงูุชุนููู ุงูุซุงูู (SubFeatureAdmin) ุบูุฑ ุถุฑูุฑู ูุฃููุง ุจุงููุนู ูุฏููุง ุงููุตูู
```

---

## ๐ ุงููุธุงุฆู ูู ูุณู ุดุฆูู ุงูุนุงูููู

| ุงููุธููุฉ | ุงูููุฏ | superAdminOnly | ููุงุญุธุงุช |
|---------|------|----------------|---------|
| ููุงุฆู ุงูุนุงูููู | `employees-list` | โ | ูููู ุชุนููู ุฃุฏูู ุนูููุง |
| ุงูุณูู ูุงููุณุญูุจุงุช | `advances` | โ | ูููู ุชุนููู ุฃุฏูู ุนูููุง |
| ุงูุฅุฌุงุฒุงุช ูุงููุงููุฑูุงุช | `leaves` | โ | ูููู ุชุนููู ุฃุฏูู ุนูููุง |
| ุงูุฑูุงุชุจ ูุงูุฃุฌูุฑ | `payroll` | โ | ููุท SUPER_ADMIN |
| ุงูุชูุงุฑูุฑ ุงููุฎุตุตุฉ | `custom-reports` | โ | ููุท SUPER_ADMIN |
| ุฅุฏุงุฑุฉ ุงููุณู | `section-management` | โ | ููุท SUPER_ADMIN |

---

## ๐ก ุงูุชูุตูุงุช ูุงููุฑููุฉ

### ุงููุถุน ุงูุญุงูู ูุฑู โ

ุงููุธุงู ุงูุญุงูู ูุฏุนู:

1. **ุชุนููู ุดุงูู**: ุชุนููู ุฃุฏูู ุนูู ุงููุณู ุจุงููุงูู (ูุญุตู ุนูู ูู ุงููุธุงุฆู)
2. **ุชุนููู ุฏููู**: ุชุนููู ุฃุฏูู ุนูู ูุธููุฉ ูุงุญุฏุฉ ููุท
3. **ุญูุงูุฉ ุงููุธุงุฆู ุงูุญุณุงุณุฉ**: ุนุจุฑ `superAdminOnly`
4. **ุชุนููู ูุชุนุฏุฏ**: ูููู ูููุณุชุฎุฏู ุฃู ูููู ุฃุฏูู ุนูู ุนุฏุฉ ุฃูุณุงู ุฃู ูุธุงุฆู

### ุงูุญุงูุงุช ุงููุฏุนููุฉ:

โ ูุณุชุฎุฏู ูุนูู ุนูู ูุณู ูุงุญุฏ โ ูุตู ููู ุงููุธุงุฆู ูู ูุฐุง ุงููุณู
โ ูุณุชุฎุฏู ูุนูู ุนูู ุนุฏุฉ ุฃูุณุงู โ ูุตู ููู ุงููุธุงุฆู ูู ุฌููุน ุงูุฃูุณุงู
โ ูุณุชุฎุฏู ูุนูู ุนูู ูุธููุฉ ูุงุญุฏุฉ โ ูุตู ููุฐู ุงููุธููุฉ ููุท
โ ูุณุชุฎุฏู ูุนูู ุนูู ุนุฏุฉ ูุธุงุฆู โ ูุตู ููุฐู ุงููุธุงุฆู ููุท
โ ูุฒูุฌ: ูุนูู ุนูู ูุณู + ูุธุงุฆู ูุญุฏุฏุฉ ูู ุฃูุณุงู ุฃุฎุฑู

---

## ๐๏ธ ุฎูุงุฑุงุช ุงูุชุฎุตูุต (ุฅุฐุง ุฃุฑุฏุช ุชุบููุฑ ุงูุณููู)

### ุฎูุงุฑ 1: ุฅุจูุงุก ุงููุถุน ุงูุญุงูู (ููุตู ุจู โ)
**ุงููููุฒุงุช:**
- ุณูู ุงูุฅุฏุงุฑุฉ
- ุชุนููู ุณุฑูุน (ุชุนููู ูุงุญุฏ = ูู ุงููุธุงุฆู)
- ูุฑู (ูููู ุงูุชุนููู ุนูู ูุณุชูู ุงููุณู ุฃู ุงููุธููุฉ)

**ุงูุนููุจ:**
- ูุง ููุฌุฏ ุชุญูู ุฏููู ููู ูุธููุฉ ุนูุฏ ุงูุชุนููู ุนูู ุงููุณู

### ุฎูุงุฑ 2: ุฅูุบุงุก ุงููุฑุงุซุฉ ูู ุงููุณู
ุชุนุฏูู `canAccessSubFeature()` ูุนุฏู ูุญุต `isDepartmentAdmin`

**ุงููููุฒุงุช:**
- ุชุญูู ุฏููู 100%
- ูู ูุธููุฉ ุชุญุชุงุฌ ุชุนููู ูููุตู

**ุงูุนููุจ:**
- โ ุนูููุฉ ุทูููุฉ (ุชุนููู ูู ูุธููุฉ ุนูู ุญุฏุฉ)
- โ ุตุนูุจุฉ ุงูุฅุฏุงุฑุฉ ูุน ุนุฏุฏ ูุจูุฑ ูู ุงููุธุงุฆู
- โ ุงุญุชูุงููุฉ ุงูุฎุทุฃ (ูุณูุงู ุชุนููู ูุธููุฉ)

### ุฎูุงุฑ 3: ุฅุถุงูุฉ ุฎูุงุฑ "ุชุนููู ูุญุฏุฏ" ููู ูุณู
ุฅุถุงูุฉ ุญูู `granularPermissions: boolean` ูู `DepartmentAdmin`

```prisma
model DepartmentAdmin {
  // ... ุงูุญููู ุงูููุฌูุฏุฉ
  granularPermissions Boolean @default(false)
  // ุฅุฐุง true: ูุง ูุญุตู ุนูู ุงููุตูู ุงูุชููุงุฆูุ ูุญุชุงุฌ ุชุนููู ุนูู ูู ูุธููุฉ
}
```

**ุงููููุฒุงุช:**
- โ ุฃูุถู ูุง ูู ุงูุนุงูููู
- โ ูุฑููุฉ ูุงููุฉ ููู ุญุงูุฉ

**ุงูุนููุจ:**
- ูุญุชุงุฌ ุชุนุฏูู ูู ุงูููุฏ
- ุฒูุงุฏุฉ ูู ุงูุชุนููุฏ

---

## ๐ ุงูุฎูุงุตุฉ

### ุงูุฅุฌุงุจุฉ ุนูู ุณุคุงูู:

**โ ูุนูุ ุนูุฏ ุชุนููู ุฃุฏูู ุนูู ุงููุณูุ ูุญุตู ุชููุงุฆูุงู ุนูู ุตูุงุญูุงุช ุฌููุน ุงููุธุงุฆู ุงููุฑุนูุฉ**  
(ูุง ุนุฏุง ุงููุธุงุฆู ุงููุญุฏุฏุฉ ุจู `superAdminOnly: true`)

### ูุง ุชุญุชุงุฌ ุฅูู:
โ ุชุนููู ุนูู ุงููุณู **ุซู** ุนูู ูู ูุธููุฉ ูุฑุนูุฉ ูููุตูุฉ

### ููููู ุงูุงุฎุชูุงุฑ:
- **ุฎูุงุฑ A**: ุชุนููู ุนูู ุงููุณู โ ูุตูู ุดุงูู
- **ุฎูุงุฑ B**: ุชุนููู ุนูู ูุธุงุฆู ูุญุฏุฏุฉ ููุท โ ูุตูู ูุญุฏูุฏ
- **ุฎูุงุฑ C**: ูุฒูุฌ ูู ุงูุงุซููู

### ุงููุธุงู ุงูุญุงูู ูุฑู ุฌุฏุงู โ
ููุฏุนู ุฌููุน ุงูุญุงูุงุช ุฏูู ุงูุญุงุฌุฉ ูุชุนุฏููุงุช!

---

## ๐ง ูู ุชุฑูุฏ ุชุนุฏููุงุชุ

ุฅุฐุง ููุช ุชุฑูุฏ ุชุบููุฑ ูุฐุง ุงูุณูููุ ูุฑุฌู ุชุญุฏูุฏ ุฃู ูู ุงูุฎูุงุฑุงุช ุงูุซูุงุซุฉ ุฃุนูุงู ุชูุถูุ ูุณุฃููู ุจุงูุชุนุฏููุงุช ุงููุงุฒูุฉ.
