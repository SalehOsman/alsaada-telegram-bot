# ๐ ูุธุงู ุชูุงุฑูุฑ ุงูุฅุฌุงุฒุงุช ุงูุงุญุชุฑุงูู

## ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ูุชูุงูู ูุฅูุดุงุก ุชูุงุฑูุฑ Excel ุงุญุชุฑุงููุฉ ูููุณูุฉ ููุฅุฌุงุฒุงุช ูุน ููุงุชุฑ ูุชูุฏูุฉ ูุฅุญุตุงุฆูุงุช ุดุงููุฉ.

---

## โจ ุงููููุฒุงุช

### 1. **ุชูุงุฑูุฑ ูุชุนุฏุฏุฉ ุงููุณุชููุงุช**
- ๐ **ุชูุฑูุฑ ุดุงูู**: ุฌููุน ุงูุฅุฌุงุฒุงุช ุจุฏูู ููุงุชุฑ
- ๐ **ุชูุฑูุฑ ูุฎุตุต**: ูุน ููุงุชุฑ ุงุญุชุฑุงููุฉ ูุงุจูุฉ ููุชุฎุตูุต
- ๐ **ุชูุงุฑูุฑ ุณุฑูุนุฉ**: ุชูุงุฑูุฑ ุฌุงูุฒุฉ ููุญุงูุงุช ุงูุดุงุฆุนุฉ

### 2. **ููุงุชุฑ ุงุญุชุฑุงููุฉ ุดุงููุฉ**

#### ููุงุชุฑ ุงููุชุฑุฉ ุงูุฒูููุฉ
- ๐ ุชุญุฏูุฏ ูู ุชุงุฑูุฎ - ุฅูู ุชุงุฑูุฎ
- ๐ ููุงุชุฑ ุณุฑูุนุฉ (ุงูุดูุฑ ุงูุญุงููุ ุงูุฑุจุน ุงูุญุงููุ ุงูุณูุฉ)

#### ููุงุชุฑ ุงูููุธููู
- ๐ค **ููุธู ูุญุฏุฏ**: ุงุฎุชูุงุฑ ููุธู ูุงุญุฏ
- ๐ผ **ูุธููุฉ**: ุฌููุน ููุธูู ูุธููุฉ ูุนููุฉ
- ๐ข **ูุณู**: ุฌููุน ููุธูู ูุณู ูุนูู

#### ููุงุชุฑ ุงูุฅุฌุงุฒุงุช
- ๐ **ููุน ุงูุฅุฌุงุฒุฉ**: ุงุนุชูุงุฏูุฉุ ูุฑุถูุฉุ ุนุงุฑุถุฉุ ุจุฏูู ูุฑุชุจ
- ๐ **ููุน ุงูุชุณููุฉ**: ูุนููุฉุ ููุฏูุฉุ ูุคุฌูุฉ
- โ **ุงูุญุงูุฉ**: ููุฏ ุงูููุงููุฉุ ููุงููุ ูุฑููุถ

#### ููุงุชุฑ ุงูุชุณููุงุช ุงูููุฏูุฉ
- ๐ฐ **ููุง ุจุฏู ููุฏู**: ููุท ุงูุฅุฌุงุฒุงุช ุงูุชู ููุง ุจุฏู
- ๐ต **ุงููุณูุงุฉ**: ุงูุชู ุชู ุตุฑู ุจุฏููุง
- โณ **ุบูุฑ ูุณูุงุฉ**: ูู ุงูุชุธุงุฑ ุงูุตุฑู

#### ููุงุชุฑ ุฃูุงู ุงูุชุฃุฎูุฑ
- โฐ **ููุท ุงููุชุฃุฎุฑุฉ**: ุฅุฌุงุฒุงุช ุจูุง ุฃู ุชุฃุฎูุฑ
- **ุญุฏ ุฃุฏูู ููุชุฃุฎูุฑ**: > ูููุ > ูููููุ > 3 ุฃูุงูุ > 5 ุฃูุงู

#### ููุงุชุฑ ุญุงูุฉ ุงูุนูุฏุฉ
- โ **ุชู ุชุณุฌูู ุงูุนูุฏุฉ**: ุงูุนุงูููู ุงูุฐูู ุนุงุฏูุง
- ๐ **ูู ูุนุฏ**: ุงูุฅุฌุงุฒุงุช ุงูููุชูุญุฉ

### 3. **ุชูุงุฑูุฑ ุณุฑูุนุฉ ุฌุงูุฒุฉ**
- ๐ **ุฅุฌุงุฒุงุช ุงูุดูุฑ ุงูุญุงูู**
- โฐ **ุงูุฅุฌุงุฒุงุช ุงููุชุฃุฎุฑุฉ**
- ๐ฐ **ุงูุชุณููุงุช ุงูููุฏูุฉ**
- โณ **ููุฏ ุงูููุงููุฉ**
- ๐ **ุงูุฅุฌุงุฒุงุช ุงูููุชูุญุฉ**

---

## ๐ ูุญุชููุงุช ููู Excel

### Sheet 1: ๐ ุงูููุฎุต ูุงูุฅุญุตุงุฆูุงุช
- **ุงูุฅุญุตุงุฆูุงุช ุงูุนุงูุฉ**
  - ุฅุฌูุงูู ุงูุฅุฌุงุฒุงุช
  - ุฅุฌูุงูู ุงูุฃูุงู
  - ุนุฏุฏ ุงูููุธููู
  - ูุชูุณุท ุงูุฃูุงู ููู ุฅุฌุงุฒุฉ

- **ุญุณุจ ููุน ุงูุชุณููุฉ**
  - ๐๏ธ ุฅุฌุงุฒุงุช ูุนููุฉ (ูุน ุงููุณุจุฉ ุงููุฆููุฉ)
  - ๐ฐ ุชุณููุงุช ููุฏูุฉ (ูุน ุงููุณุจุฉ ุงููุฆููุฉ)
  - โธ๏ธ ูุคุฌูุฉ (ูุน ุงููุณุจุฉ ุงููุฆููุฉ)

- **ุญุณุจ ููุน ุงูุฅุฌุงุฒุฉ**
  - ุงุนุชูุงุฏูุฉ
  - ูุฑุถูุฉ
  - ุนุงุฑุถุฉ
  - ุจุฏูู ูุฑุชุจ

- **ุญุณุจ ุงูุญุงูุฉ**
  - โณ ููุฏ ุงูููุงููุฉ
  - โ ููุงูู ุนูููุง
  - โ ูุฑููุถุฉ

- **ุงูุชุณููุงุช ุงูููุฏูุฉ**
  - ุฅุฌูุงูู ุงููุจุงูุบ
  - ุงููุณูุงุฉ / ุบูุฑ ูุณูุงุฉ
  - ูุชูุณุท ุงูุจุฏู

- **ุฃูุงู ุงูุชุฃุฎูุฑ**
  - ุนุฏุฏ ุงูุฅุฌุงุฒุงุช ุงููุชุฃุฎุฑุฉ
  - ุฅุฌูุงูู ุฃูุงู ุงูุชุฃุฎูุฑ
  - ูุชูุณุท ุงูุชุฃุฎูุฑ

- **ุฃุนูู 5 ุฃูุณุงู**
- **ุฃุนูู 5 ูุธุงุฆู**

### Sheet 2: ๐ ุงูุจูุงูุงุช ุงูุชูุตูููุฉ
ุฌุฏูู ุดุงูู ูุญุชูู ุนูู:
- ุฑูู ุงูุฅุฌุงุฒุฉ
- ุงุณู ุงูููุธู ูููุฏู
- ุงููุณู ูุงููุธููุฉ
- ููุน ุงูุฅุฌุงุฒุฉ ูููุน ุงูุชุณููุฉ
- ุงูุชูุงุฑูุฎ (ุจุฏุงูุฉุ ููุงูุฉุ ุนูุฏุฉ ูุนููุฉ)
- ุนุฏุฏ ุงูุฃูุงู ูุฃูุงู ุงูุชุฃุฎูุฑ
- ุงูุญุงูุฉ
- ูุจูุบ ุงูุจุฏู ูุญุงูุฉ ุงูุตุฑู
- ุงูุจุฏูู
- ุงูููุงุญุธุงุช

**ูููุฒุงุช:**
- โ ุชูููู ุชููุงุฆู (ุชุณููุงุช ููุฏูุฉ ุจุงูุฃุตูุฑุ ูุชุฃุฎุฑุฉ ุจุงูุฃุญูุฑ)
- โ ููุงุชุฑ ูุงุจูุฉ ููุชุทุจูู ุนูู ูู ุนููุฏ
- โ ุชุฌููุฏ ุงูุตู ุงูุฃูู

### Sheet 3: ๐๏ธ ุงูุฅุฌุงุฒุงุช ุงููุนููุฉ
(ูุธูุฑ ููุท ุฅุฐุง ูุงูุช ููุงู ุฅุฌุงุฒุงุช ูุนููุฉ)
- ุชุฑููุฒ ุนูู ุงูุฅุฌุงุฒุงุช ุงููุนููุฉ ููุท
- ุจูุงูุงุช ูุจุณุทุฉ ููุนุฑุถ ุงูุณุฑูุน

### Sheet 4: ๐ฐ ุงูุชุณููุงุช ุงูููุฏูุฉ
(ูุธูุฑ ููุท ุฅุฐุง ูุงูุช ููุงู ุชุณููุงุช)
- ุฑูู ุงูุณุฌู
- ุจูุงูุงุช ุงูููุธู
- ุงููุชุฑุฉ ูุงูุฃูุงู
- ุงููุจูุบ ูุญุงูุฉ ุงูุตุฑู
- ุชุงุฑูุฎ ุงูุตุฑู
- **ุตู ุฅุฌูุงูู** ุจุงููุจูุบ ุงูููู

### Sheet 5: โฐ ุงูุฅุฌุงุฒุงุช ุงููุชุฃุฎุฑุฉ
(ูุธูุฑ ููุท ุฅุฐุง ูุงูุช ููุงู ุฅุฌุงุฒุงุช ูุชุฃุฎุฑุฉ)
- ุชูุงุตูู ุงูุฅุฌุงุฒุงุช ุงููุชุฃุฎุฑุฉ
- ุชูููู ุญุณุจ ุดุฏุฉ ุงูุชุฃุฎูุฑ:
  - ๐ด ุฃุญูุฑ ุฏุงูู: ุชุฃุฎูุฑ > 5 ุฃูุงู
  - ๐ ุฃุญูุฑ ูุงุชุญ: ุชุฃุฎูุฑ > 2 ุฃูุงู
- **ุตู ุฅุฌูุงูู** ุจุนุฏุฏ ุฃูุงู ุงูุชุฃุฎูุฑ

### Sheet 6: ๐ ุงูุชุญูููุงุช ูุงูุฑุณูู ุงูุจูุงููุฉ
- ุงูุชูุฒูุน ุญุณุจ ููุน ุงูุชุณููุฉ
- ุงููุนุฏูุงุช ูุงููุชูุณุทุงุช
- ุงูููุงุฑูุงุช (ูุณุจ ุงูููุงููุฉุ ุงูุชุฃุฎูุฑุ ุงูุชุณููุงุช)

---

## ๐ก ุงูููุฎุต ูู ุงูุจูุช

ูุจู ุฅุฑุณุงู ุงููููุ ูุชู ุนุฑุถ ููุฎุต ุงุญุชุฑุงูู ูุญุชูู ุนูู:

```
๐ **ููุฎุต ุชูุฑูุฑ ุงูุฅุฌุงุฒุงุช**
โโโโโโโโโโโโโโโโโโโโ

๐ **ุงููุชุฑุฉ:** ูู [ุชุงุฑูุฎ] ุฅูู [ุชุงุฑูุฎ]

๐ **ุงูุฅุญุตุงุฆูุงุช ุงูุนุงูุฉ:**
โข ุฅุฌูุงูู ุงูุฅุฌุงุฒุงุช: XX
โข ุฅุฌูุงูู ุงูุฃูุงู: XX
โข ุนุฏุฏ ุงูููุธููู: XX
โข ูุชูุณุท ุงูุฃูุงู/ุฅุฌุงุฒุฉ: X.X

๐ **ุญุณุจ ููุน ุงูุชุณููุฉ:**
โข ๐๏ธ ูุนููุฉ: XX (XX%)
โข ๐ฐ ููุฏูุฉ: XX (XX%)
โข โธ๏ธ ูุคุฌูุฉ: XX (XX%)

๐ **ุญุณุจ ููุน ุงูุฅุฌุงุฒุฉ:**
[...]

โ **ุญุณุจ ุงูุญุงูุฉ:**
[...]

๐ฐ **ุงูุชุณููุงุช ุงูููุฏูุฉ:**
[...]

โฐ **ุฃูุงู ุงูุชุฃุฎูุฑ:**
[...]

๐ข **ุฃุนูู ุงูุฃูุณุงู:**
[...]

โโโโโโโโโโโโโโโโโโโโ

๐ฅ **ุณูุชู ุฅุฑุณุงู ููู Excel ุงูุชูุตููู...**
```

---

## ๐จ ุงูุชูุณูู ุงูุงุญุชุฑุงูู

### ุงูุฃููุงู ูุงูุฃููููุงุช
- ๐ต ุงูููุฎุต: ุฃุฒุฑู (#4472C4)
- ๐ข ุงูุจูุงูุงุช: ุฃุฎุถุฑ (#70AD47)
- ๐ต ุงูุฅุฌุงุฒุงุช ุงููุนููุฉ: ุฃุฒุฑู ูุงุชุญ (#5B9BD5)
- ๐ก ุงูุชุณููุงุช ุงูููุฏูุฉ: ุจุฑุชูุงูู (#FFC000)
- ๐ด ุงููุชุฃุฎุฑุฉ: ุฃุญูุฑ (#FF0000)
- ๐ฃ ุงูุชุญูููุงุช: ุจููุณุฌู (#9966FF)

### ุงูุฎุทูุท ูุงูุฃุญุฌุงู
- ุนูุงููู: Arial 18pt Bold
- ุนูุงููู ุงูุฃูุณุงู: 12pt Bold
- ุงูุฌุฏุงูู: ุนูุงููู 25pt height
- ุนุฑุถ ุงูุฃุนูุฏุฉ: ุชููุงุฆู ุญุณุจ ุงููุญุชูู

---

## ๐ ุงูุจููุฉ ุงูุชูููุฉ

### ุงููููุงุช

```
src/
โโโ modules/services/
โ   โโโ leaves-reports-service.ts       # ุฎุฏูุฉ ุฅูุดุงุก ุงูุชูุงุฑูุฑ
โ
โโโ bot/features/hr-management/handlers/
    โโโ leaves-reports.handler.ts       # ูุนุงูุฌ ุงูุชูุงุฑูุฑ
```

### ุงูุฎุฏูุงุช (LeavesReportsService)

#### ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ

```typescript
// ุฌูุจ ุงูุจูุงูุงุช ูุน ุงูููุงุชุฑ
static async getFilteredLeaves(filters: LeavesReportFilters)

// ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช ูุงูููุฎุต
static calculateSummary(leaves, filters): LeavesReportSummary

// ุฅูุดุงุก ููู Excel
static async generateExcelReport(leaves, summary, filters): Buffer

// ุชูุณูู ุงูููุฎุต ููุจูุช
static formatSummaryForBot(summary, filters): string
```

#### ูุงุฌูุงุช ุงูุจูุงูุงุช

```typescript
interface LeavesReportFilters {
  // ุงููุชุฑุฉ
  startDate?: Date
  endDate?: Date
  
  // ุงูููุธู
  employeeId?: number
  positionId?: number
  departmentId?: number
  
  // ุงูููุน
  leaveType?: string
  settlementType?: string
  
  // ุงูุญุงูุฉ
  status?: string
  
  // ุงูุชุณููุงุช
  hasAllowance?: boolean
  allowanceSettled?: boolean
  
  // ุงูุชุฃุฎูุฑ
  hasDelay?: boolean
  minDelayDays?: number
  
  // ุฃุฎุฑู
  hasReturned?: boolean
  isPostponed?: boolean
  isActive?: boolean
}

interface LeavesReportSummary {
  totalLeaves: number
  totalDays: number
  totalEmployees: number
  
  actualLeaves: number
  cashSettlements: number
  postponedLeaves: number
  
  regularLeaves: number
  sickLeaves: number
  emergencyLeaves: number
  unpaidLeaves: number
  
  pendingLeaves: number
  approvedLeaves: number
  rejectedLeaves: number
  
  totalAllowanceAmount: number
  settledAllowances: number
  unsettledAllowances: number
  
  totalDelayDays: number
  leavesWithDelay: number
  
  openLeaves: number
  
  topDepartments: Array<{ name: string, count: number }>
  topPositions: Array<{ name: string, count: number }>
  
  dateRange: { start: Date, end: Date }
}
```

---

## ๐ ุงูุงุณุชุฎุฏุงู

### ูู ุงูุจูุช

1. ุงูุชูู ุฅูู **ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ** โ **ุงูุฅุฌุงุฒุงุช ูุงููุฃููุฑูุงุช**
2. ุงุถุบุท ุนูู **๐ ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช**
3. ุงุฎุชุฑ ููุน ุงูุชูุฑูุฑ:
   - **ุชูุฑูุฑ ุดุงูู**: ุณูุชู ุชุตุฏูุฑ ุฌููุน ุงูุฅุฌุงุฒุงุช
   - **ุชูุฑูุฑ ูุฎุตุต**: ุงุฎุชุฑ ุงูููุงุชุฑ ุงููุทููุจุฉ
   - **ุชูุงุฑูุฑ ุณุฑูุนุฉ**: ุงุฎุชุฑ ูู ุงูููุงุฆู ุงูุฌุงูุฒุฉ

### ูู ุงูููุฏ

```typescript
import { LeavesReportsService } from '#root/modules/services/leaves-reports-service.js'

// ุชุญุฏูุฏ ุงูููุงุชุฑ
const filters: LeavesReportFilters = {
  startDate: new Date('2025-01-01'),
  endDate: new Date('2025-12-31'),
  settlementType: 'CASH_SETTLEMENT',
  hasDelay: true
}

// ุฌูุจ ุงูุจูุงูุงุช
const leaves = await LeavesReportsService.getFilteredLeaves(filters)

// ุญุณุงุจ ุงูููุฎุต
const summary = LeavesReportsService.calculateSummary(leaves, filters)

// ุฅูุดุงุก Excel
const buffer = await LeavesReportsService.generateExcelReport(
  leaves, 
  summary, 
  filters
)

// ุญูุธ ุงูููู
fs.writeFileSync('report.xlsx', buffer)
```

---

## ๐ ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูุฃุฎุฑู

### ูุธุงู ุงูุฅุฌุงุฒุงุช
- โ ููุฑุฃ ูู ููุณ ุฌุฏุงูู `HR_EmployeeLeave`
- โ ูุฏุนู `settlementType` (ACTUAL_LEAVE, CASH_SETTLEMENT, POSTPONED)
- โ ูุญุณุจ ุฃูุงู ุงูุชุฃุฎูุฑ ุชููุงุฆูุงู

### ูุธุงู ุงูุชุณููุงุช ุงูููุฏูุฉ
- โ ูุนุฑุถ ุงููุจุงูุบ ุงููุณูุงุฉ ูุบูุฑ ุงููุณูุงุฉ
- โ ูุชุชุจุน ุชูุงุฑูุฎ ุงูุตุฑู (`allowancePaidDate`)

### ูุธุงู ุงูุฃูุณุงู ูุงููุธุงุฆู
- โ ูุฏุนู ุงูููุชุฑุฉ ุญุณุจ ุงููุณู
- โ ูุฏุนู ุงูููุชุฑุฉ ุญุณุจ ุงููุธููุฉ
- โ ูุนุฑุถ ุฃุนูู 5 ุฃูุณุงู ููุธุงุฆู

---

## ๐ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ุชูุฑูุฑ ุงูุชุณููุงุช ุงูููุฏูุฉ ุบูุฑ ุงููุณูุงุฉ
```typescript
const filters = {
  settlementType: 'CASH_SETTLEMENT',
  allowanceSettled: false
}
```

### ูุซุงู 2: ุฅุฌุงุฒุงุช ูุณู ูุนูู ูู ุงูุดูุฑ ุงูุญุงูู
```typescript
const now = new Date()
const filters = {
  departmentId: 5,
  startDate: new Date(now.getFullYear(), now.getMonth(), 1),
  endDate: new Date(now.getFullYear(), now.getMonth() + 1, 0)
}
```

### ูุซุงู 3: ุงูุฅุฌุงุฒุงุช ุงููุชุฃุฎุฑุฉ ุฃูุซุฑ ูู 3 ุฃูุงู
```typescript
const filters = {
  hasDelay: true,
  minDelayDays: 3,
  settlementType: 'ACTUAL_LEAVE'
}
```

---

## ๐ฏ ุงูุฎุทูุงุช ุงููุงุฏูุฉ ุงูููุชุฑุญุฉ

### ุชุญุณููุงุช ูุญุชููุฉ
1. **ุฑุณูู ุจูุงููุฉ ุฏุงุฎู Excel**
   - Charts ูุชูุฒูุน ุงูุฅุฌุงุฒุงุช
   - Pie charts ูููุณุจ ุงููุฆููุฉ

2. **ุฌุฏููุฉ ุงูุชูุงุฑูุฑ**
   - ุชูุงุฑูุฑ ุดูุฑูุฉ ุชููุงุฆูุฉ
   - ุฅุฑุณุงู ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู

3. **ููุงุฑูุงุช ุฒูููุฉ**
   - ููุงุฑูุฉ ุจูู ูุชุฑุชูู
   - ุงุชุฌุงูุงุช ุณูููุฉ

4. **ุชุตุฏูุฑ ูุตูุบ ุฃุฎุฑู**
   - PDF ููุณู
   - CSV ูุจุณุท

5. **ุชูุงุฑูุฑ ููุญุฉ ุงููุนูููุงุช**
   - Dashboard ุชูุงุนููุฉ
   - Real-time statistics

---

## ๐ ููุงุญุธุงุช ูููุฉ

### ุงูุฃุฏุงุก
- โ ุงุณุชุนูุงูุงุช ูุญุณูุฉ ูุน `include` ููุนูุงูุงุช
- โ ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูู ุงูุฐุงูุฑุฉ
- โ ูุชุงุจุฉ Excel ูุจุงุดุฑุฉ ุจุฏูู ูููุงุช ูุคูุชุฉ

### ุงูุฃูุงู
- โ ุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู
- โ ููุชุฑุฉ ุงูุจูุงูุงุช ุญุณุจ ุงูุตูุงุญูุงุช
- โ ุชูุธูู ุงูุจูุงูุงุช ูุจู ุงูุนุฑุถ

### ูุงุจููุฉ ุงูุชูุณุน
- โ ูุตู ููุทู ุงูุฃุนูุงู ุนู ูุงุฌูุฉ ุงูุจูุช
- โ Service ูุงุจู ููุงุณุชุฎุฏุงู ูู API
- โ Filters ูุงุจูุฉ ููุฅุถุงูุฉ ุจุณูููุฉ

---

## ๐ ุงูุฏุนู

ููุงุณุชูุณุงุฑุงุช ุฃู ุงููุดุงูู:
1. ุฑุงุฌุน ุงูููุฏ ูู `leaves-reports-service.ts`
2. ุชุญูู ูู logs ุงูุจูุช
3. ุชุฃูุฏ ูู ุชุซุจูุช ExcelJS: `npm install exceljs`

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 7 ููููุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 1.0.0  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุฅูุชุงุฌ
