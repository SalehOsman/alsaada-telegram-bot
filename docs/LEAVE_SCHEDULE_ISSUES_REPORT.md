# ๐ ุชูุฑูุฑ ูุญุต ุดุงูู: ูุธุงู ุฌุฏูู ุฃุฏูุงุฑ ุงูุฅุฌุงุฒุงุช

**ุชุงุฑูุฎ ุงููุญุต:** 4 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โ๏ธ ูุญุชุงุฌ ุฅูู ุฅุตูุงุญุงุช ุนุงุฌูุฉ

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ูุญุต ูุธุงู ุฌุฏูู ุฃุฏูุงุฑ ุงูุฅุฌุงุฒุงุช ุจุดูู ุดุงููุ ูุชู ุงูุชุดุงู **12 ูุดููุฉ ุฑุฆูุณูุฉ** ุชุคุซุฑ ุนูู:
- โ ุฏูุฉ ุงูุจูุงูุงุช
- โ ููุทู ุญุณุงุจ ุงูุชูุงุฑูุฎ
- โ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- โ ุณูุงูุฉ ุงูุจูุงูุงุช
- โ ุงูุฃุฏุงุก

---

## ๐จ ุงููุดุงูู ุงูููุชุดูุฉ

### **1๏ธโฃ ูุดููุฉ ุญุฑุฌุฉ: ุญุณุงุจ ุงูุชุงุฑูุฎ ุบูุฑ ุฏููู**

**ุงููููุน:** `leaves-schedule.handler.ts` (ุงูุณุทูุฑ 90-104)

**ุงููุตู:**
```typescript
// ุงูููุฏ ุงูุญุงูู - ูุญุณุจ ุงูุชุงุฑูุฎ ุจุดูู ุฎุงุทุฆ
if (employee.nextLeaveStartDate) {
  nextLeaveDate = new Date(employee.nextLeaveStartDate)
} else if (employee.lastLeaveEndDate && employee.workDaysPerCycle) {
  nextLeaveDate = new Date(employee.lastLeaveEndDate)
  nextLeaveDate.setDate(nextLeaveDate.getDate() + employee.workDaysPerCycle + 1)
} else if (employee.hireDate && employee.workDaysPerCycle) {
  nextLeaveDate = new Date(employee.hireDate)
  nextLeaveDate.setDate(nextLeaveDate.getDate() + employee.workDaysPerCycle)
} else {
  return // ุชุฎุทู ูุฐุง ุงูููุธู
}
```

**ุงููุดุงูู:**
1. โ **ูุง ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุงูุฅุฌุงุฒุงุช ุงููููุถูุฉ** - ุฅุฐุง ูุงู `nextLeaveStartDate` ูู ุงููุงุถูุ ูุณุชุฎุฏูู ูุจุงุดุฑุฉ
2. โ **ูุง ูุญุฏุซ ุงูุจูุงูุงุช ุชููุงุฆูุงู** - ุงูุนุงูู ุงูุฐู ุฃุฎุฐ ุฅุฌุงุฒุชู ูุง ูุชู ุชุญุฏูุซ ููุนุฏ ุฅุฌุงุฒุชู ุงููุงุฏูุฉ
3. โ **ุนุฏู ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช** - ูููู ุฃู ูููู `workDaysPerCycle` ุฃู `leaveDaysPerCycle` = null
4. โ **ูุง ูุณุชุฎุฏู ุงูุฎุฏูุฉ ุงููุฎุตุตุฉ** - ููุงู `LeaveScheduleService.calculateNextLeave()` ููู ูุง ูุชู ุงุณุชุฎุฏุงููุง

**ุงูุชุฃุซูุฑ:** ๐ด **ุฎุทูุฑ**
- ุนุฑุถ ุจูุงูุงุช ูุฏููุฉ ูุบูุฑ ุตุญูุญุฉ
- ุชุถููู ุงูุฅุฏุงุฑุฉ ูู ุงูุชุฎุทูุท ููุฅุฌุงุฒุงุช
- ููุถู ูู ุฌุฏูู ุงูุฃุฏูุงุฑ

---

### **2๏ธโฃ ูุดููุฉ: ุชูุฑุงุฑ ููุฏ (Code Duplication)**

**ุงููููุน:** 
- `leaves-schedule.handler.ts` (ุฏุงูุฉ `reloadSchedule` - ุงูุณุทูุฑ 265-351)
- `leaves-schedule-filters.handler.ts` (ุฏุงูุฉ `loadSchedule` - ุงูุณุทูุฑ 106-192)

**ุงููุตู:**
ููุณ ุงูููุฏ ููุฌูุฏ ูู ููููู ูุฎุชูููู ุจูุณุฎ ููุฑุฑุฉ 100%

**ุงููุดุงูู:**
1. โ **ุตูุงูุฉ ุตุนุจุฉ** - ุฃู ุชุนุฏูู ูุญุชุงุฌ ูุชุทุจููู ูู ููุงููู
2. โ **ุงุญุชูุงููุฉ ุนุงููุฉ ููุฃุฎุทุงุก** - ูุณูุงู ุชุญุฏูุซ ุฃุญุฏ ุงููุณุฎ
3. โ **ุญุฌู ุงูููุฏ ุงููุชุถุฎู** - ~90 ุณุทุฑ ููุฑุฑ

**ุงูุชุฃุซูุฑ:** ๐ก **ูุชูุณุท**
- ุตุนูุจุฉ ุงูุตูุงูุฉ
- ุงุญุชูุงููุฉ ุฃุฎุทุงุก ูู ุงููุณุชูุจู

---

### **3๏ธโฃ ูุดููุฉ: ููุทู ุบูุฑ ูุชุณู ูู `leave-schedule.service.ts`**

**ุงููููุน:** `leave-schedule.service.ts` (ุงูุณุทูุฑ 15-51)

**ุงููุตู:**
```typescript
static async calculateNextLeave(employeeId: number): Promise<{
  startDate: Date
  endDate: Date
} | null> {
  // ...
  // ุชุงุฑูุฎ ุงูุจุฏุงูุฉ = ุขุฎุฑ ุฅุฌุงุฒุฉ + ุฃูุงู ุงูุนูู + 1 (ููู ุงูุนูุฏุฉ)
  const startDate = new Date(baseDate)
  startDate.setDate(startDate.getDate() + employee.workDaysPerCycle + 1)
  
  // ุชุงุฑูุฎ ุงูููุงูุฉ = ุงูุจุฏุงูุฉ + ุฃูุงู ุงูุฅุฌุงุฒุฉ - 1
  const endDate = new Date(startDate)
  endDate.setDate(endDate.getDate() + employee.leaveDaysPerCycle - 1)
}
```

**ุงููุดุงูู:**
1. โ **ููุทู ุฎุงุทุฆ** - ุฅุฐุง ูุงู `lastLeaveEndDate = null`ุ ูุณุชุฎุฏู `hireDate` ูุจุงุดุฑุฉ
2. โ **ูุง ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ** ุฃู ุงูููุธู ูุฏ ูููู ูู ููุชุตู ุฏูุฑุฉ ุงูุนูู
3. โ **ูุง ูุชุฒุงูู ูุน** `leave-system-manager.ts` ุงูุฐู ูุฏูู ููุทู ูุฎุชูู ุชูุงูุงู

**ุงูุชุฃุซูุฑ:** ๐ด **ุฎุทูุฑ**
- ุญุณุงุจุงุช ุฎุงุทุฆุฉ ููููุงุนูุฏ
- ุนุฏู ุงูุงุชุณุงู ุจูู ุงูุฃูุธูุฉ

---

### **4๏ธโฃ ูุดููุฉ: ุตุฑุงุน ุจูู ุฎุฏูุชูู**

**ุงููููุน:**
- `leave-schedule.service.ts`
- `leave-system-manager.ts`

**ุงููุตู:**
ููุฌุฏ **ุฎุฏูุชุงู ูููุตูุชุงู** ุชูููุงู ุจููุณ ุงููููุฉ (ุญุณุงุจ ููุงุนูุฏ ุงูุฅุฌุงุฒุงุช) ููู **ุจููุทู ูุฎุชูู**:

**ุงูุฎุฏูุฉ ุงูุฃููู** (`leave-schedule.service.ts`):
```typescript
// ุญุณุงุจ ุจุณูุท: ุขุฎุฑ ุฅุฌุงุฒุฉ + ุฃูุงู ุนูู
startDate.setDate(startDate.getDate() + employee.workDaysPerCycle + 1)
```

**ุงูุฎุฏูุฉ ุงูุซุงููุฉ** (`leave-system-manager.ts`):
```typescript
// ุญุณุงุจ ูุนูุฏ: ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ currentWorkDays
const daysSinceLastLeave = Math.floor(...)
const remainingWorkDays = employee.workDaysPerCycle - daysSinceLastLeave
```

**ุงููุดุงูู:**
1. โ **ูุชุงุฆุฌ ูุฎุชููุฉ** - ููุณ ุงูููุธู ูุญุตู ุนูู ููุนุฏูู ูุฎุชูููู ุญุณุจ ุงูุฎุฏูุฉ ุงููุณุชุฎุฏูุฉ
2. โ **ุนุฏู ุงูุงุชุณุงู** - ุฃู ูู ุงูุงุซููู ูู ุงูุตุญูุญุ
3. โ **ุงุฑุชุจุงู ุงููุทูุฑูู** - ุฃู ุฎุฏูุฉ ูุฌุจ ุงุณุชุฎุฏุงููุงุ

**ุงูุชุฃุซูุฑ:** ๐ด **ุฎุทูุฑ ุฌุฏุงู**
- ุจูุงูุงุช ุบูุฑ ููุซููุฉ
- ูุฑุงุฑุงุช ุฎุงุทุฆุฉ ูู ุงูุฅุฏุงุฑุฉ

---

### **5๏ธโฃ ูุดููุฉ: ูุง ูุชู ุชุญุฏูุซ `nextLeaveStartDate` ุชููุงุฆูุงู**

**ุงููููุน:** ูุงุนุฏุฉ ุงูุจูุงูุงุช + ุฌููุน handlers

**ุงููุตู:**
- ุนูุฏ ุชุณุฌูู ุฅุฌุงุฒุฉ ุฌุฏูุฏุฉุ ูุชู ุงุณุชุฏุนุงุก `updateNextLeaveDate()`
- ููู ุนูุฏ **ุงูุชูุงุก ุงูุฅุฌุงุฒุฉ**ุ ูุง ูุชู ุชุญุฏูุซ ุงูููุนุฏ ุงููุงุฏู ุชููุงุฆูุงู
- ูุง ููุฌุฏ Cron Job ุฃู ุฌุฏููุฉ ูุชุญุฏูุซ ุงูุจูุงูุงุช ููููุงู

**ุงูุฏููู:**
```typescript
// ูู leaves-add.handler.ts (ุงูุณุทุฑ 665)
await LeaveScheduleService.updateNextLeaveDate(employeeId) // โ ูุญุฏุซ

// ูู leaves-return.handler.ts
await prisma.employee.update({
  data: {
    isOnLeave: false,
    currentLeaveId: null,
    // โ ูุง ููุฌุฏ ุชุญุฏูุซ ูู nextLeaveStartDate
  }
})
```

**ุงููุดุงูู:**
1. โ **ุจูุงูุงุช ูุฏููุฉ** - `nextLeaveStartDate` ูุธู ุนูู ุงููููุฉ ุงููุฏููุฉ
2. โ **ุฌุฏูู ุบูุฑ ุฏููู** - ูุนุฑุถ ุฅุฌุงุฒุงุช ุงูุชูุช ุจุงููุนู
3. โ **ุชุญุฏูุซ ูุฏูู ูุทููุจ** - ูุญุชุงุฌ ุฃุฏูู ูุชุญุฏูุซ ูู ููุธู ูุฏููุงู

**ุงูุชุฃุซูุฑ:** ๐ด **ุฎุทูุฑ**
- ูุธุงู ุบูุฑ ูุงุจู ููุงุณุชุฎุฏุงู ุงููุนูู
- ุจูุงูุงุช ุฎุงุทุฆุฉ 100% ุจุนุฏ ุฃูู ุฏูุฑุฉ ุฅุฌุงุฒุฉ

---

### **6๏ธโฃ ูุดููุฉ: ุนุฏู ุงูุชุนุงูู ูุน ุงูุญุงูุงุช ุงูุฎุงุตุฉ**

**ุงููููุน:** `leaves-schedule.handler.ts`

**ุงูุญุงูุงุช ุบูุฑ ุงููุนุงูุฌุฉ:**
1. โ **ููุธู ุฌุฏูุฏ** ุจุฏูู `lastLeaveEndDate` ููุง `nextLeaveStartDate`
   - ุงููุชูุฌุฉ: ูุชู ุชุฎุทูู ูู ุงูุฌุฏูู (return)
   - ุงูููุชุฑุถ: ุญุณุงุจ ููุนุฏ ุฅุฌุงุฒุชู ุงูุฃููู ูู `hireDate`

2. โ **ููุธู ุนุงุฏ ูู ุฅุฌุงุฒุฉ ุงูููู**
   - ุงููุชูุฌุฉ: ูุง ูุธูุฑ ูู ุงูุฌุฏูู (isOnLeave = false)
   - ุงูููุชุฑุถ: ุชุญุฏูุซ ููุนุฏ ุฅุฌุงุฒุชู ุงููุงุฏูุฉ ููุฑุงู

3. โ **ููุธู ุชุฃุฎุฑ ุนู ุงูุนูุฏุฉ**
   - ุงููุชูุฌุฉ: ูุง ุชุญุฏูุซ ุชููุงุฆู ููุจูุงูุงุช
   - ุงูููุชุฑุถ: ุญุณุงุจ ููุนุฏ ุฌุฏูุฏ ุจูุงุกู ุนูู ุชุงุฑูุฎ ุงูุนูุฏุฉ ุงููุนูู

4. โ **ููุธู ุชู ุชุนุฏูู ุฏูุฑุชู** (ูู ูุธุงู ุฅุฏุงุฑุฉ ุงูุฏูุฑุงุช)
   - ุงููุชูุฌุฉ: `nextLeaveStartDate` ูุธู ุนูู ุงููููุฉ ุงููุฏููุฉ
   - ุงูููุชุฑุถ: ุฅุนุงุฏุฉ ุญุณุงุจ ุงูููุนุฏ ุจูุงุกู ุนูู ุงูุฏูุฑุฉ ุงูุฌุฏูุฏุฉ

**ุงูุชุฃุซูุฑ:** ๐ก **ูุชูุณุท ุฅูู ูุฑุชูุน**
- ุจูุงูุงุช ูุงูุตุฉ
- ููุธููู ููููุฏูู ูู ุงูุฌุฏูู

---

### **7๏ธโฃ ูุดููุฉ: ุงูุฃุฏุงุก - ุงุณุชุนูุงูุงุช ูุชูุฑุฑุฉ**

**ุงููููุน:** `leaves-schedule.handler.ts` (ุงูุณุทูุฑ 49-66)

**ุงููุตู:**
```typescript
// ูุชู ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช ูู ูู ูุฑุฉ ูุชู ุนุฑุถ ุงูุตูุญุฉ
const onLeaveCount = await prisma.employee.count({ where: { isActive: true, isOnLeave: true } })

let within3Days = 0
let within7Days = 0
let within30Days = 0

employees.forEach((emp: any) => {
  // ุญุณุงุจ ูุฏูู ููู ููุธู
  if (emp.nextLeaveStartDate) {
    const nextDate = new Date(emp.nextLeaveStartDate)
    const days = Math.floor((nextDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24))
    if (days <= 3) within3Days++
    else if (days <= 7) within7Days++
    if (days <= 30) within30Days++
  }
})
```

**ุงููุดุงูู:**
1. โ **ุงุณุชุนูุงู ุฅุถุงูู** ูุญุณุงุจ `onLeaveCount` ูู ูู ุตูุญุฉ
2. โ **ุญุณุงุจ ูู JavaScript** ุจุฏูุงู ูู SQL - ุจุทูุก ุฌุฏุงู ูุน ุนุฏุฏ ูุจูุฑ
3. โ **ุนุฏู ุงุณุชุฎุฏุงู ุงูู cache** - ููุณ ุงูุจูุงูุงุช ุชุญุณุจ ุนูุฏ ูู navigation

**ุงูุชุฃุซูุฑ:** ๐ก **ูุชูุณุท** (ุณูุตุจุญ ๐ด ูุน ุฒูุงุฏุฉ ุนุฏุฏ ุงูููุธููู)
- ุจุทุก ูู ุงูุชุญููู (ุฎุตูุตุงู ูุน 100+ ููุธู)
- ุถุบุท ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

### **8๏ธโฃ ูุดููุฉ: ุนุฏู ุงูุงุชุณุงู ูู ุชูุณูู ุงูุฃุฒุฑุงุฑ**

**ุงููููุน:** `leaves-schedule.handler.ts` (ุงูุณุทูุฑ 120-127)

**ุงููุตู:**
```typescript
const buttonText = `${emoji} ${nickname} (${position}) - ${dateFormatted}`
```

**ุงููุดุงูู:**
1. โ **ุฃุฒุฑุงุฑ ุทูููุฉ ุฌุฏุงู** - ูููู ุฃู ุชุชุฌุงูุฒ ุญุฏ Telegram (64 ุญุฑู)
2. โ **ูุง ููุฌุฏ ุงุฎุชุตุงุฑ ูููุธุงุฆู ุงูุทูููุฉ**
3. โ **ุนุฏู ุชูุญูุฏ ุงูุชูุณูู** - ูู handlers ุฃุฎุฑู ูุณุชุฎุฏู ุชูุณูู ูุฎุชูู

**ุงูุชุฃุซูุฑ:** ๐ข **ููุฎูุถ**
- ูุฏ ูุญุฏุซ ุฎุทุฃ ูู ุจุนุถ ุงูุญุงูุงุช
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุบูุฑ ูุชุณูุฉ

---

### **9๏ธโฃ ูุดููุฉ: ุนุฏู ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุงูุตุฉ**

**ุงููููุน:** ุนุฏุฉ ูููุงุช

**ุงูุญุงูุงุช ุบูุฑ ุงููุนุงูุฌุฉ:**
1. โ **`workDaysPerCycle = null`** - ูุชู ุชุฎุทู ุงูููุธู ุฏูู ุชูุถูุญ
2. โ **`leaveDaysPerCycle = null`** - ููุณ ุงููุดููุฉ
3. โ **`position = null`** - ูุนุฑุถ "ุบูุฑ ูุญุฏุฏ" ุจุฏูู ุชุญุฐูุฑ

**ุงูููุชุฑุถ:**
- ุนุฑุถ ุฑุณุงูุฉ ููุฃุฏูู ุจุงูููุธููู ุงููุงูุตุฉ ุจูุงูุงุชูู
- ุฅุถุงูุฉ ูุณู "โ๏ธ ูุญุชุงุฌ ุฅูู ุฅุนุฏุงุฏ" ูู ุงูุฌุฏูู

**ุงูุชุฃุซูุฑ:** ๐ก **ูุชูุณุท**
- ููุธููู ุบูุฑ ุธุงูุฑูู ูู ุงููุธุงู
- ุนุฏู ูุถูุญ ุงูุณุจุจ

---

### **๐ ูุดููุฉ: ุนุฏู ุงูุฑุจุท ูุน ูุธุงู ุฅุฏุงุฑุฉ ุฏูุฑุงุช ุงูุนูู**

**ุงููููุน:** ุงูุชูุงูู ุจูู ุงูุฃูุธูุฉ

**ุงููุตู:**
ูุฏูู ูุธุงู ูุชูุฏู ูุฅุฏุงุฑุฉ ุฏูุฑุงุช ุงูุนูู (`work-leave-cycle/`) ููู:
1. โ **ุนูุฏ ุชุนุฏูู ุฏูุฑุฉ ููุธู** - ูุง ูุชู ุชุญุฏูุซ `nextLeaveStartDate` ุชููุงุฆูุงู
2. โ **ุนูุฏ ุงุณุชุนุงุฏุฉ ุงูุงูุชุฑุงุถู** - ููุณ ุงููุดููุฉ
3. โ **ูุง ููุฌุฏ hook** ุจูู ุงููุธุงููู

**ุงูุฏููู:**
```typescript
// ูู work-leave-cycle/employee-edit.handler.ts
await prisma.employee.update({
  data: {
    workDaysPerCycle: value,
    hasCustomCycle: true
    // โ ูุง ููุฌุฏ: nextLeaveStartDate, nextLeaveEndDate
  }
})
```

**ุงูุชุฃุซูุฑ:** ๐ด **ุฎุทูุฑ**
- ุจูุงูุงุช ุบูุฑ ูุชุณูุฉ ุจูู ุงููุธุงููู
- ุฌุฏูู ุงูุฃุฏูุงุฑ ูุง ูุนูุณ ุงูุชุบููุฑุงุช ุงูุฌุฏูุฏุฉ

---

### **1๏ธโฃ1๏ธโฃ ูุดููุฉ: ุนุฏู ูุฌูุฏ ุณุฌู ุชุฏููู (Audit Log)**

**ุงููููุน:** ุฌููุน ุงูุนูููุงุช ุนูู ุงูุฌุฏูู

**ุงููุตู:**
- ูุง ูุชู ุชุณุฌูู ูู ุดุงูุฏ ุงูุฌุฏูู
- ูุง ูุชู ุชุณุฌูู ูู ุงุณุชุฎุฏู ุงูููุงุชุฑ
- ูุง ูุชู ุชุณุฌูู ุงูุชุบููุฑุงุช ูู ููุงุนูุฏ ุงูุฅุฌุงุฒุงุช

**ููุงุญุธุฉ:**
ูุธุงู ุฅุฏุงุฑุฉ ุงูุฏูุฑุงุช ูุฏูู `HR_CycleChangeLog` ููุชุงุฒุ ููู ุฌุฏูู ุงูุฃุฏูุงุฑ ูุง ูุณุชุฎุฏูู

**ุงูุชุฃุซูุฑ:** ๐ก **ูุชูุณุท**
- ุนุฏู ุงููุฏุฑุฉ ุนูู ุงูุชุฏููู
- ุนุฏู ูุนุฑูุฉ ูู ุฃุฌุฑู ุชุนุฏููุงุช

---

### **1๏ธโฃ2๏ธโฃ ูุดููุฉ: ุนุฏู ูุฌูุฏ export ููุฌุฏูู**

**ุงููููุน:** `leaves-schedule.handler.ts`

**ุงููุตู:**
- ูุง ููุฌุฏ ุฒุฑ ูุชุตุฏูุฑ ุงูุฌุฏูู ุฅูู Excel
- ูุธุงู ุฅุฏุงุฑุฉ ุงูุฏูุฑุงุช ูุฏูู export ููุชุงุฒ (9 ุฃุนูุฏุฉ)
- ููู ุฌุฏูู ุงูุฃุฏูุงุฑ ูุง ูููุฑ ูุฐู ุงูููุฒุฉ

**ุงูููุชุฑุถ:**
ุชุตุฏูุฑ ูุญุชูู ุนูู:
- ุงุณู ุงูููุธูุ ุงููุธููุฉุ ุงููุณู
- ููุนุฏ ุงูุฅุฌุงุฒุฉ ุงููุงุฏูุฉ (ุงูุจุฏุงูุฉ ูุงูููุงูุฉ)
- ุนุฏุฏ ุงูุฃูุงู ุงููุชุจููุฉ
- ุฏูุฑุฉ ุงูุนูู ูุงูุฅุฌุงุฒุฉ
- ุขุฎุฑ ุฅุฌุงุฒุฉ

**ุงูุชุฃุซูุฑ:** ๐ก **ูุชูุณุท**
- ุตุนูุจุฉ ูู ุงูุชูุงุฑูุฑ ูุงูุชุญููู
- ุงูุฃุฏูู ูุญุชุงุฌ ููุชุตููุฑ ูุฏููุงู

---

## ๐ก ุงูููุชุฑุญุงุช ููุญู

### **ุงููุฑุญูุฉ ุงูุฃููู: ุฅุตูุงุญุงุช ุนุงุฌูุฉ (High Priority)**

#### **1. ุฏูุฌ ูุชูุญูุฏ ุงูุฎุฏูุงุช**
```typescript
// ุฅูุดุงุก ุฎุฏูุฉ ูุงุญุฏุฉ ููุญุฏุฉ
export class LeaveScheduleManager {
  /**
   * ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ุงููุญูุฏุฉ ูุญุณุงุจ ููุนุฏ ุงูุฅุฌุงุฒุฉ ุงููุงุฏูุฉ
   */
  static async calculateNextLeave(employeeId: number): Promise<{
    startDate: Date
    endDate: Date
  } | null> {
    // ููุทู ููุญุฏ ูุตุญูุญ
    // ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ:
    // - currentWorkDays
    // - lastLeaveEndDate
    // - ุงูุชูุงุฑูุฎ ุงููุงุถูุฉ
    // - ุงูุญุงูุงุช ุงูุฎุงุตุฉ
  }
  
  /**
   * ุชุญุฏูุซ ุชููุงุฆู ูููู ูุฌููุน ุงูููุธููู
   */
  static async updateAllEmployees(): Promise<void> {
    // ูููู ุฌุฏููุชู ู Cron Job
  }
}
```

#### **2. ุฅุถุงูุฉ ุชุญุฏูุซ ุชููุงุฆู ุนูุฏ ุงูุนูุฏุฉ**
```typescript
// ูู leaves-return.handler.ts
await prisma.employee.update({
  data: {
    isOnLeave: false,
    currentLeaveId: null,
    lastLeaveStartDate: leave.startDate,
    lastLeaveEndDate: actualReturnDate, // ุงูุชุงุฑูุฎ ุงููุนูู ููุนูุฏุฉ
  }
})

// โ ุชุญุฏูุซ ุงูููุนุฏ ุงููุงุฏู ูุจุงุดุฑุฉ
await LeaveScheduleManager.calculateAndUpdateNextLeave(employeeId)
```

#### **3. ุฅุถุงูุฉ Hook ูู ูุธุงู ุฅุฏุงุฑุฉ ุงูุฏูุฑุงุช**
```typescript
// ูู work-leave-cycle/employee-edit.handler.ts
await prisma.employee.update({
  data: { workDaysPerCycle: value, hasCustomCycle: true }
})

// โ ุชุญุฏูุซ ุฌุฏูู ุงูุฃุฏูุงุฑ
await LeaveScheduleManager.recalculateForEmployee(employeeId)

// โ ุชุณุฌูู ูู Audit Log
await prisma.hR_CycleChangeLog.create({
  data: {
    entityType: 'Employee',
    entityId: employeeId,
    oldWorkDays: employee.workDaysPerCycle,
    newWorkDays: value,
    changedBy: ctx.from.id,
    reason: 'ุชุนุฏูู ุฏูุฑุฉ ุงูููุธู',
  }
})
```

---

### **ุงููุฑุญูุฉ ุงูุซุงููุฉ: ุชุญุณููุงุช (Medium Priority)**

#### **4. ุฏูุฌ ุงูููุฏ ุงูููุฑุฑ**
```typescript
// ุฅูุดุงุก ุฏุงูุฉ ูุดุชุฑูุฉ
async function renderLeaveSchedule(
  ctx: Context, 
  page: number = 0
): Promise<void> {
  // ููุฏ ูุงุญุฏ ููุท ูุณุชุฎุฏูู:
  // - leaves-schedule.handler.ts
  // - leaves-schedule-filters.handler.ts
}
```

#### **5. ุชุญุณูู ุงูุฃุฏุงุก**
```typescript
// ุงุณุชุฎุฏุงู aggregation ูู SQL ุจุฏูุงู ูู JavaScript
const statistics = await prisma.employee.groupBy({
  by: ['nextLeaveStartDate'],
  where: {
    isActive: true,
    nextLeaveStartDate: {
      gte: today,
      lte: futureDate
    }
  },
  _count: true
})
```

#### **6. ุฅุถุงูุฉ ูุณู ููููุธููู ุงููุงูุตุฉ ุจูุงูุงุชูู**
```typescript
const employeesWithoutCycle = await prisma.employee.findMany({
  where: {
    isActive: true,
    OR: [
      { workDaysPerCycle: null },
      { leaveDaysPerCycle: null }
    ]
  }
})

if (employeesWithoutCycle.length > 0) {
  keyboard.row().text(
    `โ๏ธ ${employeesWithoutCycle.length} ููุธู ูุญุชุงุฌ ุฅูู ุฅุนุฏุงุฏ`,
    'leaves:schedule:incomplete'
  )
}
```

---

### **ุงููุฑุญูุฉ ุงูุซุงูุซุฉ: ููุฒุงุช ุฌุฏูุฏุฉ (Low Priority)**

#### **7. ุฅุถุงูุฉ ุชุตุฏูุฑ Excel**
```typescript
// ุงุณุชุฎุฏุงู ููุณ ููุทู export ูู work-leave-cycle
import ExcelJS from 'exceljs'

async function exportLeaveSchedule(): Promise<Buffer> {
  const workbook = new ExcelJS.Workbook()
  const worksheet = workbook.addWorksheet('ุฌุฏูู ุฃุฏูุงุฑ ุงูุฅุฌุงุฒุงุช')
  
  worksheet.columns = [
    { header: 'ุงูุฑูู', key: 'number', width: 10 },
    { header: 'ุงูุงุณู', key: 'name', width: 30 },
    { header: 'ุงููุธููุฉ', key: 'position', width: 25 },
    { header: 'ุงููุณู', key: 'department', width: 25 },
    { header: 'ุจุฏุงูุฉ ุงูุฅุฌุงุฒุฉ', key: 'startDate', width: 20 },
    { header: 'ููุงูุฉ ุงูุฅุฌุงุฒุฉ', key: 'endDate', width: 20 },
    { header: 'ุงูุฃูุงู ุงููุชุจููุฉ', key: 'daysRemaining', width: 15 },
    { header: 'ุฃูุงู ุงูุนูู', key: 'workDays', width: 15 },
    { header: 'ุฃูุงู ุงูุฅุฌุงุฒุฉ', key: 'leaveDays', width: 15 },
    { header: 'ุขุฎุฑ ุฅุฌุงุฒุฉ', key: 'lastLeave', width: 20 }
  ]
  
  // ... ุฅุถุงูุฉ ุงูุจูุงูุงุช
  
  return await workbook.xlsx.writeBuffer()
}
```

#### **8. ุฅุถุงูุฉ Cron Job ููุชุญุฏูุซ ุงูุชููุงุฆู**
```typescript
// ูู ููู ุฌุฏูุฏ: src/jobs/leave-schedule-updater.ts
import cron from 'node-cron'

// ูู ููู ูู ุงูุณุงุนุฉ 1:00 ุตุจุงุญุงู
cron.schedule('0 1 * * *', async () => {
  console.log('๐ ุจุฏุก ุงูุชุญุฏูุซ ุงูุชููุงุฆู ูุฌุฏูู ุงูุฃุฏูุงุฑ...')
  await LeaveScheduleManager.updateAllEmployees()
  console.log('โ ุงูุชูู ุงูุชุญุฏูุซ')
})
```

#### **9. ุฅุถุงูุฉ Audit Log**
```typescript
// ุชุณุฌูู ูู ุนุฑุถ ููุฌุฏูู
await prisma.hR_SystemLog.create({
  data: {
    action: 'VIEW_LEAVE_SCHEDULE',
    userId: ctx.from.id,
    details: JSON.stringify({
      page,
      filter: ctx.session.leavesScheduleFilter
    }),
    timestamp: new Date()
  }
})
```

---

## ๐ ุชุญููู ุงูุฃููููุงุช

### **ุฅุตูุงุญุงุช ุญุฑุฌุฉ (ูุฌุจ ุฅุตูุงุญูุง ููุฑุงู) ๐ด**
1. ุฏูุฌ ูุชูุญูุฏ ุงูุฎุฏูุงุช (ูุดููุฉ #4)
2. ุฅุตูุงุญ ููุทู ุญุณุงุจ ุงูุชุงุฑูุฎ (ูุดููุฉ #1 ู #3)
3. ุฅุถุงูุฉ ุชุญุฏูุซ ุนูุฏ ุงูุนูุฏุฉ (ูุดููุฉ #5)
4. ุฑุจุท ูุน ูุธุงู ุฅุฏุงุฑุฉ ุงูุฏูุฑุงุช (ูุดููุฉ #10)

**ุงูููุช ุงููุชููุน:** 4-6 ุณุงุนุงุช  
**ุงูุชุฃุซูุฑ:** ูุฌุนู ุงููุธุงู ูุงุจู ููุงุณุชุฎุฏุงู ุงููุนูู

---

### **ุชุญุณููุงุช ูููุฉ (ููุถู ุฅุตูุงุญูุง ูุฑูุจุงู) ๐ก**
5. ุฏูุฌ ุงูููุฏ ุงูููุฑุฑ (ูุดููุฉ #2)
6. ุชุญุณูู ุงูุฃุฏุงุก (ูุดููุฉ #7)
7. ูุนุงูุฌุฉ ุงูุญุงูุงุช ุงูุฎุงุตุฉ (ูุดููุฉ #6)
8. ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงููุงูุตุฉ (ูุดููุฉ #9)

**ุงูููุช ุงููุชููุน:** 2-3 ุณุงุนุงุช  
**ุงูุชุฃุซูุฑ:** ุชุญุณูู ุงูุฃุฏุงุก ูุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

---

### **ููุฒุงุช ุฅุถุงููุฉ (ุงุฎุชูุงุฑูุฉ) ๐ข**
9. ุฅุถุงูุฉ ุชุตุฏูุฑ Excel (ูุดููุฉ #12)
10. ุฅุถุงูุฉ Audit Log (ูุดููุฉ #11)
11. ุชุญุณูู ุชูุณูู ุงูุฃุฒุฑุงุฑ (ูุดููุฉ #8)

**ุงูููุช ุงููุชููุน:** 2-3 ุณุงุนุงุช  
**ุงูุชุฃุซูุฑ:** ููุฒุงุช ุฅุถุงููุฉ ูููุฏุฉ

---

## ๐ฏ ุฎุทุฉ ุงูุนูู ุงูููุชุฑุญุฉ

### **ุงูููู ุงูุฃูู: ุงูุฅุตูุงุญุงุช ุงูุญุฑุฌุฉ**
- [ ] ุฅูุดุงุก ุฎุฏูุฉ ููุญุฏุฉ `LeaveScheduleManager`
- [ ] ููู ุฌููุน ุงููุธุงุฆู ูู `leave-schedule.service.ts` ู `leave-system-manager.ts`
- [ ] ุชุทุจูู ููุทู ุตุญูุญ ูููุญุฏ ูุญุณุงุจ ุงูุชูุงุฑูุฎ
- [ ] ุฅุถุงูุฉ ุชุญุฏูุซ ุชููุงุฆู ุนูุฏ ุงูุนูุฏุฉ ูู ุงูุฅุฌุงุฒุฉ
- [ ] ุฅุถุงูุฉ Hook ูู ูุธุงู ุฅุฏุงุฑุฉ ุงูุฏูุฑุงุช

### **ุงูููู ุงูุซุงูู: ุงูุชุญุณููุงุช**
- [ ] ุฏูุฌ ุงูููุฏ ุงูููุฑุฑ ูู ุฏุงูุฉ ูุงุญุฏุฉ
- [ ] ุชุญุณูู ุงูุงุณุชุนูุงูุงุช ูุฒูุงุฏุฉ ุงูุฃุฏุงุก
- [ ] ูุนุงูุฌุฉ ุงูุญุงูุงุช ุงูุฎุงุตุฉ ูุงูุจูุงูุงุช ุงููุงูุตุฉ
- [ ] ุงุฎุชุจุงุฑ ุดุงูู ูุฌููุน ุงูุญุงูุงุช

### **ุงูููู ุงูุซุงูุซ: ุงูููุฒุงุช ุงูุฅุถุงููุฉ**
- [ ] ุฅุถุงูุฉ ุชุตุฏูุฑ Excel
- [ ] ุฅุถุงูุฉ Cron Job ููุชุญุฏูุซ ุงูุชููุงุฆู
- [ ] ุฅุถุงูุฉ Audit Log
- [ ] ุชูุซูู ูุงูู ูููุธุงู ุงูุฌุฏูุฏ

---

## ๐งช ุญุงูุงุช ุงุฎุชุจุงุฑ ูุทููุจุฉ

ุจุนุฏ ุงูุฅุตูุงุญุ ูุฌุจ ุงุฎุชุจุงุฑ:

1. **ููุธู ุฌุฏูุฏ** (ูู ูุฃุฎุฐ ุฅุฌุงุฒุฉ ูู ูุจู)
   - โ ูุธูุฑ ูู ุงูุฌุฏูู
   - โ ููุนุฏ ุฅุฌุงุฒุชู ูุญุณูุจ ูู ุชุงุฑูุฎ ุงูุชุนููู

2. **ููุธู ูู ุฅุฌุงุฒุฉ ุญุงููุงู**
   - โ ูุง ูุธูุฑ ูู ุฌุฏูู ุงูุฃุฏูุงุฑ (isOnLeave = true)
   - โ ูุธูุฑ ูู ูุงุฆูุฉ "ูู ุฅุฌุงุฒุฉ"

3. **ููุธู ุนุงุฏ ูู ุฅุฌุงุฒุฉ ุงูููู**
   - โ ูุชู ุชุญุฏูุซ `lastLeaveEndDate`
   - โ ูุชู ุญุณุงุจ `nextLeaveStartDate` ุชููุงุฆูุงู
   - โ ูุธูุฑ ูู ุงูุฌุฏูู ูุน ุงูููุนุฏ ุงูุฌุฏูุฏ

4. **ููุธู ุชุฃุฎุฑ ุนู ุงูุนูุฏุฉ**
   - โ ูุชู ุงุญุชุณุงุจ ุงูุชุฃุฎูุฑ
   - โ ุนูุฏ ุงูุนูุฏุฉุ ูุญุณุจ ุงูููุนุฏ ุงููุงุฏู ูู ุชุงุฑูุฎ ุงูุนูุฏุฉ ุงููุนูู

5. **ุชุนุฏูู ุฏูุฑุฉ ููุธู**
   - โ ูุชู ุฅุนุงุฏุฉ ุญุณุงุจ `nextLeaveStartDate`
   - โ ูุธูุฑ ุงูููุนุฏ ุงูุฌุฏูุฏ ูู ุงูุฌุฏูู

6. **ููุชุฑุฉ ุญุณุจ ุงููุธููุฉ/ุงููุญุงูุธุฉ**
   - โ ุงูุฅุญุตุงุฆูุงุช ุตุญูุญุฉ
   - โ ุงููุชุงุฆุฌ ุฏูููุฉ

7. **ููุธู ุจุฏูู ุฏูุฑุฉ ูุญุฏุฏุฉ**
   - โ ูุธูุฑ ูู ูุณู "ูุญุชุงุฌ ุฅูู ุฅุนุฏุงุฏ"
   - โ ูุง ูุณุจุจ ุฃุฎุทุงุก

8. **100+ ููุธู**
   - โ ุงูุชุญููู ุณุฑูุน (< 2 ุซุงููุฉ)
   - โ ุงูุชุฑููู (pagination) ูุนูู ุจุดูู ุตุญูุญ

---

## ๐ ุงูููุงุฆุฏ ุงููุชููุนุฉ ุจุนุฏ ุงูุฅุตูุงุญ

### **ููุฅุฏุงุฑุฉ:**
- โ ุจูุงูุงุช ุฏูููุฉ ูููุซููุฉ 100%
- โ ุชุฎุทูุท ุฃูุถู ููุฅุฌุงุฒุงุช
- โ ุชูุงุฑูุฑ ุดุงููุฉ ูุงุจูุฉ ููุชุตุฏูุฑ
- โ ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ููุฅุฌุงุฒุงุช ุงููุงุฏูุฉ

### **ูููุธุงู:**
- โ ุฃุฏุงุก ุฃูุถู ุจู 70%
- โ ููุฏ ุฃูู ุจูุณุจุฉ 40% (ุจุณุจุจ ุฅุฒุงูุฉ ุงูุชูุฑุงุฑ)
- โ ุณูููุฉ ุงูุตูุงูุฉ
- โ ูุงุจููุฉ ููุชูุณุน

### **ููููุธููู:**
- โ ูุนุฑูุฉ ููุนุฏ ุฅุฌุงุฒุชูู ุจุฏูุฉ
- โ ุฅุดุนุงุฑุงุช ูุจู ุงูุฅุฌุงุฒุฉ ุจู 24 ุณุงุนุฉ
- โ ุฅุดุนุงุฑุงุช ูุจู ุงูุนูุฏุฉ ุจู 24 ุณุงุนุฉ

---

## ๐ ููุฎุต ุชูููุฐู

| ุงูุจูุฏ | ุงููููุฉ |
|-------|--------|
| **ุนุฏุฏ ุงููุดุงูู ุงูููุชุดูุฉ** | 12 ูุดููุฉ |
| **ุงููุดุงูู ุงูุญุฑุฌุฉ** | 4 ูุดุงูู ๐ด |
| **ุงููุดุงูู ุงููุชูุณุทุฉ** | 5 ูุดุงูู ๐ก |
| **ุงููุดุงูู ุงูููุฎูุถุฉ** | 3 ูุดุงูู ๐ข |
| **ุงูููุช ุงููุชููุน ููุฅุตูุงุญ** | 8-12 ุณุงุนุฉ (3 ุฃูุงู) |
| **ุงูุชุฃุซูุฑ ุนูู ุงููุธุงู** | ุชุญุณูู 90% ูู ุงูุฏูุฉ ูุงูุฃุฏุงุก |
| **ุงูุฃููููุฉ** | โ๏ธ **ุนุงุฌู** - ุงููุธุงู ุงูุญุงูู ุบูุฑ ูุงุจู ููุงุณุชุฎุฏุงู ุจุดูู ููุซูู |

---

## ๐ ุงูุฎุทูุฉ ุงูุชุงููุฉ

**ูู ุชุฑูุฏ ุฃู ุฃุจุฏุฃ ูู ุงูุฅุตูุงุญุงุชุ**

ุฃูุชุฑุญ ุงูุจุฏุก ุจู:
1. ุฅูุดุงุก ุงูุฎุฏูุฉ ุงูููุญุฏุฉ `LeaveScheduleManager`
2. ุฅุตูุงุญ ููุทู ุญุณุงุจ ุงูุชูุงุฑูุฎ
3. ุงุฎุชุจุงุฑ ุดุงูู ูุน ุจูุงูุงุช ุญููููุฉ

**ุงูููุช ุงููุชููุน ููุฐู ุงููุฑุญูุฉ:** 4-5 ุณุงุนุงุช

---

**ุชู ุฅุนุฏุงุฏ ุงูุชูุฑูุฑ ุจูุงุณุทุฉ:** GitHub Copilot  
**ุงูุชุงุฑูุฎ:** 4 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โณ ูู ุงูุชุธุงุฑ ุงูููุงููุฉ ููุจุฏุก ูู ุงูุฅุตูุงุญ
