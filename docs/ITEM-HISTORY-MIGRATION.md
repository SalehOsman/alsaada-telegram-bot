# ๐ ุฏููู ุฅุถุงูุฉ ุฌุฏูู ุณุฌู ุงูุชุนุฏููุงุช

## ๐ฏ ุงููุฏู
ุฅุถุงูุฉ ุฌุฏูู `INV_ItemHistory` ูุชุชุจุน ุฌููุน ุงูุชุนุฏููุงุช ูุงูุนูููุงุช ุนูู ูุทุน ุงูุบูุงุฑ.

## ๐ ุงูุฎุทูุงุช ุงููุทููุจุฉ

### 1๏ธโฃ ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
# 1. ุฅูุดุงุก migration ุฌุฏูุฏ
npx prisma migrate dev --name add_inv_item_history

# 2. ุชุญุฏูุซ Prisma Client
npx prisma generate
```

### 2๏ธโฃ ุฅูุบุงุก ุงูุชุนููู ุนู ุงูููุฏ
ุจุนุฏ ุชุดุบูู ุงูุฃูุงูุฑ ุฃุนูุงูุ ูู ุจุฅูุบุงุก ุงูุชุนููู ุนู ุงูููุฏ ูู ุงูููู:
`src/bot/features/inventory-management/handlers/spare-parts-items.handler.ts`

ุงุจุญุซ ุนู ุงูุณุทุฑ:
```typescript
// TODO: ุจุนุฏ ุชุดุบูู npx prisma generateุ ูู ุจุฅูุบุงุก ุงูุชุนููู ุนู ุงูููุฏ ุงูุชุงูู:
```

ููู ุจุฅุฒุงูุฉ `/*` ู `*/` ูู ุญูู ููุฏ `Database.prisma.iNV_ItemHistory.create()`

## ๐ ูููู ุงูุฌุฏูู ุงูุฌุฏูุฏ

### `INV_ItemHistory`
ูุญุชูู ุนูู:
- **itemId**: ูุนุฑู ุงููุทุนุฉ
- **itemType**: ููุน ุงูุตูู (SPARE_PART, EQUIPMENT, etc.)
- **action**: ููุน ุงูุนูููุฉ (CREATE, UPDATE, DELETE, RESTORE, STATUS_CHANGE)
- **actionDetail**: ุชูุงุตูู ุฅุถุงููุฉ
- **oldData**: ุงูุจูุงูุงุช ูุจู ุงูุชุนุฏูู (JSON)
- **newData**: ุงูุจูุงูุงุช ุจุนุฏ ุงูุชุนุฏูู (JSON)
- **changedFields**: ุงูุญููู ุงููุชุบูุฑุฉ ููุท (JSON)
- **performedBy**: ูู ูุงู ุจุงูุนูููุฉ
- **performedAt**: ููุช ุงูุนูููุฉ
- **notes**: ููุงุญุธุงุช
- **reason**: ุณุจุจ ุงูุชุนุฏูู/ุงูุญุฐู

## โจ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ุญุฐู ูุงุนู (Soft Delete)
- ุนูุฏ ุญุฐู ูุทุนุฉุ ูุชู ุชุนููู `isActive = false`
- ูุง ูุชู ุญุฐู ุงูุจูุงูุงุช ูู ุงููุงุนุฏุฉ
- ูููู ุงุณุชุฑุฌุงุน ุงููุทุน ุงููุญุฐููุฉ ูุงุญูุงู

### 2. ุณุฌู ุงูุชุนุฏููุงุช ุงููุงูู
- ุชุณุฌูู ุฌููุน ุนูููุงุช ุงูุฅูุดุงุก ูุงูุชุนุฏูู ูุงูุญุฐู
- ุญูุธ ุงูุจูุงูุงุช ุงููุฏููุฉ ูุงูุฌุฏูุฏุฉ
- ูุนูููุงุช ุงููุณุชุฎุฏู ุงูุฐู ูุงู ุจุงูุนูููุฉ

### 3. ุชูุงุฑูุฑ ููุฃุฏูู
- ุฅุฑุณุงู ุชูุฑูุฑ ููุฃุฏูู ุนูุฏ ุญุฐู ูุทุนุฉ
- ูุดูู ุงูุชูุฑูุฑ ุฌููุน ุงููุนูููุงุช ูุงููููุฉ ุงููุญุฐููุฉ

## ๐ ุงูุนูููุงุช ุงููุฏุนููุฉ

### CREATE
ุชุณุฌูู ุฅูุดุงุก ูุทุนุฉ ุฌุฏูุฏุฉ:
- ูุชู ุชุณุฌูู ุฌููุน ุงูุจูุงูุงุช ูู `newData`
- `oldData` ูููู `null`

### UPDATE
ุชุณุฌูู ุชุนุฏูู ูุทุนุฉ ููุฌูุฏุฉ:
- `oldData`: ุงูุจูุงูุงุช ูุจู ุงูุชุนุฏูู
- `newData`: ุงูุจูุงูุงุช ุจุนุฏ ุงูุชุนุฏูู
- `changedFields`: ุงูุญููู ุงููุชุบูุฑุฉ ููุท

### DELETE
ุชุณุฌูู ุญุฐู (ูุงุนู) ููุทุนุฉ:
- `oldData`: ุฌููุน ุจูุงูุงุช ุงููุทุนุฉ ูุจู ุงูุญุฐู
- `newData`: `{ isActive: false }`
- ูุญุชูุธ ุจุฌููุน ุงููุนูููุงุช ููุงุณุชุฑุฌุงุน

### RESTORE
ุชุณุฌูู ุงุณุชุฑุฌุงุน ูุทุนุฉ ูุญุฐููุฉ:
- `oldData`: `{ isActive: false }`
- `newData`: `{ isActive: true }`

## ๐ฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ุนูุฏ ูุญุงููุฉ ุฅุถุงูุฉ ูุทุนุฉ ููุฌูุฏุฉ:
```
โ๏ธ ููุฌุฏ ุจุงููุนู ุตูู ุจูุฐุง ุงูุจุงุฑููุฏ

๐ ูุนูููุงุช ุงููุทุนุฉ ุงูููุฌูุฏุฉ:
โข ุงูุงุณู: [ุงุณู ุงููุทุนุฉ]
โข ุงูููุฏ: [ุงูููุฏ]
โข ุงููููุฉ ุงูุญุงููุฉ: [ุงููููุฉ]
โข ุงููููุฉ: [ุงููููุฉ] ุฌููู

ูุงุฐุง ุชุฑูุฏ ุฃู ุชูุนูุ

[๐ฆ ุนุฑุถ ุงูุชูุงุตูู]
[โ๏ธ ุชุนุฏูู ุงูุจูุงูุงุช]
[๐๏ธ ุญุฐู ุงููุทุนุฉ]
[โฌ๏ธ ุฑุฌูุน]
```

### ุนูุฏ ุทูุจ ุงูุญุฐู:
```
โ๏ธ ุชุฃููุฏ ุญุฐู ุงููุทุนุฉ

๐ฆ [ุงุณู ุงููุทุนุฉ]
๐ข ุงูููุฏ: [ุงูููุฏ]
๐ ุงููููุฉ: [ุงููููุฉ]
๐ต ุงููููุฉ: [ุงููููุฉ] ุฌููู

โ๏ธ ุชูุจูู: ุณูุชู ุญุฐู ุงููุทุนุฉ ุจุดูู ููุงุฆู (ุญุฐู ูุงุนู)
ูููู ุงุณุชุฑุฌุงุนูุง ูุงุญูุงู ูู ูุงุฆูุฉ ุงููุญุฐููุงุช

ูู ุฃูุช ูุชุฃูุฏ ูู ุงูุญุฐูุ

[โ๏ธ ูุนูุ ุงุญุฐู ุงููุทุนุฉ]
[โ ุฅูุบุงุก]
```

### ุจุนุฏ ุงูุญุฐู ุจูุฌุงุญ:
```
โ ุชู ุญุฐู ุงููุทุนุฉ ุจูุฌุงุญ

๐ฆ [ุงุณู ุงููุทุนุฉ]
๐ข ุงูููุฏ: [ุงูููุฏ]

๐ ุชู ุชุณุฌูู ุนูููุฉ ุงูุญุฐู ูู ุณุฌู ุงูุชุนุฏููุงุช
๐ก ูููู ุงุณุชุฑุฌุงุน ุงููุทุนุฉ ูู ูุงุฆูุฉ ุงููุญุฐููุงุช

[โฌ๏ธ ุฑุฌูุน ูููุงุฆูุฉ]
```

## ๐ ุงูุงุณุชุนูุงูุงุช ุงููููุฏุฉ

### ุนุฑุถ ุณุฌู ุชุนุฏููุงุช ูุทุนุฉ ูุนููุฉ:
```typescript
const history = await Database.prisma.iNV_ItemHistory.findMany({
  where: {
    itemId: itemId,
    itemType: 'SPARE_PART'
  },
  orderBy: { performedAt: 'desc' }
})
```

### ุนุฑุถ ุฌููุน ุงููุทุน ุงููุญุฐููุฉ:
```typescript
const deletedItems = await Database.prisma.iNV_SparePart.findMany({
  where: { isActive: false },
  include: {
    category: true,
    location: true
  }
})
```

### ุงุณุชุฑุฌุงุน ูุทุนุฉ ูุญุฐููุฉ:
```typescript
await Database.prisma.iNV_SparePart.update({
  where: { id: itemId },
  data: { isActive: true }
})

// ุชุณุฌูู ุนูููุฉ ุงูุงุณุชุฑุฌุงุน
await Database.prisma.iNV_ItemHistory.create({
  data: {
    itemId,
    itemType: 'SPARE_PART',
    action: 'RESTORE',
    performedBy: BigInt(userId),
    notes: 'ุงุณุชุฑุฌุงุน ุงููุทุนุฉ ูู ุงููุญุฐููุงุช'
  }
})
```

## ๐ ุชูุงุฑูุฑ ุงูุฃุฏูู

### ุชูุฑูุฑ ุงูุญุฐู:
ูุชู ุฅุฑุณุงู ุชูุฑูุฑ ูุฌููุน ุฃุฏูู ุงููุฎุงุฒู ูุญุชูู ุนูู:
- ูุนูููุงุช ุงููุณุชุฎุฏู (ุงูุงุณูุ ุงููุนุฑูุ ุงูุชุงุฑูุฎ)
- ูุนูููุงุช ุงููุทุนุฉ ุงููุญุฐููุฉ (ุจุงุฑููุฏุ ุงุณูุ ููุฏุ ูููุฉุ ูููุฉ)
- ููุน ุงูุญุฐู (ูุงุนู - ูููู ุงูุงุณุชุฑุฌุงุน)
- ุฃุฒุฑุงุฑ: ุนุฑุถ ูุงุฆูุฉ ุงููุญุฐููุงุชุ ุฅุฏุงุฑุฉ ูุทุน ุงูุบูุงุฑ

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ูุจู ุงูุชุดุบูู**: ุชุฃูุฏ ูู ุชุดุบูู `npx prisma generate` ูุชุญุฏูุซ Prisma Client
2. **Backup**: ุงุญุชูุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจู ุงูุชุทุจูู
3. **Testing**: ุงุฎุชุจุฑ ุนูู ุจูุฆุฉ ุชุทููุฑ ุฃููุงู
4. **Performance**: ุณุฌู ุงูุชุนุฏููุงุช ุณูููู ุจูุฑูุฑ ุงูููุชุ ููุฑ ูู ุฃุฑุดูุฉ ุงูุณุฌูุงุช ุงููุฏููุฉ

## ๐ฏ ุงูููุงู ุงูุชุงููุฉ

- [ ] ุฅุถุงูุฉ ุตูุญุฉ ุนุฑุถ ูุงุฆูุฉ ุงููุญุฐููุงุช
- [ ] ุฅุถุงูุฉ ูุธููุฉ ุงุณุชุฑุฌุงุน ุงููุทุน ุงููุญุฐููุฉ
- [ ] ุฅุถุงูุฉ ุชูุฑูุฑ ุณุฌู ุงูุชุนุฏููุงุช ููู ูุทุนุฉ
- [ ] ุฅุถุงูุฉ ูุนุงูุฌุงุช ุงูุชุนุฏูู (ุงุณูุ ูููุฉุ ุณุนุฑุ ุฅูุฎ)
- [ ] ุฅุถุงูุฉ ุชุณุฌูู ุชููุงุฆู ููุชุนุฏููุงุช ูู ุฌููุน ุงูุนูููุงุช
